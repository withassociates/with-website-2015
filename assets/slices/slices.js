!function(t){var e;t.rails=e={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},fire:function(e,i,s){var n=t.Event(i);return e.trigger(n,s),n.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},handleRemote:function(i){var s,n,o,r=i.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType;if(e.fire(i,"ajax:before")){if(i.is("form")){s=i.attr("method"),n=i.attr("action"),o=i.serializeArray();var a=i.data("ujs:submit-button");a&&(o.push(a),i.data("ujs:submit-button",null))}else s=i.data("method"),n=i.attr("href"),o=i.data("params")||null;e.ajax({url:n,type:s||"GET",data:o,dataType:r,beforeSend:function(t,s){return void 0===s.dataType&&t.setRequestHeader("accept","*/*;q=0.5, "+s.accepts.script),e.fire(i,"ajax:beforeSend",[t,s])},success:function(t,e,s){i.trigger("ajax:success",[t,e,s])},complete:function(t,e){i.trigger("ajax:complete",[t,e])},error:function(t,e,s){i.trigger("ajax:error",[t,e,s])}})}},handleMethod:function(e){var i=e.attr("href"),s=e.data("method"),n=t("meta[name=csrf-token]").attr("content"),o=t("meta[name=csrf-param]").attr("content"),r=t('<form method="post" action="'+i+'"></form>'),a='<input name="_method" value="'+s+'" type="hidden" />';void 0!==o&&void 0!==n&&(a+='<input name="'+o+'" value="'+n+'" type="hidden" />'),r.hide().append(a).appendTo("body"),r.submit()},disableFormElements:function(i){i.find(e.disableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with",e[i]()),e[i](e.data("disable-with")),e.attr("disabled","disabled")})},enableFormElements:function(i){i.find(e.enableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[i](e.data("ujs:enable-with")),e.removeAttr("disabled")})},allowAction:function(t){var i,s=t.data("confirm"),n=!1;return s?(e.fire(t,"confirm")&&(n=e.confirm(s),i=e.fire(t,"confirm:complete",[n])),n&&i):!0},blankInputs:function(e,i,s){var n,o=t(),r=i||"input,textarea";return e.find(r).each(function(){n=t(this),(s?n.val():!n.val())&&(o=o.add(n))}),o.length?o:!1},nonBlankInputs:function(t,i){return e.blankInputs(t,i,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},callFormSubmitBindings:function(e){var i=e.data("events"),s=!0;return void 0!==i&&void 0!==i.submit&&t.each(i.submit,function(t,e){return"function"==typeof e.handler?s=e.handler(e.data):void 0}),s}},"ajaxPrefilter"in t?t.ajaxPrefilter(function(t,i,s){e.CSRFProtection(s)}):t(document).ajaxSend(function(t,i){e.CSRFProtection(i)}),t(e.linkClickSelector).live("click.rails",function(i){var s=t(this);return e.allowAction(s)?void 0!==s.data("remote")?(e.handleRemote(s),!1):s.data("method")?(e.handleMethod(s),!1):void 0:e.stopEverything(i)}),t(e.formSubmitSelector).live("submit.rails",function(i){var s=t(this),n=void 0!==s.data("remote"),o=e.blankInputs(s,e.requiredInputSelector),r=e.nonBlankInputs(s,e.fileInputSelector);return e.allowAction(s)?o&&e.fire(s,"ajax:aborted:required",[o])?e.stopEverything(i):n?r?e.fire(s,"ajax:aborted:file",[r]):t.support.submitBubbles||e.callFormSubmitBindings(s)!==!1?(e.handleRemote(s),!1):e.stopEverything(i):void setTimeout(function(){e.disableFormElements(s)},13):e.stopEverything(i)}),t(e.formInputClickSelector).live("click.rails",function(i){var s=t(this);if(!e.allowAction(s))return e.stopEverything(i);var n=s.attr("name"),o=n?{name:n,value:s.val()}:null;s.closest("form").data("ujs:submit-button",o)}),t(e.formSubmitSelector).live("ajax:beforeSend.rails",function(i){this==i.target&&e.disableFormElements(t(this))}),t(e.formSubmitSelector).live("ajax:complete.rails",function(i){this==i.target&&e.enableFormElements(t(this))})}(jQuery),this.Handlebars={},function(t){t.VERSION="1.0.rc.1",t.helpers={},t.partials={},t.registerHelper=function(t,e,i){i&&(e.not=i),this.helpers[t]=e},t.registerPartial=function(t,e){this.partials[t]=e},t.registerHelper("helperMissing",function(t){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+t+"'")});var e=Object.prototype.toString,i="[object Function]";t.registerHelper("blockHelperMissing",function(s,n){var o=n.inverse||function(){},r=n.fn,a=e.call(s);return a===i&&(s=s.call(this)),s===!0?r(this):s===!1||null==s?o(this):"[object Array]"===a?s.length>0?t.helpers.each(s,n):o(this):r(s)}),t.K=function(){},t.createFrame=Object.create||function(e){t.K.prototype=e;var i=new t.K;return t.K.prototype=null,i},t.registerHelper("each",function(e,i){var s,n=i.fn,o=i.inverse,r="";if(i.data&&(s=t.createFrame(i.data)),e&&e.length>0)for(var a=0,l=e.length;l>a;a++)s&&(s.index=a),r+=n(e[a],{data:s});else r=o(this);return r}),t.registerHelper("if",function(s,n){var o=e.call(s);return o===i&&(s=s.call(this)),!s||t.Utils.isEmpty(s)?n.inverse(this):n.fn(this)}),t.registerHelper("unless",function(e,i){var s=i.fn,n=i.inverse;return i.fn=n,i.inverse=s,t.helpers["if"].call(this,e,i)}),t.registerHelper("with",function(t,e){return e.fn(t)}),t.registerHelper("log",function(e){t.log(e)})}(this.Handlebars);var handlebars=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,DATA:27,param:28,STRING:29,INTEGER:30,BOOLEAN:31,hashSegments:32,hashSegment:33,ID:34,EQUALS:35,pathSegments:36,SEP:37,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",27:"DATA",29:"STRING",30:"INTEGER",31:"BOOLEAN",34:"ID",35:"EQUALS",37:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[17,1],[25,2],[25,1],[28,1],[28,1],[28,1],[28,1],[28,1],[26,1],[32,2],[32,1],[33,3],[33,3],[33,3],[33,3],[33,3],[21,1],[36,3],[36,1]],performAction:function(t,e,i,s,n,o){var r=o.length-1;switch(n){case 1:return o[r-1];case 2:this.$=new s.ProgramNode(o[r-2],o[r]);break;case 3:this.$=new s.ProgramNode(o[r]);break;case 4:this.$=new s.ProgramNode([]);break;case 5:this.$=[o[r]];break;case 6:o[r-1].push(o[r]),this.$=o[r-1];break;case 7:this.$=new s.BlockNode(o[r-2],o[r-1].inverse,o[r-1],o[r]);break;case 8:this.$=new s.BlockNode(o[r-2],o[r-1],o[r-1].inverse,o[r]);break;case 9:this.$=o[r];break;case 10:this.$=o[r];break;case 11:this.$=new s.ContentNode(o[r]);break;case 12:this.$=new s.CommentNode(o[r]);break;case 13:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1]);break;case 14:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1]);break;case 15:this.$=o[r-1];break;case 16:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1]);break;case 17:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1],!0);break;case 18:this.$=new s.PartialNode(o[r-1]);break;case 19:this.$=new s.PartialNode(o[r-2],o[r-1]);break;case 20:break;case 21:this.$=[[o[r-2]].concat(o[r-1]),o[r]];break;case 22:this.$=[[o[r-1]].concat(o[r]),null];break;case 23:this.$=[[o[r-1]],o[r]];break;case 24:this.$=[[o[r]],null];break;case 25:this.$=[[new s.DataNode(o[r])],null];break;case 26:o[r-1].push(o[r]),this.$=o[r-1];break;case 27:this.$=[o[r]];break;case 28:this.$=o[r];break;case 29:this.$=new s.StringNode(o[r]);break;case 30:this.$=new s.IntegerNode(o[r]);break;case 31:this.$=new s.BooleanNode(o[r]);break;case 32:this.$=new s.DataNode(o[r]);break;case 33:this.$=new s.HashNode(o[r]);break;case 34:o[r-1].push(o[r]),this.$=o[r-1];break;case 35:this.$=[o[r]];break;case 36:this.$=[o[r-2],o[r]];break;case 37:this.$=[o[r-2],new s.StringNode(o[r])];break;case 38:this.$=[o[r-2],new s.IntegerNode(o[r])];break;case 39:this.$=[o[r-2],new s.BooleanNode(o[r])];break;case 40:this.$=[o[r-2],new s.DataNode(o[r])];break;case 41:this.$=new s.IdNode(o[r]);break;case 42:o[r-2].push(o[r]),this.$=o[r-2];break;case 43:this.$=[o[r]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,27:[1,24],34:[1,26],36:25},{17:27,21:23,27:[1,24],34:[1,26],36:25},{17:28,21:23,27:[1,24],34:[1,26],36:25},{17:29,21:23,27:[1,24],34:[1,26],36:25},{21:30,34:[1,26],36:25},{1:[2,1]},{6:31,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,32],21:23,27:[1,24],34:[1,26],36:25},{10:33,20:[1,34]},{10:35,20:[1,34]},{18:[1,36]},{18:[2,24],21:41,25:37,26:38,27:[1,45],28:39,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,25]},{18:[2,41],27:[2,41],29:[2,41],30:[2,41],31:[2,41],34:[2,41],37:[1,48]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],37:[2,43]},{18:[1,49]},{18:[1,50]},{18:[1,51]},{18:[1,52],21:53,34:[1,26],36:25},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:54,34:[1,26],36:25},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:41,26:55,27:[1,45],28:56,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,23]},{18:[2,27],27:[2,27],29:[2,27],30:[2,27],31:[2,27],34:[2,27]},{18:[2,33],33:57,34:[1,58]},{18:[2,28],27:[2,28],29:[2,28],30:[2,28],31:[2,28],34:[2,28]},{18:[2,29],27:[2,29],29:[2,29],30:[2,29],31:[2,29],34:[2,29]},{18:[2,30],27:[2,30],29:[2,30],30:[2,30],31:[2,30],34:[2,30]},{18:[2,31],27:[2,31],29:[2,31],30:[2,31],31:[2,31],34:[2,31]},{18:[2,32],27:[2,32],29:[2,32],30:[2,32],31:[2,32],34:[2,32]},{18:[2,35],34:[2,35]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],35:[1,59],37:[2,43]},{34:[1,60]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,61]},{18:[1,62]},{18:[2,21]},{18:[2,26],27:[2,26],29:[2,26],30:[2,26],31:[2,26],34:[2,26]},{18:[2,34],34:[2,34]},{35:[1,59]},{21:63,27:[1,67],29:[1,64],30:[1,65],31:[1,66],34:[1,26],36:25},{18:[2,42],27:[2,42],29:[2,42],30:[2,42],31:[2,42],34:[2,42],37:[2,42]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,36],34:[2,36]},{18:[2,37],34:[2,37]},{18:[2,38],34:[2,38]},{18:[2,39],34:[2,39]},{18:[2,40],34:[2,40]}],defaultActions:{16:[2,1],24:[2,25],38:[2,23],55:[2,21]},parseError:function(t){throw new Error(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],n=[null],o=[],r=this.table,a="",l=0,h=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;o.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,m,g,v,b,_,y,w,x={};;){if(m=s[s.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===p||"undefined"==typeof p)&&(p=e()),g=r[m]&&r[m][p]),"undefined"==typeof g||!g.length||!g[0]){var S="";if(!c){w=[];for(b in r[m])this.terminals_[b]&&b>2&&w.push("'"+this.terminals_[b]+"'");S=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:w})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(g[0]){case 1:s.push(p),n.push(this.lexer.yytext),o.push(this.lexer.yylloc),s.push(g[1]),p=null,f?(p=f,f=null):(h=this.lexer.yyleng,a=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(_=this.productions_[g[1]][1],x.$=n[n.length-_],x._$={first_line:o[o.length-(_||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(_||1)].first_column,last_column:o[o.length-1].last_column},d&&(x._$.range=[o[o.length-(_||1)].range[0],o[o.length-1].range[1]]),v=this.performAction.call(x,a,h,l,this.yy,g[1],n,o),"undefined"!=typeof v)return v;_&&(s=s.slice(0,-1*_*2),n=n.slice(0,-1*_),o=o.slice(0,-1*_)),s.push(this.productions_[g[1]][0]),n.push(x.$),o.push(x._$),y=r[s[s.length-2]][s[s.length-1]],s.push(y);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,s,n;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),r=0;r<o.length&&(i=this._input.match(this.rules[o[r]]),!i||e&&!(i[0].length>e[0].length)||(e=i,s=r,this.options.flex));r++);return e?(n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,o[s],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,i,s){switch(i){case 0:if("\\"!==e.yytext.slice(-1)&&this.begin("mu"),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1),this.begin("emu")),e.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==e.yytext.slice(-1)&&this.popState(),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1)),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return e.yytext=e.yytext.substr(3,e.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 35;case 13:return 34;case 14:return 34;case 15:return 37;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),29;case 20:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),29;case 21:return e.yytext=e.yytext.substr(1),27;case 22:return 31;case 23:return 31;case 24:return 30;case 25:return 34;case 26:return e.yytext=e.yytext.substr(1,e.yyleng-2),34;case 27:return"INVALID";case 28:return 5}},t.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],t.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,28],inclusive:!0}},t}();return e.lexer=i,t.prototype=e,e.Parser=t,new t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=handlebars,exports.Parser=handlebars.Parser,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");var e;return e="undefined"!=typeof process?require("fs").readFileSync(require("path").resolve(t[1]),"utf8"):require("file").path(require("file").cwd()).join(t[1]).read({charset:"utf-8"}),exports.parser.parse(e)},"undefined"!=typeof module&&require.main===module&&exports.main("undefined"!=typeof process?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(t){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(t)},Handlebars.print=function(t){return(new Handlebars.PrintVisitor).accept(t)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}},Handlebars.log=function(t,e){Handlebars.logger.log(t,e)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(t,e){this.type="program",this.statements=t,e&&(this.inverse=new Handlebars.AST.ProgramNode(e))},Handlebars.AST.MustacheNode=function(t,e,i){this.type="mustache",this.escaped=!i,this.hash=e;var s=this.id=t[0],n=this.params=t.slice(1),o=this.eligibleHelper=s.isSimple;this.isHelper=o&&(n.length||e)},Handlebars.AST.PartialNode=function(t,e){this.type="partial",this.id=t,this.context=e};var t=function(t,e){if(t.original!==e.original)throw new Handlebars.Exception(t.original+" doesn't match "+e.original)};Handlebars.AST.BlockNode=function(e,i,s,n){t(e.id,n),this.type="block",this.mustache=e,this.program=i,this.inverse=s,this.inverse&&!this.program&&(this.isInverse=!0)},Handlebars.AST.ContentNode=function(t){this.type="content",this.string=t},Handlebars.AST.HashNode=function(t){this.type="hash",this.pairs=t},Handlebars.AST.IdNode=function(t){this.type="ID",this.original=t.join(".");for(var e=[],i=0,s=0,n=t.length;n>s;s++){var o=t[s];".."===o?i++:"."===o||"this"===o?this.isScoped=!0:e.push(o)}this.parts=e,this.string=e.join("."),this.depth=i,this.isSimple=1===t.length&&!this.isScoped&&0===i},Handlebars.AST.DataNode=function(t){this.type="DATA",this.id=t},Handlebars.AST.StringNode=function(t){this.type="STRING",this.string=t},Handlebars.AST.IntegerNode=function(t){this.type="INTEGER",this.integer=t},Handlebars.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t},Handlebars.AST.CommentNode=function(t){this.type="comment",this.comment=t}}(),Handlebars.Exception=function(){var t=Error.prototype.constructor.apply(this,arguments);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.message=t.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(t){this.string=t},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=/[&<>"'`]/g,i=/[&<>"'`]/,s=function(e){return t[e]||"&amp;"};Handlebars.Utils={escapeExpression:function(t){return t instanceof Handlebars.SafeString?t.toString():null==t||t===!1?"":i.test(t)?t.replace(e,s):t},isEmpty:function(t){return"undefined"==typeof t?!0:null===t?!0:t===!1?!0:"[object Array]"===Object.prototype.toString.call(t)&&0===t.length?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(t,e){t.prototype={compiler:t,disassemble:function(){for(var t,e,i,s=this.opcodes,n=[],o=0,r=s.length;r>o;o++)if(t=s[o],"DECLARE"===t.opcode)n.push("DECLARE "+t.name+"="+t.value);else{e=[];for(var a=0;a<t.args.length;a++)i=t.args[a],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),e.push(i);n.push(t.opcode+" "+e.join(" "))}return n.join("\n")},guid:0,compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var s in i)this.options.knownHelpers[s]=i[s];return this.program(t)},accept:function(t){return this[t.type](t)},program:function(t){var e,i=t.statements;this.opcodes=[];for(var s=0,n=i.length;n>s;s++)e=i[s],this[e.type](e);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e,i=(new this.compiler).compile(t,this.options),s=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[s]=i;for(var n=0,o=i.depths.list.length;o>n;n++)e=i.depths.list[n],2>e||this.addDepth(e-1);return s},block:function(t){var e=t.mustache,i=t.program,s=t.inverse;i&&(i=this.compileProgram(i)),s&&(s=this.compileProgram(s));var n=this.classifyMustache(e);"helper"===n?this.helperMustache(e,i,s):"simple"===n?(this.simpleMustache(e),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("pushLiteral","{}"),this.opcode("blockValue")):(this.ambiguousMustache(e,i,s),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("pushLiteral","{}"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(t){var e,i,s=t.pairs;this.opcode("push","{}");for(var n=0,o=s.length;o>n;n++)e=s[n],i=e[1],this.accept(i),this.opcode("assignToHash",e[0])},partial:function(t){var e=t.id;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.original),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){var e=this.options,i=this.classifyMustache(t);"simple"===i?this.simpleMustache(t):"helper"===i?this.helperMustache(t):this.ambiguousMustache(t),this.opcode(t.escaped&&!e.noEscape?"appendEscaped":"append")},ambiguousMustache:function(t,e,i){var s=t.id,n=s.parts[0];this.opcode("getContext",s.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",n)},simpleMustache:function(t){var e=t.id;"DATA"===e.type?this.DATA(e):e.parts.length?this.ID(e):(this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(t,e,i){var s=this.setupFullMustacheParams(t,e,i),n=t.id.parts[0];if(this.options.knownHelpers[n])this.opcode("invokeKnownHelper",s.length,n);else{if(this.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+n);this.opcode("invokeHelper",s.length,n)}},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var e=t.parts[0];e?this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");for(var i=1,s=t.parts.length;s>i;i++)this.opcode("lookup",t.parts[i])},DATA:function(t){this.options.data=!0,this.opcode("lookupData",t.id)},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},comment:function(){},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})},declare:function(t,e){this.opcodes.push({opcode:"DECLARE",name:t,value:e})},addDepth:function(t){if(isNaN(t))throw new Error("EWOT");0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},classifyMustache:function(t){var e=t.isHelper,i=t.eligibleHelper,s=this.options;if(i&&!e){var n=t.id.parts[0];s.knownHelpers[n]?e=!0:s.knownHelpersOnly&&(i=!1)}return e?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(var e,i=t.length;i--;)e=t[i],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.string)):this[e.type](e)},setupMustacheParams:function(t){var e=t.params;return this.pushParams(e),t.hash?this.hash(t.hash):this.opcode("pushLiteral","{}"),e},setupFullMustacheParams:function(t,e,i){var s=t.params;return this.pushParams(s),this.opcode("pushProgram",e),this.opcode("pushProgram",i),t.hash?this.hash(t.hash):this.opcode("pushLiteral","{}"),s}};var i=function(t){this.value=t};e.prototype={nameLookup:function(t,i){return/^[0-9]+$/.test(i)?t+"["+i+"]":e.isValidJavaScriptVariableName(i)?t+"."+i:t+"['"+i+"']"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":"buffer += "+t+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,e,i,s){this.environment=t,this.options=e||{},Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.compileChildren(t,e);var n,o=t.opcodes;for(this.i=0,r=o.length;this.i<r;this.i++)n=o[this.i],"DECLARE"===n.opcode?this[n.name]=n.value:this[n.opcode].apply(this,n.args);return this.createFunctionContext(s)},nextOpcode:function(){{var t=this.environment.opcodes;t[this.i+1]}return t[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = helpers || "+e+".helpers;";this.environment.usePartial&&(i=i+" partials = partials || "+e+".partials;"),this.options.data&&(i+=" data = data || {};"),t.push(i)}t.push(this.environment.isSimple?"":", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(t){var e=this.stackVars.concat(this.registers.list);if(e.length>0&&(this.source[1]=this.source[1]+", "+e.join(", ")),!this.isChild){for(var i in this.context.aliases)this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var s=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],n=0,o=this.environment.depths.list.length;o>n;n++)s.push("depth"+this.environment.depths.list[n]);if(t)return s.push(this.source.join("\n  ")),Function.apply(this,s);var r="function "+(this.name||"")+"("+s.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,r+"\n\n"),r},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),e+" = blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t);var e=this.topStack();t.splice(1,0,e),this.source.push("if (!"+this.lastHelper+") { "+e+" = blockHelperMissing.call("+t.join(", ")+"); }")},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},append:function(){var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var t=this.nextOpcode(),e="";this.context.aliases.escapeExpression="this.escapeExpression",t&&"appendContent"===t.opcode&&(e=" + "+this.quotedString(t.args[0]),this.eat(t)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+e))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupOnContext:function(t){this.pushStack(this.nameLookup("depth"+this.lastContext,t,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(t){return"typeof "+t+" === functionType ? "+t+"() : "+t})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(t){this.pushStack(this.nameLookup("data",t,"data"))},pushStringParam:function(t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t)},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){this.pushStack(t)},pushLiteral:function(t){this.pushStackLiteral(t)},pushProgram:function(t){this.pushStackLiteral(null!=t?this.programExpression(t):null)},invokeHelper:function(t,e){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(t,e);this.register("foundHelper",i.name),this.pushStack("foundHelper ? foundHelper.call("+i.callParams+") : helperMissing.call("+i.helperMissingParams+")")},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,e);this.pushStack(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var e=this.setupHelper(0,t),i=this.lastHelper=this.nameLookup("helpers",t,"helper");this.register("foundHelper",i);var s=this.nameLookup("depth"+this.lastContext,t,"context"),n=this.nextStack();
this.source.push("if (foundHelper) { "+n+" = foundHelper.call("+e.callParams+"); }"),this.source.push("else { "+n+" = "+s+"; "+n+" = typeof "+n+" === functionType ? "+n+"() : "+n+"; }")},invokePartial:function(t){var e=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"];this.options.data&&e.push("data"),this.context.aliases.self="this",this.pushStack("self.invokePartial("+e.join(", ")+");")},assignToHash:function(t){var e=this.popStack(),i=this.topStack();this.source.push(i+"['"+t+"'] = "+e+";")},compiler:e,compileChildren:function(t,e){for(var i,s,n=t.children,o=0,r=n.length;r>o;o++){i=n[o],s=new this.compiler,this.context.programs.push("");var a=this.context.programs.length;i.index=a,i.name="program"+a,this.context.programs[a]=s.compile(i,e,this.context)}},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.environment.children[t],s=i.depths.list,n=[i.index,i.name,"data"],o=0,r=s.length;r>o;o++)e=s[o],n.push(1===e?"depth0":"depth"+(e-1));return 0===s.length?"self.program("+n.join(", ")+")":(n.shift(),"self.programWithDepth("+n.join(", ")+")")},register:function(t,e){this.useRegister(t),this.source.push(t+" = "+e+";")},useRegister:function(t){this.registers[t]||(this.registers[t]=!0,this.registers.list.push(t))},pushStackLiteral:function(t){return this.compileStack.push(new i(t)),t},pushStack:function(t){return this.source.push(this.incrStack()+" = "+t+";"),this.compileStack.push("stack"+this.stackSlot),"stack"+this.stackSlot},replaceStack:function(t){var e=t.call(this,this.topStack());return this.source.push(this.topStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){var t=this.incrStack();return this.compileStack.push("stack"+this.stackSlot),t},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){var t=this.compileStack.pop();return t instanceof i?t.value:(this.stackSlot--,t)},topStack:function(){var t=this.compileStack[this.compileStack.length-1];return t instanceof i?t.value:t},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(t,e){var i=[];this.setupParams(t,i);var s=this.nameLookup("helpers",e,"helper");return{params:i,name:s,callParams:["depth0"].concat(i).join(", "),helperMissingParams:["depth0",this.quotedString(e)].concat(i).join(", ")}},setupParams:function(t,e){var i,s,n,o=[],r=[];o.push("hash:"+this.popStack()),s=this.popStack(),n=this.popStack(),(n||s)&&(n||(this.context.aliases.self="this",n="self.noop"),s||(this.context.aliases.self="this",s="self.noop"),o.push("inverse:"+s),o.push("fn:"+n));for(var a=0;t>a;a++)i=this.popStack(),e.push(i),this.options.stringParams&&r.push(this.popStack());return this.options.stringParams&&o.push("contexts:["+r.join(",")+"]"),this.options.data&&o.push("data:data"),e.push("{"+o.join(",")+"}"),e.join(", ")}};for(var s="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),n=e.RESERVED_WORDS={},o=0,r=s.length;r>o;o++)n[s[o]]=!0;e.isValidJavaScriptVariableName=function(t){return!e.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(t,e){e=e||{};var i=Handlebars.parse(t),s=(new Handlebars.Compiler).compile(i,e);return(new Handlebars.JavaScriptCompiler).compile(s,e)},Handlebars.compile=function(t,e){function i(){var i=Handlebars.parse(t),s=(new Handlebars.Compiler).compile(i,e),n=(new Handlebars.JavaScriptCompiler).compile(s,e,void 0,!0);return Handlebars.template(n)}e=e||{};var s;return function(t,e){return s||(s=i()),s.call(this,t,e)}},Handlebars.VM={template:function(t){var e={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(t,e,i){var s=this.programs[t];return i?Handlebars.VM.program(e,i):s?s:s=this.programs[t]=Handlebars.VM.program(e)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(i,s){return s=s||{},t.call(e,Handlebars,i,s.helpers,s.partials,s.data)}},programWithDepth:function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(s,n){return n=n||{},t.apply(this,[s,n.data||e].concat(i))}},program:function(t,e){return function(i,s){return s=s||{},t(i,s.data||e)}},noop:function(){return""},invokePartial:function(t,e,i,s,n,o){var r={helpers:s,partials:n,data:o};if(void 0===t)throw new Handlebars.Exception("The partial "+e+" could not be found");if(t instanceof Function)return t(i,r);if(Handlebars.compile)return n[e]=Handlebars.compile(t,{data:void 0!==o}),n[e](i,r);throw new Handlebars.Exception("The partial "+e+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,function(){var t=this,e=t._,i={},s=Array.prototype,n=Object.prototype,o=Function.prototype,r=s.push,a=s.slice,l=s.concat,h=(s.unshift,n.toString),c=n.hasOwnProperty,u=s.forEach,d=s.map,p=s.reduce,f=s.reduceRight,m=s.filter,g=s.every,v=s.some,b=s.indexOf,_=s.lastIndexOf,y=Array.isArray,w=Object.keys,x=o.bind,S=function(t){return t instanceof S?t:this instanceof S?void(this._wrapped=t):new S(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):t._=S,S.VERSION="1.4.2";var k=S.each=S.forEach=function(t,e,s){if(null!=t)if(u&&t.forEach===u)t.forEach(e,s);else if(t.length===+t.length){for(var n=0,o=t.length;o>n;n++)if(e.call(s,t[n],n,t)===i)return}else for(var r in t)if(S.has(t,r)&&e.call(s,t[r],r,t)===i)return};S.map=S.collect=function(t,e,i){var s=[];return null==t?s:d&&t.map===d?t.map(e,i):(k(t,function(t,n,o){s[s.length]=e.call(i,t,n,o)}),s)},S.reduce=S.foldl=S.inject=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return s&&(e=S.bind(e,s)),n?t.reduce(e,i):t.reduce(e);if(k(t,function(t,o,r){n?i=e.call(s,i,t,o,r):(i=t,n=!0)}),!n)throw new TypeError("Reduce of empty array with no initial value");return i},S.reduceRight=S.foldr=function(t,e,i,s){var n=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return s&&(e=S.bind(e,s)),arguments.length>2?t.reduceRight(e,i):t.reduceRight(e);var o=t.length;if(o!==+o){var r=S.keys(t);o=r.length}if(k(t,function(a,l,h){l=r?r[--o]:--o,n?i=e.call(s,i,t[l],l,h):(i=t[l],n=!0)}),!n)throw new TypeError("Reduce of empty array with no initial value");return i},S.find=S.detect=function(t,e,i){var s;return P(t,function(t,n,o){return e.call(i,t,n,o)?(s=t,!0):void 0}),s},S.filter=S.select=function(t,e,i){var s=[];return null==t?s:m&&t.filter===m?t.filter(e,i):(k(t,function(t,n,o){e.call(i,t,n,o)&&(s[s.length]=t)}),s)},S.reject=function(t,e,i){var s=[];return null==t?s:(k(t,function(t,n,o){e.call(i,t,n,o)||(s[s.length]=t)}),s)},S.every=S.all=function(t,e,s){e||(e=S.identity);var n=!0;return null==t?n:g&&t.every===g?t.every(e,s):(k(t,function(t,o,r){return(n=n&&e.call(s,t,o,r))?void 0:i}),!!n)};var P=S.some=S.any=function(t,e,s){e||(e=S.identity);var n=!1;return null==t?n:v&&t.some===v?t.some(e,s):(k(t,function(t,o,r){return n||(n=e.call(s,t,o,r))?i:void 0}),!!n)};S.contains=S.include=function(t,e){var i=!1;return null==t?i:b&&t.indexOf===b?-1!=t.indexOf(e):i=P(t,function(t){return t===e})},S.invoke=function(t,e){var i=a.call(arguments,2);return S.map(t,function(t){return(S.isFunction(e)?e:t[e]).apply(t,i)})},S.pluck=function(t,e){return S.map(t,function(t){return t[e]})},S.where=function(t,e){return S.isEmpty(e)?[]:S.filter(t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},S.max=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&S.isEmpty(t))return-1/0;var s={computed:-1/0};return k(t,function(t,n,o){var r=e?e.call(i,t,n,o):t;r>=s.computed&&(s={value:t,computed:r})}),s.value},S.min=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&S.isEmpty(t))return 1/0;var s={computed:1/0};return k(t,function(t,n,o){var r=e?e.call(i,t,n,o):t;r<s.computed&&(s={value:t,computed:r})}),s.value},S.shuffle=function(t){var e,i=0,s=[];return k(t,function(t){e=S.random(i++),s[i-1]=s[e],s[e]=t}),s};var C=function(t){return S.isFunction(t)?t:function(e){return e[t]}};S.sortBy=function(t,e,i){var s=C(e);return S.pluck(S.map(t,function(t,e,n){return{value:t,index:e,criteria:s.call(i,t,e,n)}}).sort(function(t,e){var i=t.criteria,s=e.criteria;if(i!==s){if(i>s||void 0===i)return 1;if(s>i||void 0===s)return-1}return t.index<e.index?-1:1}),"value")};var $=function(t,e,i,s){var n={},o=C(e);return k(t,function(e,r){var a=o.call(i,e,r,t);s(n,a,e)}),n};S.groupBy=function(t,e,i){return $(t,e,i,function(t,e,i){(S.has(t,e)?t[e]:t[e]=[]).push(i)})},S.countBy=function(t,e,i){return $(t,e,i,function(t,e){S.has(t,e)||(t[e]=0),t[e]++})},S.sortedIndex=function(t,e,i,s){i=null==i?S.identity:C(i);for(var n=i.call(s,e),o=0,r=t.length;r>o;){var a=o+r>>>1;i.call(s,t[a])<n?o=a+1:r=a}return o},S.toArray=function(t){return t?t.length===+t.length?a.call(t):S.values(t):[]},S.size=function(t){return t.length===+t.length?t.length:S.keys(t).length},S.first=S.head=S.take=function(t,e,i){return null==e||i?t[0]:a.call(t,0,e)},S.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},S.last=function(t,e,i){return null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},S.rest=S.tail=S.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},S.compact=function(t){return S.filter(t,function(t){return!!t})};var T=function(t,e,i){return k(t,function(t){S.isArray(t)?e?r.apply(i,t):T(t,e,i):i.push(t)}),i};S.flatten=function(t,e){return T(t,e,[])},S.without=function(t){return S.difference(t,a.call(arguments,1))},S.uniq=S.unique=function(t,e,i,s){var n=i?S.map(t,i,s):t,o=[],r=[];return k(n,function(i,s){(e?s&&r[r.length-1]===i:S.contains(r,i))||(r.push(i),o.push(t[s]))}),o},S.union=function(){return S.uniq(l.apply(s,arguments))},S.intersection=function(t){var e=a.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.indexOf(e,t)>=0})})},S.difference=function(t){var e=l.apply(s,a.call(arguments,1));return S.filter(t,function(t){return!S.contains(e,t)})},S.zip=function(){for(var t=a.call(arguments),e=S.max(S.pluck(t,"length")),i=new Array(e),s=0;e>s;s++)i[s]=S.pluck(t,""+s);return i},S.object=function(t,e){for(var i={},s=0,n=t.length;n>s;s++)e?i[t[s]]=e[s]:i[t[s][0]]=t[s][1];return i},S.indexOf=function(t,e,i){if(null==t)return-1;var s=0,n=t.length;if(i){if("number"!=typeof i)return s=S.sortedIndex(t,e),t[s]===e?s:-1;s=0>i?Math.max(0,n+i):i}if(b&&t.indexOf===b)return t.indexOf(e,i);for(;n>s;s++)if(t[s]===e)return s;return-1},S.lastIndexOf=function(t,e,i){if(null==t)return-1;var s=null!=i;if(_&&t.lastIndexOf===_)return s?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var n=s?i:t.length;n--;)if(t[n]===e)return n;return-1},S.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var s=Math.max(Math.ceil((e-t)/i),0),n=0,o=new Array(s);s>n;)o[n++]=t,t+=i;return o};var H=function(){};S.bind=function(t,e){var i,s;if(t.bind===x&&x)return x.apply(t,a.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return s=a.call(arguments,2),i=function(){if(this instanceof i){H.prototype=t.prototype;var n=new H,o=t.apply(n,s.concat(a.call(arguments)));return Object(o)===o?o:n}return t.apply(e,s.concat(a.call(arguments)))}},S.bindAll=function(t){var e=a.call(arguments,1);return 0==e.length&&(e=S.functions(t)),k(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var i={};return e||(e=S.identity),function(){var s=e.apply(this,arguments);return S.has(i,s)?i[s]:i[s]=t.apply(this,arguments)}},S.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(a.call(arguments,1)))},S.throttle=function(t,e){var i,s,n,o,r,a,l=S.debounce(function(){r=o=!1},e);return function(){i=this,s=arguments;var h=function(){n=null,r&&(a=t.apply(i,s)),l()};return n||(n=setTimeout(h,e)),o?r=!0:(o=!0,a=t.apply(i,s)),l(),a}},S.debounce=function(t,e,i){var s,n;return function(){var o=this,r=arguments,a=function(){s=null,i||(n=t.apply(o,r))},l=i&&!s;return clearTimeout(s),s=setTimeout(a,e),l&&(n=t.apply(o,r)),n}},S.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},S.wrap=function(t,e){return function(){var i=[t];return r.apply(i,arguments),e.apply(this,i)}},S.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},S.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},S.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)S.has(t,i)&&(e[e.length]=i);return e},S.values=function(t){var e=[];for(var i in t)S.has(t,i)&&e.push(t[i]);return e},S.pairs=function(t){var e=[];for(var i in t)S.has(t,i)&&e.push([i,t[i]]);return e},S.invert=function(t){var e={};for(var i in t)S.has(t,i)&&(e[t[i]]=i);return e},S.functions=S.methods=function(t){var e=[];for(var i in t)S.isFunction(t[i])&&e.push(i);return e.sort()},S.extend=function(t){return k(a.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),t},S.pick=function(t){var e={},i=l.apply(s,a.call(arguments,1));return k(i,function(i){i in t&&(e[i]=t[i])}),e},S.omit=function(t){var e={},i=l.apply(s,a.call(arguments,1));for(var n in t)S.contains(i,n)||(e[n]=t[n]);return e},S.defaults=function(t){return k(a.call(arguments,1),function(e){for(var i in e)null==t[i]&&(t[i]=e[i])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t};var E=function(t,e,i,s){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof S&&(t=t._wrapped),e instanceof S&&(e=e._wrapped);var n=h.call(t);if(n!=h.call(e))return!1;switch(n){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=i.length;o--;)if(i[o]==t)return s[o]==e;i.push(t),s.push(e);var r=0,a=!0;if("[object Array]"==n){if(r=t.length,a=r==e.length)for(;r--&&(a=E(t[r],e[r],i,s)););}else{var l=t.constructor,c=e.constructor;if(l!==c&&!(S.isFunction(l)&&l instanceof l&&S.isFunction(c)&&c instanceof c))return!1;for(var u in t)if(S.has(t,u)&&(r++,!(a=S.has(e,u)&&E(t[u],e[u],i,s))))break;if(a){for(u in e)if(S.has(e,u)&&!r--)break;a=!r}}return i.pop(),s.pop(),a};S.isEqual=function(t,e){return E(t,e,[],[])},S.isEmpty=function(t){if(null==t)return!0;if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!!t&&1===t.nodeType},S.isArray=y||function(t){return"[object Array]"==h.call(t)},S.isObject=function(t){return t===Object(t)},k(["Arguments","Function","String","Number","Date","RegExp"],function(t){S["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),S.isArguments(arguments)||(S.isArguments=function(t){return!!t&&!!S.has(t,"callee")}),"function"!=typeof/./&&(S.isFunction=function(t){return"function"==typeof t}),S.isFinite=function(t){return S.isNumber(t)&&isFinite(t)},S.isNaN=function(t){return S.isNumber(t)&&t!=+t},S.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==h.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return c.call(t,e)},S.noConflict=function(){return t._=e,this},S.identity=function(t){return t},S.times=function(t,e,i){for(var s=0;t>s;s++)e.call(i,s)},S.random=function(t,e){return null==e&&(e=t,t=0),t+(0|Math.random()*(e-t+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};D.unescape=S.invert(D.escape);var A={escape:new RegExp("["+S.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(D.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(t){S[t]=function(e){return null==e?"":(""+e).replace(A[t],function(e){return D[t][e]})}}),S.result=function(t,e){if(null==t)return null;var i=t[e];return S.isFunction(i)?i.call(t):i},S.mixin=function(t){k(S.functions(t),function(e){var i=S[e]=t[e];S.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),L.call(this,i.apply(S,t))}})};var I=0;S.uniqueId=function(t){var e=I++;return t?t+e:e},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(t,e,i){i=S.defaults({},i,S.templateSettings);var s=new RegExp([(i.escape||O).source,(i.interpolate||O).source,(i.evaluate||O).source].join("|")+"|$","g"),n=0,o="__p+='";t.replace(s,function(e,i,s,r,a){o+=t.slice(n,a).replace(M,function(t){return"\\"+z[t]}),o+=i?"'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":s?"'+\n((__t=("+s+"))==null?'':__t)+\n'":r?"';\n"+r+"\n__p+='":"",n=a+e.length}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var r=new Function(i.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return r(e,S);var l=function(t){return r.call(this,t,S)};return l.source="function("+(i.variable||"obj")+"){\n"+o+"}",l},S.chain=function(t){return S(t).chain()};var L=function(t){return this._chain?S(t).chain():t};S.mixin(S),k(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];S.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),("shift"==t||"splice"==t)&&0===i.length&&delete i[0],L.call(this,i)}}),k(["concat","join","slice"],function(t){var e=s[t];S.prototype[t]=function(){return L.call(this,e.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),!function(t,e){"use strict";var i=e.prototype.trim,s=e.prototype.trimRight,n=e.prototype.trimLeft,o=function(t){return 1*t||0},r=function(t,e){if(1>e)return"";for(var i="";e>0;)1&e&&(i+=t),e>>=1,t+=t;return i},a=[].slice,l=function(t){return null==t?"\\s":t.source?t.source:"["+p.escapeRegExp(t)+"]"},h={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},c={};for(var u in h)c[h[u]]=u;var d=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var i=r,s=function(){return s.cache.hasOwnProperty(arguments[0])||(s.cache[arguments[0]]=s.parse(arguments[0])),s.format.call(null,s.cache[arguments[0]],arguments)};return s.format=function(s,n){var o,r,a,l,h,c,u,p=1,f=s.length,m="",g=[];for(r=0;f>r;r++)if(m=t(s[r]),"string"===m)g.push(s[r]);else if("array"===m){if(l=s[r],l[2])for(o=n[p],a=0;a<l[2].length;a++){if(!o.hasOwnProperty(l[2][a]))throw new Error(d('[_.sprintf] property "%s" does not exist',l[2][a]));o=o[l[2][a]]}else o=l[1]?n[l[1]]:n[p++];if(/[^s]/.test(l[8])&&"number"!=t(o))throw new Error(d("[_.sprintf] expecting number but found %s",t(o)));switch(l[8]){case"b":o=o.toString(2);break;case"c":o=e.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=l[7]?o.toExponential(l[7]):o.toExponential();break;case"f":o=l[7]?parseFloat(o).toFixed(l[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=e(o))&&l[7]?o.substring(0,l[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(l[8])&&l[3]&&o>=0?"+"+o:o,c=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ",u=l[6]-e(o).length,h=l[6]?i(c,u):"",g.push(l[5]?o+h:h+o)}return g.join("")},s.cache={},s.parse=function(t){for(var e=t,i=[],s=[],n=0;e;){if(null!==(i=/^[^\x25]+/.exec(e)))s.push(i[0]);else if(null!==(i=/^\x25{2}/.exec(e)))s.push("%");else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw new Error("[_.sprintf] huh?");if(i[2]){n|=1;var o=[],r=i[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(r)))throw new Error("[_.sprintf] huh?");for(o.push(a[1]);""!==(r=r.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(r)))o.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(r)))throw new Error("[_.sprintf] huh?");o.push(a[1])}i[2]=o}else n|=2;if(3===n)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");s.push(i)}e=e.substring(i[0].length)}return s},s}(),p={VERSION:"2.3.0",isBlank:function(t){return null==t&&(t=""),/^\s*$/.test(t)},stripTags:function(t){return null==t?"":e(t).replace(/<\/?[^>]+>/g,"")},capitalize:function(t){return t=null==t?"":e(t),t.charAt(0).toUpperCase()+t.slice(1)},chop:function(t,i){return null==t?[]:(t=e(t),i=~~i,i>0?t.match(new RegExp(".{1,"+i+"}","g")):[t])},clean:function(t){return p.strip(t).replace(/\s+/g," ")},count:function(t,i){return null==t||null==i?0:e(t).split(i).length-1},chars:function(t){return null==t?[]:e(t).split("")},swapCase:function(t){return null==t?"":e(t).replace(/\S/g,function(t){return t===t.toUpperCase()?t.toLowerCase():t.toUpperCase()})},escapeHTML:function(t){return null==t?"":e(t).replace(/[&<>"']/g,function(t){return"&"+c[t]+";"})},unescapeHTML:function(t){return null==t?"":e(t).replace(/\&([^;]+);/g,function(t,i){var s;return i in h?h[i]:(s=i.match(/^#x([\da-fA-F]+)$/))?e.fromCharCode(parseInt(s[1],16)):(s=i.match(/^#(\d+)$/))?e.fromCharCode(~~s[1]):t})},escapeRegExp:function(t){return null==t?"":e(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(t,e,i,s){var n=p.chars(t);return n.splice(~~e,~~i,s),n.join("")},insert:function(t,e,i){return p.splice(t,e,0,i)},include:function(t,i){return""===i?!0:null==t?!1:-1!==e(t).indexOf(i)},join:function(){var t=a.call(arguments),e=t.shift();return null==e&&(e=""),t.join(e)},lines:function(t){return null==t?[]:e(t).split("\n")},reverse:function(t){return p.chars(t).reverse().join("")},startsWith:function(t,i){return""===i?!0:null==t||null==i?!1:(t=e(t),i=e(i),t.length>=i.length&&t.slice(0,i.length)===i)},endsWith:function(t,i){return""===i?!0:null==t||null==i?!1:(t=e(t),i=e(i),t.length>=i.length&&t.slice(t.length-i.length)===i)},succ:function(t){return null==t?"":(t=e(t),t.slice(0,-1)+e.fromCharCode(t.charCodeAt(t.length-1)+1))},titleize:function(t){return null==t?"":e(t).replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},camelize:function(t){return p.trim(t).replace(/[-_\s]+(.)?/g,function(t,e){return e.toUpperCase()})},underscored:function(t){return p.trim(t).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(t){return p.trim(t).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(t){return p.titleize(e(t).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(t){return p.capitalize(p.underscored(t).replace(/_id$/,"").replace(/_/g," "))},trim:function(t,s){return null==t?"":!s&&i?i.call(t):(s=l(s),e(t).replace(new RegExp("^"+s+"+|"+s+"+$","g"),""))},ltrim:function(t,i){return null==t?"":!i&&n?n.call(t):(i=l(i),e(t).replace(new RegExp("^"+i+"+"),""))},rtrim:function(t,i){return null==t?"":!i&&s?s.call(t):(i=l(i),e(t).replace(new RegExp(i+"+$"),""))},truncate:function(t,i,s){return null==t?"":(t=e(t),s=s||"...",i=~~i,t.length>i?t.slice(0,i)+s:t)},prune:function(t,i,s){if(null==t)return"";if(t=e(t),i=~~i,s=null!=s?e(s):"...",t.length<=i)return t;var n=function(t){return t.toUpperCase()!==t.toLowerCase()?"A":" "},o=t.slice(0,i+1).replace(/.(?=\W*\w*$)/g,n);return o=o.slice(o.length-2).match(/\w\w/)?o.replace(/\s*\S+$/,""):p.rtrim(o.slice(0,o.length-1)),(o+s).length>t.length?t:t.slice(0,o.length)+s},words:function(t,e){return p.isBlank(t)?[]:p.trim(t,e).split(e||/\s+/)},pad:function(t,i,s,n){t=null==t?"":e(t),i=~~i;var o=0;switch(s?s.length>1&&(s=s.charAt(0)):s=" ",n){case"right":return o=i-t.length,t+r(s,o);case"both":return o=i-t.length,r(s,Math.ceil(o/2))+t+r(s,Math.floor(o/2));default:return o=i-t.length,r(s,o)+t}},lpad:function(t,e,i){return p.pad(t,e,i)},rpad:function(t,e,i){return p.pad(t,e,i,"right")},lrpad:function(t,e,i){return p.pad(t,e,i,"both")},sprintf:d,vsprintf:function(t,e){return e.unshift(t),d.apply(null,e)},toNumber:function(t,i){if(null==t||""==t)return 0;t=e(t);var s=o(o(t).toFixed(~~i));return 0!==s||t.match(/^0+$/)?s:Number.NaN},numberFormat:function(t,e,i,s){if(isNaN(t)||null==t)return"";t=t.toFixed(~~e),s=s||",";var n=t.split("."),o=n[0],r=n[1]?(i||".")+n[1]:"";return o.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+s)+r},strRight:function(t,i){if(null==t)return"";t=e(t),i=null!=i?e(i):i;var s=i?t.indexOf(i):-1;return~s?t.slice(s+i.length,t.length):t},strRightBack:function(t,i){if(null==t)return"";t=e(t),i=null!=i?e(i):i;var s=i?t.lastIndexOf(i):-1;return~s?t.slice(s+i.length,t.length):t},strLeft:function(t,i){if(null==t)return"";t=e(t),i=null!=i?e(i):i;var s=i?t.indexOf(i):-1;return~s?t.slice(0,s):t},strLeftBack:function(t,e){if(null==t)return"";t+="",e=null!=e?""+e:e;var i=t.lastIndexOf(e);return~i?t.slice(0,i):t},toSentence:function(t,e,i,s){e=e||", ",i=i||" and ";var n=t.slice(),o=n.pop();return t.length>2&&s&&(i=p.rtrim(e)+i),n.length?n.join(e)+i+o:o},toSentenceSerial:function(){var t=a.call(arguments);return t[3]=!0,p.toSentence.apply(p,t)},slugify:function(t){if(null==t)return"";var i="\u0105\xe0\xe1\xe4\xe2\xe3\xe5\xe6\u0107\u0119\xe8\xe9\xeb\xea\xec\xed\xef\xee\u0142\u0144\xf2\xf3\xf6\xf4\xf5\xf8\xf9\xfa\xfc\xfb\xf1\xe7\u017c\u017a",s="aaaaaaaaceeeeeiiiilnoooooouuuunczz",n=new RegExp(l(i),"g");return t=e(t).toLowerCase().replace(n,function(t){var e=i.indexOf(t);return s.charAt(e)||"-"}),p.dasherize(t.replace(/[^\w\s-]/g,""))},surround:function(t,e){return[e,t,e].join("")},quote:function(t){return p.surround(t,'"')},exports:function(){var t={};for(var e in this)this.hasOwnProperty(e)&&!e.match(/^(?:include|contains|reverse)$/)&&(t[e]=this[e]);return t},repeat:function(t,i,s){if(null==t)return"";if(i=~~i,null==s)return r(e(t),i);for(var n=[];i>0;n[--i]=t);return n.join(s)},levenshtein:function(t,i){if(null==t&&null==i)return 0;if(null==t)return e(i).length;if(null==i)return e(t).length;t=e(t),i=e(i);for(var s,n,o=[],r=0;r<=i.length;r++)for(var a=0;a<=t.length;a++)n=r&&a?t.charAt(a-1)===i.charAt(r-1)?s:Math.min(o[a],o[a-1],s)+1:r+a,s=o[a],o[a]=n;return o.pop()}};p.strip=p.trim,p.lstrip=p.ltrim,p.rstrip=p.rtrim,p.center=p.lrpad,p.rjust=p.lpad,p.ljust=p.rpad,p.contains=p.include,p.q=p.quote,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=p),exports._s=p):"function"==typeof define&&define.amd?define("underscore.string",[],function(){return p}):(t._=t._||{},t._.string=t._.str=p)}(this,String),function(){var t,e=this,i=e.Backbone,s=Array.prototype.slice,n=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var o=e._;!o&&"undefined"!=typeof require&&(o=require("underscore"));var r=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){r=t},t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=/\s+/,l=t.Events={on:function(t,e,i){var s,n,o,r,l;if(!e)return this;for(t=t.split(a),s=this._callbacks||(this._callbacks={});n=t.shift();)o=(l=s[n])?l.tail:{},o.next=r={},o.context=i,o.callback=e,s[n]={tail:r,next:l?l.next:o};return this},off:function(t,e,i){var s,n,r,l,h,c;if(n=this._callbacks){if(!t&&!e&&!i)return delete this._callbacks,this;for(t=t?t.split(a):o.keys(n);s=t.shift();)if(r=n[s],delete n[s],r&&(e||i))for(l=r.tail;(r=r.next)!==l;)h=r.callback,c=r.context,(e&&h!==e||i&&c!==i)&&this.on(s,h,c);return this}},trigger:function(t){var e,i,n,o,r,l;if(!(n=this._callbacks))return this;for(r=n.all,t=t.split(a),l=s.call(arguments,1);e=t.shift();){if(i=n[e])for(o=i.tail;(i=i.next)!==o;)i.callback.apply(i.context||this,l);if(i=r)for(o=i.tail,e=[e].concat(l);(i=i.next)!==o;)i.callback.apply(i.context||this,e)}return this}};l.bind=l.on,l.unbind=l.off;var h=t.Model=function(t,e){var i;t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=k(this,"defaults"))&&(t=o.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(h.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;return(e=this._escapedAttributes[t])?e:(e=this.get(t),this._escapedAttributes[t]=o.escape(null==e?"":""+e))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var s,n;if(o.isObject(t)||null==t?(s=t,i=e):(s={},s[t]=e),i||(i={}),!s)return this;if(s instanceof h&&(s=s.attributes),i.unset)for(n in s)s[n]=void 0;if(!this._validate(s,i))return!1;this.idAttribute in s&&(this.id=s[this.idAttribute]);var e=i.changes={},r=this.attributes,a=this._escapedAttributes,l=this._previousAttributes||{};for(n in s)t=s[n],(!o.isEqual(r[n],t)||i.unset&&o.has(r,n))&&(delete a[n],(i.silent?this._silent:e)[n]=!0),i.unset?delete r[n]:r[n]=t,o.isEqual(l[n],t)&&o.has(r,n)==o.has(l,n)?(delete this.changed[n],delete this._pending[n]):(this.changed[n]=t,i.silent||(this._pending[n]=!0));return i.silent||this.change(i),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(e){var e=e?o.clone(e):{},i=this,s=e.success;return e.success=function(t,n,o){return i.set(i.parse(t,o),e)?void(s&&s(i,t)):!1},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i,s){var n,r;if(o.isObject(e)||null==e?(n=e,s=i):(n={},n[e]=i),s=s?o.clone(s):{},s.wait){if(!this._validate(n,s))return!1;r=o.clone(this.attributes)}if(e=o.extend({},s,{silent:!0}),n&&!this.set(n,s.wait?e:s))return!1;var a=this,l=s.success;return s.success=function(t,e,i){return e=a.parse(t,i),s.wait&&(delete s.wait,e=o.extend(n||{},e)),a.set(e,s)?void(l?l(a,t):a.trigger("sync",a,t,s)):!1},s.error=t.wrapError(s.error,a,s),i=this.isNew()?"create":"update",i=(this.sync||t.sync).call(this,i,this,s),s.wait&&this.set(r,e),i},destroy:function(e){var e=e?o.clone(e):{},i=this,s=e.success,n=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return n(),!1;e.success=function(t){e.wait&&n(),s?s(i,t):i.trigger("sync",i,t,e)},e.error=t.wrapError(e.error,i,e);var r=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||n(),r},url:function(){var t=k(this,"urlRoot")||k(this.collection,"url")||P();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var s=o.extend({},t.changes,this._silent);this._silent={};for(i in s)this.trigger("change:"+i,this,this.get(i),t);if(e)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(i in this.changed)!this._pending[i]&&!this._silent[i]&&delete this.changed[i];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?o.has(this.changed,t):!o.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,i,s=!1,n=this._previousAttributes;for(i in t)o.isEqual(n[i],e=t[i])||((s||(s={}))[i]=e);return s},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;var t=o.extend({},this.attributes,t),i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}});var c=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})
};o.extend(c.prototype,l,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var i,s,r,a,l,h={},c={},u=[];for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,s=t.length;s>i;i++){if(!(r=t[i]=this._prepareModel(t[i],e)))throw Error("Can't add an invalid model to a collection");a=r.cid,l=r.id,h[a]||this._byCid[a]||null!=l&&(c[l]||this._byId[l])?u.push(i):h[a]=c[l]=r}for(i=u.length;i--;)t.splice(u[i],1);for(i=0,s=t.length;s>i;i++)(r=t[i]).on("all",this._onModelEvent,this),this._byCid[r.cid]=r,null!=r.id&&(this._byId[r.id]=r);if(this.length+=s,n.apply(this.models,[null!=e.at?e.at:this.models.length,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,s=this.models.length;s>i;i++)h[(r=this.models[i]).cid]&&(e.index=i,r.trigger("add",r,this,e));return this},remove:function(t,e){var i,s,n,r;for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,s=t.length;s>i;i++)(r=this.getByCid(t[i])||this.get(t[i]))&&(delete this._byId[r.id],delete this._byCid[r.cid],n=this.indexOf(r),this.models.splice(n,1),this.length--,e.silent||(e.index=n,r.trigger("remove",r,this,e)),this._removeReference(r));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return o.isEmpty(t)?[]:this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,s=this.models.length;s>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,s=e.success;return e.success=function(t,n,o){i[e.add?"add":"reset"](i.parse(t,o),e),s&&s(i,t)},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this,e=e?o.clone(e):{},t=this._prepareModel(t,e);if(!t)return!1;e.wait||i.add(t,e);var s=e.success;return e.success=function(n,o){e.wait&&i.add(n,e),s?s(n,o):n.trigger("sync",t,o,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){return e||(e={}),t instanceof h?t.collection||(t.collection=this):(e.collection=this,t=new this.model(t,e),t._validate(t.attributes,e)||(t=!1)),t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){("add"==t||"remove"==t)&&i!=this||("destroy"==t&&this.remove(e,s),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}}),o.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(t){c.prototype[t]=function(){return o[t].apply(o,[this.models].concat(o.toArray(arguments)))}});var u=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},d=/:\w+/g,p=/\*\w+/g,f=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(u.prototype,l,{initialize:function(){},route:function(e,i,s){return t.history||(t.history=new m),o.isRegExp(e)||(e=this._routeToRegExp(e)),s||(s=this[i]),t.history.route(e,o.bind(function(n){n=this._extractParameters(e,n),s&&s.apply(this,n),this.trigger.apply(this,["route:"+i].concat(n)),t.history.trigger("route",this,i,n)},this)),this},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t,e=[];for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var i=e.length;i>t;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(t){return t=t.replace(f,"\\$&").replace(d,"([^/]+)").replace(p,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var m=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},g=/^[#\/]/,v=/msie [\w.]+/;m.started=!1,o.extend(m.prototype,l,{interval:50,getHash:function(t){return(t=(t?t.location:window.location).href.match(/#(.*)$/))?t[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){var t=window.location.pathname,i=window.location.search;i&&(t+=i)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(g,"")},start:function(t){if(m.started)throw Error("Backbone.history has already been started");m.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var t=this.getFragment(),e=document.documentMode;return(e=v.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e))&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t,t=window.location,e=t.pathname==this.options.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!e?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&e&&t.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,t.protocol+"//"+t.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!m.started)return!1;e&&!0!==e||(e={trigger:e});var i=(t||"").replace(g,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var b=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,y="model,collection,el,id,attributes,className,tagName".split(",");o.extend(b.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){return t=document.createElement(t),e&&r(t).attr(e),i&&r(t).html(i),t},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof r?t:r(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=k(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(o.isFunction(i)||(i=this[t[e]]),!i)throw Error('Method "'+t[e]+'" does not exist');var s=e.match(_),n=s[1],s=s[2],i=o.bind(i,this),n=n+(".delegateEvents"+this.cid);""===s?this.$el.bind(n,i):this.$el.delegate(s,n,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,i=y.length;i>e;e++){var s=y[e];t[s]&&(this[s]=t[s])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=k(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),h.extend=c.extend=u.extend=b.extend=function(t,e){var i=S(this,t,e);return i.extend=this.extend,i};var w={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var n=w[e];s||(s={});var a={type:n,dataType:"json"};return s.url||(a.url=k(i,"url")||P()),s.data||!i||"create"!=e&&"update"!=e||(a.contentType="application/json",a.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),!t.emulateHTTP||"PUT"!==n&&"DELETE"!==n||(t.emulateJSON&&(a.data._method=n),a.type="POST",a.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",n)}),"GET"!==a.type&&!t.emulateJSON&&(a.processData=!1),r.ajax(o.extend(a,s))},t.wrapError=function(t,e,i){return function(s,n){n=s===e?n:s,t?t(e,n,i):e.trigger("error",e,n,i)}};var x=function(){},S=function(t,e,i){var s;return s=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(s,t),x.prototype=t.prototype,s.prototype=new x,e&&o.extend(s.prototype,e),i&&o.extend(s,i),s.prototype.constructor=s,s.__super__=t.prototype,s},k=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},P=function(){throw Error('A "url" property or function must be specified')}}.call(this),function(t){var e=function(){var e=this;e.version="1.1.1",e.start=function(){e.running||(s(),d(),g(),e.running=!0)},e.stop=function(){e.running&&(clearTimeout(r),p(),e.running=!1)},e.interval=1e3/60,e.threshold=50,e.velocity=2,e.acceleration=.01;var i,s,n,o,r,a,l,h,c,u,d,p,f,m,g,v,b,_=t(window),y=t(document);f=function(t){i={pageX:t.pageX,pageY:t.pageY,x:t.pageX-_.scrollLeft(),y:t.pageY-_.scrollTop()}},m=function(){a={width:_.width(),height:_.height()},l={width:t("body").outerWidth(),height:t("body").outerHeight()},t("body > *").each(function(){l.height=Math.max(l.height,t(this).outerHeight())})},c=function(){var t=i.y<e.threshold,s=_.scrollTop()<=0;if(t&&!s){n||(n=!0,h=new Date);var o=v();_.scrollTop(_.scrollTop()-o),b(0,-o)}else n=!1},u=function(){var t=i.y>a.height-e.threshold,s=_.scrollTop()>=l.height-_.height();if(t&&!s){o||(o=!0,h=new Date);var n=v();_.scrollTop(_.scrollTop()+n),b(0,n)}else o=!1},v=function(){var t=new Date,i=t-h;return Math.round(e.velocity+e.acceleration*i)},b=function(e,s){y.trigger(t.Event("mousemove",{pageX:i.pageX+e,pageY:i.pageY+s}))},g=function(){i&&(c(),u()),r=setTimeout(g,e.interval)},s=function(){delete i,delete n,delete o,delete h},d=function(){y.bind("mousemove",f),y.bind("resize",m),m()},p=function(){y.unbind("mousemove",f),y.unbind("resize",m)}};window.autoscroll=new e}(jQuery),/*
 * jqModal - Minimalist Modaling with jQuery
 *   (http://dev.iceburg.net/jquery/jqModal/)
 *
 * Copyright (c) 2007,2008 Brice Burgess <bhb@iceburg.net>
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 * 
 * $Version: 03/01/2009 +r14
 */
function(t){t.fn.jqm=function(s){var n={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:o,ajaxText:"",target:o,modal:o,toTop:o,onShow:o,onHide:o,onLoad:o};return this.each(function(){return this._jqm?i[this._jqm].c=t.extend({},i[this._jqm].c,s):(e++,this._jqm=e,i[e]={c:t.extend(n,t.jqm.params,s),a:o,w:t(this).addClass("jqmID"+e),s:e},void(n.trigger&&t(this).jqmAddTrigger(n.trigger)))})},t.fn.jqmAddClose=function(t){return u(this,t,"jqmHide")},t.fn.jqmAddTrigger=function(t){return u(this,t,"jqmShow")},t.fn.jqmShow=function(e){return this.each(function(){e=e||window.event,t.jqm.open(this._jqm,e)})},t.fn.jqmHide=function(e){return this.each(function(){e=e||window.event,t.jqm.close(this._jqm,e)})},t.jqm={hash:{},open:function(e,r){var l=i[e],c=l.c,u="."+c.closeClass,d=parseInt(l.w.css("z-index")),d=d>0?d:3e3,p=t("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":d-1,opacity:c.overlay/100});if(l.a)return o;if(l.t=r,l.a=!0,l.w.css("z-index",d),c.modal?(s[0]||h("bind"),s.push(e)):c.overlay>0?l.w.jqmAddClose(p):p=o,l.o=p?p.addClass(c.overlayClass).prependTo("body"):o,n&&(t("html,body").css({height:"100%",width:"100%"}),p)){p=p.css({position:"absolute"})[0];for(var f in{Top:1,Left:1})p.style.setExpression(f.toLowerCase(),"(_=(document.documentElement.scroll"+f+" || document.body.scroll"+f+"))+'px'")}if(c.ajax){var m=c.target||l.w,g=c.ajax,m="string"==typeof m?t(m,l.w):t(m),g="@"==g.substr(0,1)?t(r).attr(g.substring(1)):g;m.html(c.ajaxText).load(g,function(){c.onLoad&&c.onLoad.call(this,l),u&&l.w.jqmAddClose(t(u,l.w)),a(l)})}else u&&l.w.jqmAddClose(t(u,l.w));return c.toTop&&l.o&&l.w.before('<span id="jqmP'+l.w[0]._jqm+'"></span>').insertAfter(l.o),c.onShow?c.onShow(l):l.w.show(),a(l),o},close:function(e){var n=i[e];return n.a?(n.a=o,s[0]&&(s.pop(),s[0]||h("unbind")),n.c.toTop&&n.o&&t("#jqmP"+n.w[0]._jqm).after(n.w).remove(),n.c.onHide?n.c.onHide(n):(n.w.hide(),n.o&&n.o.remove()),o):o},params:{}};var e=0,i=t.jqm.hash,s=[],n=t.browser.msie&&"6.0"==t.browser.version,o=!1,r=t('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),a=function(e){n&&(e.o?e.o.html('<p style="width:100%;height:100%"/>').prepend(r):t("iframe.jqm",e.w)[0]||e.w.prepend(r)),l(e)},l=function(e){try{t(":input:visible",e.w)[0].focus()}catch(i){}},h=function(e){t()[e]("keypress",c)[e]("keydown",c)[e]("mousedown",c)},c=function(e){var n=i[s[s.length-1]],o=!t(e.target).parents(".jqmID"+n.s)[0];return o&&l(n),!o},u=function(e,s,n){return e.each(function(){var e=this._jqm;t(s).each(function(){this[n]||(this[n]=[],t(this).click(function(){for(var t in{jqmShow:1,jqmHide:1})for(var e in this[t])i[this[t][e]]&&i[this[t][e]].w[t](this);return o})),this[n].push(e)})})}}(jQuery),/*!
 * jQuery UI 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
function(t,e){function i(e,i){var n=e.nodeName.toLowerCase();return"area"===n?(i=e.parentNode,n=i.name,e.href&&n&&"map"===i.nodeName.toLowerCase()?(e=t("img[usemap=#"+n+"]")[0],!!e&&s(e)):!1):(/input|select|textarea|button|object/.test(n)?!e.disabled:"a"==n?e.href||i:i)&&s(e)}function s(e){return!t(e).parents().andSelf().filter(function(){return"hidden"===t.curCSS(this,"visibility")||t.expr.filters.hidden(this)}).length}t.ui=t.ui||{},t.ui.version||(t.extend(t.ui,{version:"1.8.14",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),t.fn.extend({_focus:t.fn.focus,focus:function(e,i){return"number"==typeof e?this.each(function(){var s=this;setTimeout(function(){t(s).focus(),i&&i.call(s)},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.curCSS(this,"position",1))&&/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length){i=t(this[0]);for(var s;i.length&&i[0]!==document;){if(s=i.css("position"),("absolute"===s||"relative"===s||"fixed"===s)&&(s=parseInt(i.css("zIndex"),10),!isNaN(s)&&0!==s))return s;i=i.parent()}}return 0},disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.each(["Width","Height"],function(i,s){function n(e,i,s,n){return t.each(o,function(){i-=parseFloat(t.curCSS(e,"padding"+this,!0))||0,s&&(i-=parseFloat(t.curCSS(e,"border"+this+"Width",!0))||0),n&&(i-=parseFloat(t.curCSS(e,"margin"+this,!0))||0)}),i}var o="Width"===s?["Left","Right"]:["Top","Bottom"],r=s.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+s]=function(i){return i===e?a["inner"+s].call(this):this.each(function(){t(this).css(r,n(this,i)+"px")})},t.fn["outer"+s]=function(e,i){return"number"!=typeof e?a["outer"+s].call(this,e):this.each(function(){t(this).css(r,n(this,e,!0,i)+"px")})}}),t.extend(t.expr[":"],{data:function(e,i,s){return!!t.data(e,s[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var s=t.attr(e,"tabindex"),n=isNaN(s);return(n||s>=0)&&i(e,!n)}}),t(function(){var e=document.body,i=e.appendChild(i=document.createElement("div"));t.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),t.support.minHeight=100===i.offsetHeight,t.support.selectstart="onselectstart"in i,e.removeChild(i).style.display="none"}),t.extend(t.ui,{plugin:{add:function(e,i,s){e=t.ui[e].prototype;for(var n in s)e.plugins[n]=e.plugins[n]||[],e.plugins[n].push([i,s[n]])},call:function(t,e,i){if((e=t.plugins[e])&&t.element[0].parentNode)for(var s=0;s<e.length;s++)t.options[e[s][0]]&&e[s][1].apply(t.element,i)}},contains:function(t,e){return document.compareDocumentPosition?16&t.compareDocumentPosition(e):t!==e&&t.contains(e)},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;i=i&&"left"===i?"scrollLeft":"scrollTop";var s=!1;return e[i]>0?!0:(e[i]=1,s=e[i]>0,e[i]=0,s)},isOverAxis:function(t,e,i){return t>e&&e+i>t},isOver:function(e,i,s,n,o,r){return t.ui.isOverAxis(e,s,o)&&t.ui.isOverAxis(i,n,r)}}))}(jQuery),/*!
 * jQuery UI Widget 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function(t,e){if(t.cleanData){var i=t.cleanData;t.cleanData=function(e){for(var s,n=0;null!=(s=e[n]);n++)t(s).triggerHandler("remove");i(e)}}else{var s=t.fn.remove;t.fn.remove=function(e,i){return this.each(function(){return i||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){t(this).triggerHandler("remove")}),s.call(t(this),e,i)})}}t.widget=function(e,i,s){var n,o=e.split(".")[0];e=e.split(".")[1],n=o+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][n]=function(i){return!!t.data(i,e)},t[o]=t[o]||{},t[o][e]=function(t,e){arguments.length&&this._createWidget(t,e)},i=new i,i.options=t.extend(!0,{},i.options),t[o][e].prototype=t.extend(!0,i,{namespace:o,widgetName:e,widgetEventPrefix:t[o][e].prototype.widgetEventPrefix||e,widgetBaseClass:n},s),t.widget.bridge(e,t[o][e])},t.widget.bridge=function(i,s){t.fn[i]=function(n){var o="string"==typeof n,r=Array.prototype.slice.call(arguments,1),a=this;return n=!o&&r.length?t.extend.apply(null,[!0,n].concat(r)):n,o&&"_"===n.charAt(0)?a:(this.each(o?function(){var s=t.data(this,i),o=s&&t.isFunction(s[n])?s[n].apply(s,r):s;return o!==s&&o!==e?(a=o,!1):void 0}:function(){var e=t.data(this,i);e?e.option(n||{})._init():t.data(this,i,new s(n,this))}),a)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,i){t.data(i,this.widgetName,this),this.element=t(i),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var s=this;this.element.bind("remove."+this.widgetName,function(){s.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,s){var n=i;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof i){if(s===e)return this.options[i];n={},n[i]=s}return this._setOptions(n),this},_setOptions:function(e){var i=this;return t.each(e,function(t,e){i._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,i,s){var n=this.options[e];if(i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),s=s||{},i.originalEvent){e=t.event.props.length;for(var o;e;)o=t.event.props[--e],i[o]=i.originalEvent[o]}return this.element.trigger(i,s),!(t.isFunction(n)&&n.call(this.element[0],i,s)===!1||i.isDefaultPrevented())}}}(jQuery),/*!
 * jQuery UI Mouse 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
function(t){var e=!1;t(document).mousedown(function(){e=!1}),t.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,n=1==i.which,o="string"==typeof this.options.cancel?t(i.target).closest(this.options.cancel).length:!1;return n&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return s._mouseMove(t)},this._mouseUpDelegate=function(t){return s._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1)?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),/*
 * jQuery UI Position 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
function(t){t.ui=t.ui||{};var e=/left|center|right/,i=/top|center|bottom/,s=t.fn.position,n=t.fn.offset;t.fn.position=function(n){if(!n||!n.of)return s.apply(this,arguments);n=t.extend({},n);var o,r,a,l=t(n.of),h=l[0],c=(n.collision||"flip").split(" "),u=n.offset?n.offset.split(" "):[0,0];return 9===h.nodeType?(o=l.width(),r=l.height(),a={top:0,left:0}):h.setTimeout?(o=l.width(),r=l.height(),a={top:l.scrollTop(),left:l.scrollLeft()}):h.preventDefault?(n.at="left top",o=r=0,a={top:n.of.pageY,left:n.of.pageX}):(o=l.outerWidth(),r=l.outerHeight(),a=l.offset()),t.each(["my","at"],function(){var t=(n[this]||"").split(" ");1===t.length&&(t=e.test(t[0])?t.concat(["center"]):i.test(t[0])?["center"].concat(t):["center","center"]),t[0]=e.test(t[0])?t[0]:"center",t[1]=i.test(t[1])?t[1]:"center",n[this]=t}),1===c.length&&(c[1]=c[0]),u[0]=parseInt(u[0],10)||0,1===u.length&&(u[1]=u[0]),u[1]=parseInt(u[1],10)||0,"right"===n.at[0]?a.left+=o:"center"===n.at[0]&&(a.left+=o/2),"bottom"===n.at[1]?a.top+=r:"center"===n.at[1]&&(a.top+=r/2),a.left+=u[0],a.top+=u[1],this.each(function(){var e,i=t(this),s=i.outerWidth(),l=i.outerHeight(),h=parseInt(t.curCSS(this,"marginLeft",!0))||0,d=parseInt(t.curCSS(this,"marginTop",!0))||0,p=s+h+(parseInt(t.curCSS(this,"marginRight",!0))||0),f=l+d+(parseInt(t.curCSS(this,"marginBottom",!0))||0),m=t.extend({},a);"right"===n.my[0]?m.left-=s:"center"===n.my[0]&&(m.left-=s/2),"bottom"===n.my[1]?m.top-=l:"center"===n.my[1]&&(m.top-=l/2),m.left=Math.round(m.left),m.top=Math.round(m.top),e={left:m.left-h,top:m.top-d},t.each(["left","top"],function(i,a){t.ui.position[c[i]]&&t.ui.position[c[i]][a](m,{targetWidth:o,targetHeight:r,elemWidth:s,elemHeight:l,collisionPosition:e,collisionWidth:p,collisionHeight:f,offset:u,my:n.my,at:n.at})}),t.fn.bgiframe&&i.bgiframe(),i.offset(t.extend(m,{using:n.using}))})},t.ui.position={fit:{left:function(e,i){var s=t(window);s=i.collisionPosition.left+i.collisionWidth-s.width()-s.scrollLeft(),e.left=s>0?e.left-s:Math.max(e.left-i.collisionPosition.left,e.left)},top:function(e,i){var s=t(window);s=i.collisionPosition.top+i.collisionHeight-s.height()-s.scrollTop(),e.top=s>0?e.top-s:Math.max(e.top-i.collisionPosition.top,e.top)}},flip:{left:function(e,i){if("center"!==i.at[0]){var s=t(window);s=i.collisionPosition.left+i.collisionWidth-s.width()-s.scrollLeft();var n="left"===i.my[0]?-i.elemWidth:"right"===i.my[0]?i.elemWidth:0,o="left"===i.at[0]?i.targetWidth:-i.targetWidth,r=-2*i.offset[0];e.left+=i.collisionPosition.left<0?n+o+r:s>0?n+o+r:0}},top:function(e,i){if("center"!==i.at[1]){var s=t(window);s=i.collisionPosition.top+i.collisionHeight-s.height()-s.scrollTop();var n="top"===i.my[1]?-i.elemHeight:"bottom"===i.my[1]?i.elemHeight:0,o="top"===i.at[1]?i.targetHeight:-i.targetHeight,r=-2*i.offset[1];e.top+=i.collisionPosition.top<0?n+o+r:s>0?n+o+r:0}}}},t.offset.setOffset||(t.offset.setOffset=function(e,i){/static/.test(t.curCSS(e,"position"))&&(e.style.position="relative");var s=t(e),n=s.offset(),o=parseInt(t.curCSS(e,"top",!0),10)||0,r=parseInt(t.curCSS(e,"left",!0),10)||0;n={top:i.top-n.top+o,left:i.left-n.left+r},"using"in i?i.using.call(e,n):s.css(n)},t.fn.offset=function(e){var i=this[0];return i&&i.ownerDocument?e?this.each(function(){t.offset.setOffset(this,e)}):n.call(this):null})}(jQuery),/*
 * jQuery UI Draggable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.draggable",t.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){if(i=this._uiHash(),this._trigger("drag",e,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=!1;if(t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var s=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",e)!==!1&&s._clear()})}else this._trigger("stop",e)!==!1&&this._clear();return!1},_mouseUp:function(e){return this.options.iframeFix===!0&&t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var i=this.options.handle&&t(this.options.handle,this.element).length?!1:!0;return t(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(i=!0)}),i},_createHelper:function(e){var i=this.options;return e=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element,e.parents("body").length||e.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),e[0]!=this.element[0]&&!/(fixed|absolute)/.test(e.css("position"))&&e.css("position","absolute"),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=["document"==e.containment?0:t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==e.containment?0:t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{e=t(e.containment);var i=e[0];if(i){e.offset();var s="hidden"!=t(i).css("overflow");this.containment=[(parseInt(t(i).css("borderLeftWidth"),10)||0)+(parseInt(t(i).css("paddingLeft"),10)||0),(parseInt(t(i).css("borderTopWidth"),10)||0)+(parseInt(t(i).css("paddingTop"),10)||0),(s?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t(i).css("borderLeftWidth"),10)||0)-(parseInt(t(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t(i).css("borderTopWidth"),10)||0)-(parseInt(t(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=e}}},_convertPositionTo:function(e,i){i||(i=this.position),e="absolute"==e?1:-1;var s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*e+this.offset.parent.top*e-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop())*e),left:i.left+this.offset.relative.left*e+this.offset.parent.left*e-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())*e)}},_generatePosition:function(e){var i=this.options,s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName),o=e.pageX,r=e.pageY;if(this.originalPosition){var a;this.containment&&(this.relative_container?(a=this.relative_container.offset(),a=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]):a=this.containment,e.pageX-this.offset.click.left<a[0]&&(o=a[0]+this.offset.click.left),e.pageY-this.offset.click.top<a[1]&&(r=a[1]+this.offset.click.top),e.pageX-this.offset.click.left>a[2]&&(o=a[2]+this.offset.click.left),e.pageY-this.offset.click.top>a[3]&&(r=a[3]+this.offset.click.top)),i.grid&&(r=i.grid[1]?this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY,r=a&&(r-this.offset.click.top<a[1]||r-this.offset.click.top>a[3])?r-this.offset.click.top<a[1]?r+i.grid[1]:r-i.grid[1]:r,o=i.grid[0]?this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX,o=a&&(o-this.offset.click.left<a[0]||o-this.offset.click.left>a[2])?o-this.offset.click.left<a[0]?o+i.grid[0]:o-i.grid[0]:o)}return{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.extend(t.ui.draggable,{version:"1.8.14"}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var s=t(this).data("draggable"),n=s.options,o=t.extend({},i,{item:s.element});s.sortables=[],t(n.connectToSortable).each(function(){var i=t.data(this,"sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,o))})},stop:function(e,i){var s=t(this).data("draggable"),n=t.extend({},i,{item:s.element});t.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(e,i){var s=t(this).data("draggable"),n=this;t.each(s.sortables,function(){this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(n).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",e),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",e),s.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){e=t(i.helper),i=t(this).data("draggable").options,e.css("opacity")&&(i._opacity=e.css("opacity")),e.css("opacity",i.opacity)},stop:function(e,i){e=t(this).data("draggable").options,e._opacity&&t(i.helper).css("opacity",e._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("draggable");e.scrollParent[0]!=document&&"HTML"!=e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("draggable"),s=i.options,n=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(s.axis&&"x"==s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"==s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"==s.axis||(e.pageY-t(document).scrollTop()<s.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"==s.axis||(e.pageX-t(document).scrollLeft()<s.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=t(this),s=i.offset();this!=e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(e,i){for(var s=t(this).data("draggable"),n=s.options,o=n.snapTolerance,r=i.offset.left,a=r+s.helperProportions.width,l=i.offset.top,h=l+s.helperProportions.height,c=s.snapElements.length-1;c>=0;c--){var u=s.snapElements[c].left,d=u+s.snapElements[c].width,p=s.snapElements[c].top,f=p+s.snapElements[c].height;if(r>u-o&&d+o>r&&l>p-o&&f+o>l||r>u-o&&d+o>r&&h>p-o&&f+o>h||a>u-o&&d+o>a&&l>p-o&&f+o>l||a>u-o&&d+o>a&&h>p-o&&f+o>h){if("inner"!=n.snapMode){var m=Math.abs(p-h)<=o,g=Math.abs(f-l)<=o,v=Math.abs(u-a)<=o,b=Math.abs(d-r)<=o;m&&(i.position.top=s._convertPositionTo("relative",{top:p-s.helperProportions.height,left:0}).top-s.margins.top),g&&(i.position.top=s._convertPositionTo("relative",{top:f,left:0}).top-s.margins.top),v&&(i.position.left=s._convertPositionTo("relative",{top:0,left:u-s.helperProportions.width}).left-s.margins.left),b&&(i.position.left=s._convertPositionTo("relative",{top:0,left:d}).left-s.margins.left)}var _=m||g||v||b;"outer"!=n.snapMode&&(m=Math.abs(p-l)<=o,g=Math.abs(f-h)<=o,v=Math.abs(u-r)<=o,b=Math.abs(d-a)<=o,m&&(i.position.top=s._convertPositionTo("relative",{top:p,left:0}).top-s.margins.top),g&&(i.position.top=s._convertPositionTo("relative",{top:f-s.helperProportions.height,left:0}).top-s.margins.top),v&&(i.position.left=s._convertPositionTo("relative",{top:0,left:u}).left-s.margins.left),b&&(i.position.left=s._convertPositionTo("relative",{top:0,left:d-s.helperProportions.width}).left-s.margins.left)),!s.snapElements[c].snapping&&(m||g||v||b||_)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=m||g||v||b||_}else s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(){var e=t(this).data("draggable").options;if(e=t.makeArray(t(e.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)}),e.length){var i=parseInt(e[0].style.zIndex)||0;t(e).each(function(t){this.style.zIndex=i+t}),this[0].style.zIndex=i+e.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){e=t(i.helper),i=t(this).data("draggable").options,e.css("zIndex")&&(i._zIndex=e.css("zIndex")),e.css("zIndex",i.zIndex)},stop:function(e,i){e=t(this).data("draggable").options,e._zIndex&&t(i.helper).css("zIndex",e._zIndex)}})}(jQuery),/*
 * jQuery UI Droppable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Droppables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.mouse.js
 *	jquery.ui.draggable.js
 */
function(t){t.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var e=this.options,i=e.accept;this.isover=0,this.isout=1,this.accept=t.isFunction(i)?i:function(t){return t.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},t.ui.ddmanager.droppables[e.scope]=t.ui.ddmanager.droppables[e.scope]||[],t.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var e=t.ui.ddmanager.droppables[this.options.scope],i=0;i<e.length;i++)e[i]==this&&e.splice(i,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(e,i){"accept"==e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current;if(!s||(s.currentItem||s.element)[0]==this.element[0])return!1;var n=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope==s.options.scope&&e.accept.call(e.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.extend(t.ui.droppable,{version:"1.8.14"}),t.ui.intersect=function(e,i,s){if(!i.offset)return!1;var n=(e.positionAbs||e.position.absolute).left,o=n+e.helperProportions.width,r=(e.positionAbs||e.position.absolute).top,a=r+e.helperProportions.height,l=i.offset.left,h=l+i.proportions.width,c=i.offset.top,u=c+i.proportions.height;switch(s){case"fit":return n>=l&&h>=o&&r>=c&&u>=a;case"intersect":return l<n+e.helperProportions.width/2&&o-e.helperProportions.width/2<h&&c<r+e.helperProportions.height/2&&a-e.helperProportions.height/2<u;case"pointer":return t.ui.isOver((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,c,l,i.proportions.height,i.proportions.width);case"touch":return(r>=c&&u>=r||a>=c&&u>=a||c>r&&a>u)&&(n>=l&&h>=n||o>=l&&h>=o||l>n&&o>h);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s=t.ui.ddmanager.droppables[e.options.scope]||[],n=i?i.type:null,o=(e.currentItem||e.element).find(":data(droppable)").andSelf(),r=0;t:for(;r<s.length;r++)if(!(s[r].options.disabled||e&&!s[r].accept.call(s[r].element[0],e.currentItem||e.element))){for(var a=0;a<o.length;a++)if(o[a]==s[r].element[0]){s[r].proportions.height=0;continue t}s[r].visible="none"!=s[r].element.css("display"),s[r].visible&&("mousedown"==n&&s[r]._activate.call(s[r],i),s[r].offset=s[r].element.offset(),s[r].proportions={width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight})}},drop:function(e,i){var s=!1;return t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(s=s||this._drop.call(this,i)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s=t.ui.intersect(e,this,this.options.tolerance);if(s=s||1!=this.isover?s&&0==this.isover?"isover":null:"isout"){var n;if(this.options.greedy){var o=this.element.parents(":data(droppable):eq(0)");o.length&&(n=t.data(o[0],"droppable"),n.greedyChild="isover"==s?1:0)}n&&"isover"==s&&(n.isover=0,n.isout=1,n._out.call(n,i)),this[s]=1,this["isout"==s?"isover":"isout"]=0,this["isover"==s?"_over":"_out"].call(this,i),n&&"isout"==s&&(n.isout=0,n.isover=1,n._over.call(n,i))}}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}}(jQuery),/*
 * jQuery UI Resizable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.resizable",t.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var e=this,i=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&t.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(t('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var s=this.handles.split(",");this.handles={};for(var n=0;n<s.length;n++){var o=t.trim(s[n]),r=t('<div class="ui-resizable-handle ui-resizable-'+o+'"></div>');/sw|se|ne|nw/.test(o)&&r.css({zIndex:++i.zIndex}),"se"==o&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[o]=".ui-resizable-"+o,this.element.append(r)}}this._renderAxis=function(e){e=e||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var s=t(this.handles[i],this.element),n=0;n=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),s=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(s,n),this._proportionallyResize()}t(this.handles[i])}},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!e.resizing){if(this.className)var t=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);e.axis=t&&t[1]?t[1]:"se"}}),i.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").hover(function(){i.disabled||(t(this).removeClass("ui-resizable-autohide"),e._handles.show())},function(){i.disabled||e.resizing||(t(this).addClass("ui-resizable-autohide"),e._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var e=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var i=this.element;i.after(this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),e(this.originalElement),this},_mouseCapture:function(e){var i=!1;for(var s in this.handles)t(this.handles[s])[0]==e.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var s=this.options,n=this.element.position(),o=this.element;this.resizing=!0,this.documentScroll={top:t(document).scrollTop(),left:t(document).scrollLeft()},(o.is(".ui-draggable")||/absolute/.test(o.css("position")))&&o.css({position:"absolute",top:n.top,left:n.left}),t.browser.opera&&/relative/.test(o.css("position"))&&o.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy(),n=e(this.helper.css("left"));var r=e(this.helper.css("top"));return s.containment&&(n+=t(s.containment).scrollLeft()||0,r+=t(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"==s?this.axis+"-resize":s),o.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(t){var e=this.helper,i=this.originalMousePosition,s=this._change[this.axis];return s?(i=s.apply(this,[t,t.pageX-i.left||0,t.pageY-i.top||0]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._propagate("resize",t),e.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(i),this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i=this.options,s=this;if(this._helper){var n=this._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName);n=o&&t.ui.hasScroll(n[0],"left")?0:s.sizeDiff.height,o=o?0:s.sizeDiff.width,o={width:s.helper.width()-o,height:s.helper.height()-n},n=parseInt(s.element.css("left"),10)+(s.position.left-s.originalPosition.left)||null;var r=parseInt(s.element.css("top"),10)+(s.position.top-s.originalPosition.top)||null;i.animate||this.element.css(t.extend(o,{top:r,left:n})),s.helper.height(s.size.height),s.helper.width(s.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,s,n,o=this.options;o={minWidth:i(o.minWidth)?o.minWidth:0,maxWidth:i(o.maxWidth)?o.maxWidth:1/0,minHeight:i(o.minHeight)?o.minHeight:0,maxHeight:i(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||t)&&(t=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,e=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),s>o.minHeight&&(o.minHeight=s),e<o.maxWidth&&(o.maxWidth=e),n<o.maxHeight&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,s=this.size,n=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"==n&&(t.left=e.left+(s.width-t.width),t.top=null),"nw"==n&&(t.top=e.top+(s.height-t.height),t.left=e.left+(s.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,s=this.axis,n=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,o=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,r=i(t.width)&&e.minWidth&&e.minWidth>t.width,a=i(t.height)&&e.minHeight&&e.minHeight>t.height;r&&(t.width=e.minWidth),a&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),o&&(t.height=e.maxHeight);var l=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,c=/sw|nw|w/.test(s);return s=/nw|ne|n/.test(s),r&&c&&(t.left=l-e.minWidth),n&&c&&(t.left=l-e.maxWidth),a&&s&&(t.top=h-e.minHeight),o&&s&&(t.top=h-e.maxHeight),(e=!t.width&&!t.height)&&!t.left&&t.top?t.top=null:e&&!t.top&&t.left&&(t.left=null),t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++){var s=this._proportionallyResizeElements[i];if(!this.borderDif){var n=[s.css("borderTopWidth"),s.css("borderRightWidth"),s.css("borderBottomWidth"),s.css("borderLeftWidth")],o=[s.css("paddingTop"),s.css("paddingRight"),s.css("paddingBottom"),s.css("paddingLeft")];this.borderDif=t.map(n,function(t,e){return t=parseInt(t,10)||0,e=parseInt(o[e],10)||0,t+e})}t.browser.msie&&(t(e).is(":hidden")||t(e).parents(":hidden").length)||s.css({height:e.height()-this.borderDif[0]-this.borderDif[2]||0,width:e.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e=this.options;if(this.elementOffset=this.element.offset(),this._helper){this.helper=this.helper||t('<div style="overflow:hidden;"></div>');var i=t.browser.msie&&t.browser.version<7,s=i?1:0;i=i?2:-1,this.helper.addClass(this._helper).css({width:this.element.outerWidth()+i,height:this.element.outerHeight()+i,position:"absolute",left:this.elementOffset.left-s+"px",top:this.elementOffset.top-s+"px",zIndex:++e.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){return{left:this.originalPosition.left+e,width:this.originalSize.width-e}},n:function(t,e,i){return{top:this.originalPosition.top+i,height:this.originalSize.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!=e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.extend(t.ui.resizable,{version:"1.8.14"}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("resizable").options,i=function(e){t(e).each(function(){var e=t(this);e.data("resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10),position:e.css("position")})})};"object"!=typeof e.alsoResize||e.alsoResize.parentNode?i(e.alsoResize):e.alsoResize.length?(e.alsoResize=e.alsoResize[0],i(e.alsoResize)):t.each(e.alsoResize,function(t){i(t)})},resize:function(e,i){var s=t(this).data("resizable");e=s.options;var n=s.originalSize,o=s.originalPosition,r={height:s.size.height-n.height||0,width:s.size.width-n.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},a=function(e,n){t(e).each(function(){var e=t(this),o=t(this).data("resizable-alsoresize"),a={},l=n&&n.length?n:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(l,function(t,e){(t=(o[e]||0)+(r[e]||0))&&t>=0&&(a[e]=t||null)}),t.browser.opera&&/relative/.test(e.css("position"))&&(s._revertToRelativePosition=!0,e.css({position:"absolute",top:"auto",left:"auto"})),e.css(a)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?a(e.alsoResize):t.each(e.alsoResize,function(t,e){a(t,e)})},stop:function(){var e=t(this).data("resizable"),i=e.options,s=function(e){t(e).each(function(){var e=t(this);e.css({position:e.data("resizable-alsoresize").position})})};e._revertToRelativePosition&&(e._revertToRelativePosition=!1,"object"!=typeof i.alsoResize||i.alsoResize.nodeType?s(i.alsoResize):t.each(i.alsoResize,function(t){s(t)})),t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("resizable"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),r=o&&t.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height;o={width:i.size.width-(o?0:i.sizeDiff.width),height:i.size.height-r},r=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null;var a=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(o,a&&r?{top:a,left:r}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i=t(this).data("resizable"),s=i.element,n=i.options.containment;if(s=n instanceof t?n.get(0):/parent/.test(n)?s.parent().get(0):n)if(i.containerElement=t(s),/document/.test(n)||n==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight};else{var o=t(s),r=[];t(["Top","Right","Left","Bottom"]).each(function(t,i){r[t]=e(o.css("padding"+i))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-r[3],width:o.innerWidth()-r[1]},n=i.containerOffset;var a=i.containerSize.height,l=i.containerSize.width;l=t.ui.hasScroll(s,"left")?s.scrollWidth:l,a=t.ui.hasScroll(s)?s.scrollHeight:a,i.parentData={element:s,left:n.left,top:n.top,width:l,height:a}}},resize:function(e){var i=t(this).data("resizable"),s=i.options,n=i.containerOffset,o=i.position;e=i._aspectRatio||e.shiftKey;var r={top:0,left:0},a=i.containerElement;a[0]!=document&&/static/.test(a.css("position"))&&(r=n),o.left<(i._helper?n.left:0)&&(i.size.width+=i._helper?i.position.left-n.left:i.position.left-r.left,e&&(i.size.height=i.size.width/s.aspectRatio),i.position.left=s.helper?n.left:0),o.top<(i._helper?n.top:0)&&(i.size.height+=i._helper?i.position.top-n.top:i.position.top,e&&(i.size.width=i.size.height*s.aspectRatio),i.position.top=i._helper?n.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top,s=Math.abs((i._helper?i.offset.left-r.left:i.offset.left-r.left)+i.sizeDiff.width),n=Math.abs((i._helper?i.offset.top-r.top:i.offset.top-n.top)+i.sizeDiff.height),o=i.containerElement.get(0)==i.element.parent().get(0),r=/relative|absolute/.test(i.containerElement.css("position")),o&&r&&(s-=i.parentData.left),s+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-s,e&&(i.size.height=i.size.width/i.aspectRatio)),n+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-n,e&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var e=t(this).data("resizable"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,r=t(e.helper),a=r.offset(),l=r.outerWidth()-e.sizeDiff.width;r=r.outerHeight()-e.sizeDiff.height,e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:a.left-n.left-s.left,width:l,height:r}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:a.left-n.left-s.left,width:l,height:r})}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("resizable"),i=e.options,s=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("resizable"),i=e.options,s=e.size,n=e.originalSize,o=e.originalPosition,r=e.axis;i.grid="number"==typeof i.grid?[i.grid,i.grid]:i.grid;var a=Math.round((s.width-n.width)/(i.grid[0]||1))*(i.grid[0]||1);i=Math.round((s.height-n.height)/(i.grid[1]||1))*(i.grid[1]||1),/^(se|s|e)$/.test(r)?(e.size.width=n.width+a,e.size.height=n.height+i):/^(ne)$/.test(r)?(e.size.width=n.width+a,e.size.height=n.height+i,e.position.top=o.top-i):(/^(sw)$/.test(r)?(e.size.width=n.width+a,e.size.height=n.height+i):(e.size.width=n.width+a,e.size.height=n.height+i,e.position.top=o.top-i),e.position.left=o.left-a)}});var e=function(t){return parseInt(t,10)||0},i=function(t){return!isNaN(parseInt(t,10))}}(jQuery),/*
 * jQuery UI Selectable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Selectables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.selectable",t.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var e=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=t(e.options.filter,e.element[0]),i.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(e){var i=this;if(this.opos=[e.pageX,e.pageY],!this.options.disabled){var s=this.options;this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.clientX,top:e.clientY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().andSelf().each(function(){var s=t.data(this,"selectable-item");if(s){var n=!e.metaKey||!s.$element.hasClass("ui-selected");return s.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),s.unselecting=!n,s.selecting=n,(s.selected=n)?i._trigger("selecting",e,{selecting:s.element}):i._trigger("unselecting",e,{unselecting:s.element}),!1}})}},_mouseDrag:function(e){var i=this;if(this.dragged=!0,!this.options.disabled){var s=this.options,n=this.opos[0],o=this.opos[1],r=e.pageX,a=e.pageY;if(n>r){var l=r;r=n,n=l}return o>a&&(l=a,a=o,o=l),this.helper.css({left:n,top:o,width:r-n,height:a-o}),this.selectees.each(function(){var l=t.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var h=!1;"touch"==s.tolerance?h=!(l.left>r||l.right<n||l.top>a||l.bottom<o):"fit"==s.tolerance&&(h=l.left>n&&l.right<r&&l.top>o&&l.bottom<a),h?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",e,{selecting:l.element}))):(l.selecting&&(e.metaKey&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",e,{unselecting:l.element}))),l.selected&&(e.metaKey||l.startselected||(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",e,{unselecting:l.element}))))}}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.extend(t.ui.selectable,{version:"1.8.14"})}(jQuery),/*
 * jQuery UI Sortable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.sortable",t.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData("sortable-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget()[i?"addClass":"removeClass"]("ui-sortable-disabled")):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(e);var s=null,n=this;if(t(e.target).parents().each(function(){return t.data(this,"sortable-item")==n?(s=t(this),!1):void 0}),t.data(e.target,"sortable-item")==n&&(s=t(e.target)),!s)return!1;if(this.options.handle&&!i){var o=!1;if(t(this.options.handle,s).find("*").andSelf().each(function(){this==e.target&&(o=!0)}),!o)return!1}return this.currentItem=s,this._removeCurrentsFromItems(),!0},_mouseStart:function(e,i,s){i=this.options;var n=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(t("body").css("cursor")&&(this._storedCursor=t("body").css("cursor")),t("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",e,n._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,s=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(e.pageY-t(document).scrollTop()<i.scrollSensitivity?s=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(s=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed)),e.pageX-t(document).scrollLeft()<i.scrollSensitivity?s=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(s=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed))),s!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)}for(this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--){s=this.items[i];var n=s.item[0],o=this._intersectsWithPointer(s);if(o&&n!=this.currentItem[0]&&this.placeholder[1==o?"next":"prev"]()[0]!=n&&!t.ui.contains(this.placeholder[0],n)&&("semi-dynamic"==this.options.type?!t.ui.contains(this.element[0],n):!0)){if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this;i=s.placeholder.offset(),s.reverting=!0,t(this.helper).animate({left:i.left-this.offset.parent.left-s.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-s.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){var e=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,e._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,e._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,r=o+t.width,a=t.top,l=a+t.height,h=this.offset.click.top,c=this.offset.click.left;return h=s+h>a&&l>s+h&&e+c>o&&r>e+c,"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?h:o<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<r&&a<s+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var i=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height);e=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=i&&e,e=this._getDragVerticalDirection();var s=this._getDragHorizontalDirection();return i?this.floating?s&&"right"==s||"down"==e?2:1:e&&("down"==e?2:1):!1},_intersectsWithSides:function(e){var i=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height);e=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width);var s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"==n&&e||"left"==n&&!e:s&&("down"==s&&i||"up"==s&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor==String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i=[],s=[],n=this._connectWith();if(n&&e)for(e=n.length-1;e>=0;e--)for(var o=t(n[e]),r=o.length-1;r>=0;r--){var a=t.data(o[r],"sortable");a&&a!=this&&!a.options.disabled&&s.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}for(s.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),e=s.length-1;e>=0;e--)s[e][0].each(function(){i.push(this)});return t(i)},_removeCurrentsFromItems:function(){for(var t=this.currentItem.find(":data(sortable-item)"),e=0;e<this.items.length;e++)for(var i=0;i<t.length;i++)t[i]==this.items[e].item[0]&&this.items.splice(e,1)},_refreshItems:function(e){this.items=[],this.containers=[this];var i=this.items,s=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],n=this._connectWith();if(n)for(var o=n.length-1;o>=0;o--)for(var r=t(n[o]),a=r.length-1;a>=0;a--){var l=t.data(r[a],"sortable");l&&l!=this&&!l.options.disabled&&(s.push([t.isFunction(l.options.items)?l.options.items.call(l.element[0],e,{item:this.currentItem}):t(l.options.items,l.element),l]),this.containers.push(l))}for(o=s.length-1;o>=0;o--)for(e=s[o][1],n=s[o][0],a=0,r=n.length;r>a;a++)l=t(n[a]),l.data("sortable-item",e),i.push({item:l,instance:e,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var s=this.items[i];if(s.instance==this.currentContainer||!this.currentContainer||s.item[0]==this.currentItem[0]){var n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item;e||(s.width=n.outerWidth(),s.height=n.outerHeight()),n=n.offset(),s.left=n.left,s.top=n.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){var i=e||this,s=i.options;if(!s.placeholder||s.placeholder.constructor==String){var n=s.placeholder;s.placeholder={element:function(){var e=t(document.createElement(i.currentItem[0].nodeName)).addClass(n||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return n||(e.style.visibility="hidden"),e},update:function(t,e){(!n||s.forcePlaceholderSize)&&(e.height()||e.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}}i.placeholder=t(s.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),s.placeholder.update(i,i.placeholder)},_contactContainers:function(e){for(var i=null,s=null,n=this.containers.length-1;n>=0;n--)t.ui.contains(this.currentItem[0],this.containers[n].element[0])||(this._intersectsWith(this.containers[n].containerCache)?i&&t.ui.contains(this.containers[n].element[0],i.element[0])||(i=this.containers[n],s=n):this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",e,this._uiHash(this)),this.containers[n].containerCache.over=0));if(i)if(1===this.containers.length)this.containers[s]._trigger("over",e,this._uiHash(this)),this.containers[s].containerCache.over=1;else if(this.currentContainer!=this.containers[s]){i=1e4,n=null;for(var o=this.positionAbs[this.containers[s].floating?"left":"top"],r=this.items.length-1;r>=0;r--)if(t.ui.contains(this.containers[s].element[0],this.items[r].item[0])){var a=this.items[r][this.containers[s].floating?"left":"top"];Math.abs(a-o)<i&&(i=Math.abs(a-o),n=this.items[r])}(n||this.options.dropOnEmpty)&&(this.currentContainer=this.containers[s],n?this._rearrange(e,n,null,!0):this._rearrange(e,null,this.containers[s].element,!0),this._trigger("change",e,this._uiHash()),this.containers[s]._trigger("change",e,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[s]._trigger("over",e,this._uiHash(this)),this.containers[s].containerCache.over=1)}},_createHelper:function(e){var i=this.options;return e=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem,e.parents("body").length||t("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==e[0].style.width||i.forceHelperSize)&&e.width(this.currentItem.width()),(""==e[0].style.height||i.forceHelperSize)&&e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(e.containment)){var i=t(e.containment)[0];e=t(e.containment).offset();var s="hidden"!=t(i).css("overflow");this.containment=[e.left+(parseInt(t(i).css("borderLeftWidth"),10)||0)+(parseInt(t(i).css("paddingLeft"),10)||0)-this.margins.left,e.top+(parseInt(t(i).css("borderTopWidth"),10)||0)+(parseInt(t(i).css("paddingTop"),10)||0)-this.margins.top,e.left+(s?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t(i).css("borderLeftWidth"),10)||0)-(parseInt(t(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,e.top+(s?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t(i).css("borderTopWidth"),10)||0)-(parseInt(t(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,i){i||(i=this.position),e="absolute"==e?1:-1;var s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*e+this.offset.parent.top*e-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop())*e),left:i.left+this.offset.relative.left*e+this.offset.parent.left*e-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())*e)}},_generatePosition:function(e){var i=this.options,s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(s[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var o=e.pageX,r=e.pageY;return this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),i.grid&&(r=this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1],r=this.containment&&(r-this.offset.click.top<this.containment[1]||r-this.offset.click.top>this.containment[3])?r-this.offset.click.top<this.containment[1]?r+i.grid[1]:r-i.grid[1]:r,o=this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0],o=this.containment&&(o-this.offset.click.left<this.containment[0]||o-this.offset.click.left>this.containment[2])?o-this.offset.click.left<this.containment[0]?o+i.grid[0]:o-i.grid[0]:o)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():n?0:s.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():n?0:s.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this,o=this.counter;window.setTimeout(function(){o==n.counter&&n.refreshPositions(!s)},0)},_clear:function(e,i){this.reverting=!1;var s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var n in this._storedCSS)("auto"==this._storedCSS[n]||"static"==this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!i&&s.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||s.push(function(t){this._trigger("update",t,this._uiHash())}),!t.ui.contains(this.element[0],this.currentItem[0]))for(i||s.push(function(t){this._trigger("remove",t,this._uiHash())}),n=this.containers.length-1;n>=0;n--)t.ui.contains(this.containers[n].element[0],this.currentItem[0])&&!i&&(s.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[n])),s.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.containers[n])));for(n=this.containers.length-1;n>=0;n--)i||s.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(s.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);if(this._storedCursor&&t("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){for(this._trigger("beforeStop",e,this._uiHash()),n=0;n<s.length;n++)s[n].call(this,e);this._trigger("stop",e,this._uiHash())}return!1}if(i||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(n=0;n<s.length;n++)s[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.extend(t.ui.sortable,{version:"1.8.14"})}(jQuery),/**
 * # Livefield.js
 *
 * http://github.com/withassociates/livefield.js
 *
 * A simple live-lookup ui library.
 *
 * ## Usage
 *
 * As a basic use case, let's say we have an input in a cms that lets users
 * specify which page a thumbnail ought to link to.
 *
 * We have an action on the server `/pages/search` that will find matching
 * pages and return them as JSON.
 *
 * This is how we'd implement livefield:
 *
 *     <!-- input to bind to -->
 *     <input
 *       type="text"
 *       name="link_path"
 *       id="my-input"
 *       data-store="/pages/search/{{query}}"
 *       data-template="#link-template"
 *     />
 *
 *     <!-- template for result options -->
 *     <script type="template/handlebars" id="link-template">
 *       <li data-value="{{path}}">
 *         <span class="name">{{name}}</span>
 *         <span class="path">{{path}}</span>
 *       </li>
 *     </script>
 *
 *     <!-- and activate livefield -->
 *     <script>
 *       $('#my-input').livefield();
 *     </script>
 *
 * ### Data-store
 *
 * Your input needs `data-store` to specify the lookup URL. This can be
 * plain text or a handlebars template. If it's a template, it will
 * receive just the `query` paramters.
 *
 * ### Data-template
 *
 * Your input also needs `data-template`. This should be a jQuery-compatible
 * selector for the element containing the template. Typically, this will
 * be in a `script` tag as in the example above.
 *
 * ### Data-value
 *
 * Your result option template needs to have the `data-value` option.
 * The value of this attribute will be used to populate your input.
 *
 * ## Dependencies
 *
 * * [jQuery](http://jquery.com/) ~> 1.5
 * * [Handlebars](http://handlebars.strobeapp.com/) ~> 1.0
 *
 * ## Contributors
 *
 * * jamie@withassociates.com
 *
 * ## License
 *
 * (The MIT License)
 *
 * Copyright (c) 2011 With Associates
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 */
function(t,e){var i={VERSION:"0.11.0"};i.Controller=function(s){function n(){A=t(s.input),$.store=new i.Store({url:s.store||A.attr("data-store")}),o(),r(),a(),l()}function o(){A.addClass("livefield-input")}function r(){$.store=new i.Store({url:s.store||A.attr("data-store")})}function a(){var e=t(A.attr("data-template")||DEFAULT_TEMPLATE);O=Handlebars.compile(e.html())}function l(){A.bind("keydown keypress",y),A.bind("focus",k),A.bind("blur",P)}function h(){m()?c():u([])}function c(){$.store.find(f(),C)}function u(e){if(0===e.length)b();else{z=f(),g(),I.html("");for(var i in e){var s=e[i],n=t(O(s));n.addClass("livefield-result"),n.appendTo(I)}v()}}function d(){if(I){var t=I.find(".livefield-highlighted").first();t.length>0?(null==z&&(z=A.val()),A.val(t.attr("data-value"))):z&&(A.val(z),z=null)}}function p(){A.blur(),b(),A.trigger("change")}function f(){return A.val()}function m(){return""!=f()}function g(){I||(I=t('<ul class="livefield-results" />').delegate(".livefield-result","mouseout",x).delegate(".livefield-result","mouseover",w).delegate(".livefield-result","mousedown",S).appendTo("body"),v(),t(e).bind("resize",v))}function v(){var e=I.outerWidth()-I.innerWidth(),i=I.outerHeight();I.hide();var s=t("body").height(),n=A.offset().top,o=A.outerHeight(),r=n+o,a=s-n>i,l=n>i;if(a||!l){var h=r;I.removeClass("livefield-drop-up")}else{var h=n-i;I.addClass("livefield-drop-up")}I.css({position:"absolute",zIndex:"1000",width:A.outerWidth()-e+"px",left:A.offset().left+"px",top:h+"px"}).show()}function b(){I&&(I.remove(),I=null,t(e).unbind("resize",v))}function _(e){var i=I&&I.hasClass("livefield-drop-up");switch(e){case"none":I.find(".livefield-highlighted").removeClass("livefield-highlighted");break;case"next":var s,n=I.find(".livefield-highlighted");n.length>0?s=n.next():i||(s=I.find(".livefield-result:first-child")),s&&s.length>0?(n.removeClass("livefield-highlighted"),s.addClass("livefield-highlighted")):i&&n.removeClass("livefield-highlighted");break;case"prev":var o,n=I.find(".livefield-highlighted");n.length>0?o=n.prev():i&&(o=I.find(".livefield-result:last-child")),o&&o.length>0?(n.removeClass("livefield-highlighted"),o.addClass("livefield-highlighted")):i||n.removeClass("livefield-highlighted");break;default:var n=I.find(".livefield-highlighted"),r=t(e);n.removeClass("livefield-highlighted"),r.addClass("livefield-highlighted")}}function y(t){return t.which===E&&I?(t.preventDefault(),_("next"),void d()):t.which===H&&I?(t.preventDefault(),_("prev"),void d()):t.which===D?(t.preventDefault(),void p()):(t.which===T&&A.val(""),$.store.stop(),void setTimeout(h,0))}function w(){_(this),d()}function x(){_("none"),d()}function S(){_(this),d(),p()}function k(){d(),h(),setTimeout(function(){A.select()},0)}function P(){b()}function C(t){u(t)}var $=this,T=27,H=38,E=40,D=13;DEFAULT_TEMPLATE='<li class="livefield-result" data-value="{{value}}">{{name}}</li>';var A,I,O,z;n()},i.Store=function(e){function i(){if(0!==l.queue.length){l.busy=!0;var e=l.queue.shift(),i=e[0].replace(/\/+/g," "),o=e[1];url=a.replace(":query",i),c[url]?s(url,o):r=t.getJSON(url).then(function(t){l.busy&&(r=null,c[url]=t,s(url,o))},n)}}function s(t,e){e(c[t]),l.busy=!1,i()}function n(){}function o(){a=e.url,l.queue=[]}var r,a,l=this,h=1,c={};l.find=function(t,e){for(l.stop(),l.queue.push([t,e]);l.queue.length>h;)l.queue.shift();l.busy||i()},l.stop=function(){r&&(r.abort(),r=null),l.busy=!1},o()},t.fn.livefield=function(e){return this.each(function(){new i.Controller(t.extend(e,{input:this}))})},e.Livefield=i}(jQuery,window),function(t){function e(t,e,i,s){var n=i.lang();return n[t].call?n[t](i,s):n[t][e]}function i(t,e){return function(i){return a(t.call(this,i),e)}}function s(t){return function(e){var i=t.call(this,e);return i+this.lang().ordinal(i)}}function n(t,e,i){this._d=t,this._isUTC=!!e,this._a=t._a||null,this._lang=i||!1}function o(t){var e=this._data={},i=t.years||t.y||0,s=t.months||t.M||0,n=t.weeks||t.w||0,o=t.days||t.d||0,a=t.hours||t.h||0,l=t.minutes||t.m||0,h=t.seconds||t.s||0,c=t.milliseconds||t.ms||0;this._milliseconds=c+1e3*h+6e4*l+36e5*a,this._days=o+7*n,this._months=s+12*i,e.milliseconds=c%1e3,h+=r(c/1e3),e.seconds=h%60,l+=r(h/60),e.minutes=l%60,a+=r(l/60),e.hours=a%24,o+=r(a/24),o+=7*n,e.days=o%30,s+=r(o/30),e.months=s%12,i+=r(s/12),e.years=i,this._lang=!1}function r(t){return 0>t?Math.ceil(t):Math.floor(t)}function a(t,e){for(var i=t+"";i.length<e;)i="0"+i;return i}function l(t,e,i){var s,n=e._milliseconds,o=e._days,r=e._months;n&&t._d.setTime(+t+n*i),o&&t.date(t.date()+o*i),r&&(s=t.date(),t.date(1).month(t.month()+r*i).date(Math.min(s,t.daysInMonth())))}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function c(t,e){var i,s=Math.min(t.length,e.length),n=Math.abs(t.length-e.length),o=0;for(i=0;s>i;i++)~~t[i]!==~~e[i]&&o++;return o+n}function u(t,e,i,s){var n,o,r=[];for(n=0;7>n;n++)r[n]=t[n]=null==t[n]?2===n?1:0:t[n];return t[7]=r[7]=e,null!=t[8]&&(r[8]=t[8]),t[3]+=i||0,t[4]+=s||0,o=new Date(0),e?(o.setUTCFullYear(t[0],t[1],t[2]),o.setUTCHours(t[3],t[4],t[5],t[6])):(o.setFullYear(t[0],t[1],t[2]),o.setHours(t[3],t[4],t[5],t[6])),o._a=r,o}function d(t,e){var i,s,n=[];for(!e&&I&&(e=require("./lang/"+t)),i=0;i<O.length;i++)e[O[i]]=e[O[i]]||D.en[O[i]];for(i=0;12>i;i++)s=$([2e3,i]),n[i]=new RegExp("^"+(e.months[i]||e.months(s,""))+"|^"+(e.monthsShort[i]||e.monthsShort(s,"")).replace(".",""),"i");return e.monthsParse=e.monthsParse||n,D[t]=e,e}function p(t){var e="string"==typeof t&&t||t&&t._lang||null;return e?D[e]||d(e):$}function f(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function m(t){var e,i,s=t.match(M);for(e=0,i=s.length;i>e;e++)s[e]=ee[s[e]]?ee[s[e]]:f(s[e]);return function(n){var o="";for(e=0;i>e;e++)o+="function"==typeof s[e].call?s[e].call(n,t):s[e];return o}}function g(t,e){function i(e){return t.lang().longDateFormat[e]||e}for(var s=5;s--&&L.test(e);)e=e.replace(L,i);return Q[e]||(Q[e]=m(e)),Q[e](t)}function v(t){switch(t){case"DDDD":return R;case"YYYY":return W;case"S":case"SS":case"SSS":case"DDD":return j;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return V;case"Z":case"ZZ":return U;case"T":return B;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return F;default:return new RegExp(t.replace("\\",""))}}function b(t,e,i,s){var n,o;switch(t){case"M":case"MM":i[1]=null==e?0:~~e-1;break;case"MMM":case"MMMM":for(n=0;12>n;n++)if(p().monthsParse[n].test(e)){i[1]=n,o=!0;break}o||(i[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":null!=e&&(i[2]=~~e);break;case"YY":i[0]=~~e+(~~e>70?1900:2e3);break;case"YYYY":i[0]=~~Math.abs(e);break;case"a":case"A":s.isPm="pm"===(e+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":i[3]=~~e;break;case"m":case"mm":i[4]=~~e;break;case"s":case"ss":i[5]=~~e;break;case"S":case"SS":case"SSS":i[6]=~~(1e3*("0."+e));break;case"Z":case"ZZ":s.isUTC=!0,n=(e+"").match(J),n&&n[1]&&(s.tzh=~~n[1]),n&&n[2]&&(s.tzm=~~n[2]),n&&"+"===n[0]&&(s.tzh=-s.tzh,s.tzm=-s.tzm)}null==e&&(i[8]=!1)}function _(t,e){var i,s,n=[0,0,1,0,0,0,0],o={tzh:0,tzm:0},r=e.match(M);for(i=0;i<r.length;i++)s=(v(r[i]).exec(t)||[])[0],s&&(t=t.slice(t.indexOf(s)+s.length)),ee[r[i]]&&b(r[i],s,n,o);return o.isPm&&n[3]<12&&(n[3]+=12),o.isPm===!1&&12===n[3]&&(n[3]=0),u(n,o.isUTC,o.tzh,o.tzm)}function y(t,e){var i,s,o,r,a,l=t.match(N)||[],h=99;for(o=0;o<e.length;o++)r=_(t,e[o]),s=g(new n(r),e[o]).match(N)||[],a=c(l,s),h>a&&(h=a,i=r);return i}function w(t){var e,i="YYYY-MM-DDT";if(Y.exec(t)){for(e=0;4>e;e++)if(X[e][1].exec(t)){i+=X[e][0];break}return U.exec(t)?_(t,i+" Z"):_(t,i)}return new Date(t)}function x(t,e,i,s,n){var o=n.relativeTime[t];return"function"==typeof o?o(e||1,!!i,t,s):o.replace(/%d/i,e||1)}function S(t,e,i){var s=E(Math.abs(t)/1e3),n=E(s/60),o=E(n/60),r=E(o/24),a=E(r/365),l=45>s&&["s",s]||1===n&&["m"]||45>n&&["mm",n]||1===o&&["h"]||22>o&&["hh",o]||1===r&&["d"]||25>=r&&["dd",r]||45>=r&&["M"]||345>r&&["MM",E(r/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=t>0,l[4]=i,x.apply({},l)}function k(t,e){$.fn[t]=function(t){var i=this._isUTC?"UTC":"";return null!=t?(this._d["set"+i+e](t),this):this._d["get"+i+e]()}}function P(t){$.duration.fn[t]=function(){return this._data[t]}}function C(t,e){$.duration.fn["as"+t]=function(){return+this/e}}for(var $,T,H="1.7.2",E=Math.round,D={},A="en",I="undefined"!=typeof module&&module.exports,O="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),z=/^\/?Date\((\-?\d+)/i,M=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,L=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,N=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,F=/\d\d?/,j=/\d{1,3}/,R=/\d{3}/,W=/\d{1,4}/,V=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,U=/Z|[\+\-]\d\d:?\d\d/i,B=/T/i,Y=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,q="YYYY-MM-DDTHH:mm:ssZ",X=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],J=/([\+\-]|\d\d)/gi,K="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),G={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Q={},Z="DDD w M D d".split(" "),te="M D H h m s w".split(" "),ee={M:function(){return this.month()+1},MMM:function(t){return e("monthsShort",this.month(),this,t)},MMMM:function(t){return e("months",this.month(),this,t)},D:function(){return this.date()},DDD:function(){var t=new Date(this.year(),this.month(),this.date()),e=new Date(this.year(),0,1);return~~((t-e)/864e5+1.5)},d:function(){return this.day()},dd:function(t){return e("weekdaysMin",this.day(),this,t)},ddd:function(t){return e("weekdaysShort",this.day(),this,t)},dddd:function(t){return e("weekdays",this.day(),this,t)},w:function(){var t=new Date(this.year(),this.month(),this.date()-this.day()+5),e=new Date(t.getFullYear(),0,4);return~~((t-e)/864e5/7+1.5)},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return a(~~(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+a(~~(t/60),2)+":"+a(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+a(~~(10*t/6),4)}};Z.length;)T=Z.pop(),ee[T+"o"]=s(ee[T]);for(;te.length;)T=te.pop(),ee[T+T]=i(ee[T],2);for(ee.DDDD=i(ee.DDD,3),$=function(e,i){if(null===e||""===e)return null;var s,o;return $.isMoment(e)?new n(new Date(+e._d),e._isUTC,e._lang):(i?s=h(i)?y(e,i):_(e,i):(o=z.exec(e),s=e===t?new Date:o?new Date(+o[1]):e instanceof Date?e:h(e)?u(e):"string"==typeof e?w(e):new Date(e)),new n(s))},$.utc=function(t,e){return h(t)?new n(u(t,!0),!0):("string"==typeof t&&!U.exec(t)&&(t+=" +0000",e&&(e+=" Z")),$(t,e).utc())},$.unix=function(t){return $(1e3*t)},$.duration=function(t,e){var i,s=$.isDuration(t),n="number"==typeof t,r=s?t._data:n?{}:t;return n&&(e?r[e]=t:r.milliseconds=t),i=new o(r),s&&(i._lang=t._lang),i},$.humanizeDuration=function(t,e,i){return $.duration(t,e===!0?null:e).humanize(e===!0?!0:i)},$.version=H,$.defaultFormat=q,$.lang=function(t,e){var i;if(!t)return A;if((e||!D[t])&&d(t,e),D[t]){for(i=0;i<O.length;i++)$[O[i]]=D[t][O[i]];$.monthsParse=D[t].monthsParse,A=t}},$.langData=p,$.isMoment=function(t){return t instanceof n},$.isDuration=function(t){return t instanceof o},$.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(t){var e=t%10;return 1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th"}}),$.fn=n.prototype={clone:function(){return $(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?null!=this._a[8]?!!this._a[8]:!c(this._a,(this._a[7]?$.utc(this._a):$(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(t){return g(this,t?t:$.defaultFormat)},add:function(t,e){var i=e?$.duration(+e,t):$.duration(t);return l(this,i,1),this},subtract:function(t,e){var i=e?$.duration(+e,t):$.duration(t);return l(this,i,-1),this},diff:function(t,e,i){var s,n=this._isUTC?$(t).utc():$(t).local(),o=6e4*(this.zone()-n.zone()),r=this._d-n._d-o,a=this.year()-n.year(),l=this.month()-n.month(),h=this.date()-n.date();return s="months"===e?12*a+l+h/30:"years"===e?a+(l+h/30)/12:"seconds"===e?r/1e3:"minutes"===e?r/6e4:"hours"===e?r/36e5:"days"===e?r/864e5:"weeks"===e?r/6048e5:r,i?s:E(s)},from:function(t,e){return $.duration(this.diff(t)).lang(this._lang).humanize(!e)},fromNow:function(t){return this.from($(),t)},calendar:function(){var t=this.diff($().sod(),"days",!0),e=this.lang().calendar,i=e.sameElse,s=-6>t?i:-1>t?e.lastWeek:0>t?e.lastDay:1>t?e.sameDay:2>t?e.nextDay:7>t?e.nextWeek:i;return this.format("function"==typeof s?s.apply(this):s)},isLeapYear:function(){var t=this.year();return t%4===0&&t%100!==0||t%400===0},isDST:function(){return this.zone()<$([this.year()]).zone()||this.zone()<$([this.year(),5]).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==t?e:this.add({d:t-e})},startOf:function(t){switch(t.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(t){return this.startOf(t).add(t.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return $.utc([this.year(),this.month()+1,0]).date()},lang:function(e){return e===t?p(this):(this._lang=e,this)}},T=0;T<K.length;T++)k(K[T].toLowerCase(),K[T]);k("year","FullYear"),$.duration.fn=o.prototype={weeks:function(){return r(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(t){var e=+this,i=this.lang().relativeTime,s=S(e,!t,this.lang()),n=0>=e?i.past:i.future;return t&&(s="function"==typeof n?n(s):n.replace(/%s/i,s)),s},lang:$.fn.lang};for(T in G)G.hasOwnProperty(T)&&(C(T,G[T]),P(T.toLowerCase()));C("Weeks",6048e5),I&&(module.exports=$),"undefined"==typeof ender&&(this.moment=$),"function"==typeof define&&define.amd&&define("moment",[],function(){return $})}.call(this),function(t){t.fn.freezeHeight=function(){return this.each(function(){var e=t(this);e.height(e.height())})},t.fn.thawHeight=function(){return this.height("auto")}}(jQuery),window.humanFileSize=function(t){if(t=parseInt(t,10),isNaN(t))return"N/A";var e=1024,i=1024*e,s=1024*i;return t>=s?(t/s).toFixed(2)+" GB":t>=i?(t/i).toFixed(2)+" MB":t>=e?Math.floor(t/e)+" KB":t+"b"},JSON&&JSON.stringify&&(JSON.nativeStringify=JSON.stringify,JSON.stringify=function(t){return JSON.nativeStringify(t).replace(/\\u000a/g,"\\n")}),moment.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),longDateFormat:{LT:"h:mma",L:"D/M/YYYY",LL:"Do MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[today at] LT",nextDay:"[tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"LL"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(t){var e=t%10;return 1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th"}}),moment.fn.is=function(t){return t&&this.valueOf()===t.valueOf()},window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))},function(t,e){t(function(){var e=t("#server-communication").ajaxStart(function(){e.show()}).ajaxStop(function(){e.hide()})}),t.fn.applyDataValues=function(){return this.find("select").each(function(){var e=t(this),i=e.data("value");e.find('option[value="'+i+'"]').attr("selected","selected"),e.val(i)}),this.find(":checkbox").each(function(){var e=t(this);("true"==e.data("value")||"1"==e.data("value"))&&e.attr("checked","checked")}),this.find(":radio").each(function(){var e=t(this),i=e.closest("[data-value]"),s=i.data("value");e.val()==s&&e.attr("checked","checked")}),this},t.fn.editinplace=function(){this.find("textarea,input[type=text]").each(function(){var e=t(this),i=e.val();e.after(t("<span />").attr({"class":e.attr("class")}).text(i)).remove()}),this.find(".editinplace").bind("click",function(){var i=t(this),s=i.text();inp=t(i.is(".long")?'<textarea id="editing-in-place" />':'<input id="editing-in-place" type="text" />').val(s).focus().bind("keydown",function(i){var s=e.event?i.which:i.keyCode;if(13===s){var n=this.form;t(this).blur(),t(n).trigger("submit")}}).bind("blur",function(){var e=t(this);i.text(e.val()).show(),e.remove()}),1==i.siblings("label").length&&inp.attr("name",i.siblings("label").attr("for")),i.after(inp).hide(),inp.focus()})},t.fn.initDataPlugins=function(){return this.find("[data-plugin]").each(function(){var e=t(this),i=e.attr("data-plugin");_.isFunction(e[i])&&e[i]()}),this}}(jQuery,this),function(t){var e=t.ui.sortable.prototype._mouseStart;t.ui.sortable.prototype._superMouseStart=e,t.ui.sortable.prototype._mouseStart=function(t,e,i){this._trigger("beforeStart",t,this._uiHash()),this._superMouseStart(t,e,i)}}(jQuery),/*
 * jQuery UI Nested Sortable
 * v 1.3.4 / 28 apr 2011
 * http://mjsarfatti.com/sandbox/nestedSortable
 *
 * Depends:
 *	 jquery.ui.sortable.js 1.8+
 *
 * License CC BY-SA 3.0
 * Copyright 2010-2011, Manuele J Sarfatti
 */
function(t){t.widget("ui.nestedSortable",t.extend({},t.ui.sortable.prototype,{options:{tabSize:20,disableNesting:"ui-nestedSortable-no-nesting",errorClass:"ui-nestedSortable-error",listType:"ol",maxLevels:0,noJumpFix:0},_create:function(){return 0==this.noJumpFix&&this.element.height(this.element.height()),this.element.data("sortable",this.element.data("nestedSortable")),t.ui.sortable.prototype._create.apply(this,arguments)},_mouseDrag:function(e){var i=this.options;if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var s=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(e.pageY-t(document).scrollTop()<i.scrollSensitivity?s=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(s=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed)),e.pageX-t(document).scrollLeft()<i.scrollSensitivity?s=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(s=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed))),s!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var n=this.items.length-1;n>=0;n--){var o=this.items[n],r=o.item[0],a=this._intersectsWithPointer(o);if(a&&r!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=r&&!t.contains(this.placeholder[0],r)&&("semi-dynamic"==this.options.type?!t.contains(this.element[0],r):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(e,o),this._clearEmpty(r),this._trigger("change",e,this._uiHash());break}}var l=this.placeholder[0].parentNode.parentNode&&t(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?t(this.placeholder[0].parentNode.parentNode):null,h=this._getLevel(this.placeholder),c=this._getChildLevels(this.helper),u=this.placeholder[0].previousSibling?t(this.placeholder[0].previousSibling):null;if(null!=u)for(;"li"!=u[0].nodeName.toLowerCase()||u[0]==this.currentItem[0];){if(!u[0].previousSibling){u=null;break}u=t(u[0].previousSibling)}return newList=document.createElement(i.listType),this.beyondMaxLevels=0,null!=l&&this.positionAbs.left<l.offset().left?(l.after(this.placeholder[0]),this._clearEmpty(l[0]),this._trigger("change",e,this._uiHash())):null!=u&&this.positionAbs.left>u.offset().left+i.tabSize?(this._isAllowed(u,h+c+1),u.children(i.listType).length||u[0].appendChild(newList),u.children(i.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",e,this._uiHash())):this._isAllowed(l,h+c),this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e){if(this.beyondMaxLevels){for(var i=this.placeholder.parent().closest(this.options.items),s=this.beyondMaxLevels-1;s>0;s--)i=i.parent().closest(this.options.items);this.placeholder.removeClass(this.options.errorClass),i.after(this.placeholder),this._trigger("change",e,this._uiHash())}t.ui.sortable.prototype._mouseStop.apply(this,arguments)},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/),n=(t(e.item||this).parent(e.listType).parent("li").attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);i&&s.push((e.key||i[1]+"["+(e.key&&e.expression?i[1]:i[2])+"]")+"="+(n?e.key&&e.expression?n[1]:n[2]:"root"))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toHierarchy:function(e){function i(s){var n=(t(s).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);if(null!=n){var o={id:n[2]};return t(s).children(e.listType).children("li").length>0&&(o.children=[],t(s).children(e.listType).children("li").each(function(){var e=i(t(this));o.children.push(e)})),o}}e=e||{};var s=(e.startDepthCount||0,[]);return t(this.element).children("li").each(function(){var e=i(t(this));s.push(e)}),s},toArray:function(e){function i(t,e){return t.left-e.left}function s(i,r,a){return right=a+1,t(i).children(e.listType).children("li").length>0&&(r++,t(i).children(e.listType).children("li").each(function(){right=s(t(this),r,right)}),r--),id=t(i).attr(e.attribute||"id").match(e.expression||/(.+)[-=_](.+)/),r===n+1?pid="root":(parentItem=t(i).parent(e.listType).parent("li").attr("id").match(e.expression||/(.+)[-=_](.+)/),pid=parentItem[2]),null!=id&&o.push({item_id:id[2],parent_id:pid,depth:r,left:a,right:right}),a=right+1}e=e||{};var n=e.startDepthCount||0,o=[],r=2;return o.push({item_id:"root",parent_id:"none",depth:n,left:"1",right:2*(t("li",this.element).length+1)}),t(this.element).children("li").each(function(){r=s(this,n+1,r)}),o=o.sort(i)},_clear:function(){t.ui.sortable.prototype._clear.apply(this,arguments);for(var e=this.items.length-1;e>=0;e--){var i=this.items[e].item[0];this._clearEmpty(i)}return!0},_clearEmpty:function(t){t.children[1]&&0==t.children[1].children.length&&t.removeChild(t.children[1])},_getLevel:function(t){var e=1;if(this.options.listType)for(var i=t.closest(this.options.listType);!i.is(".ui-sortable");)e++,i=i.parent().closest(this.options.listType);return e},_getChildLevels:function(e,i){var s=this,n=this.options,o=0;return i=i||0,t(e).children(n.listType).children(n.items).each(function(t,e){o=Math.max(s._getChildLevels(e,i+1),o)}),i?o+1:o},_isAllowed:function(t,e){var i=this.options;null!=t&&t.hasClass(i.disableNesting)?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=i.maxLevels<e&&0!=i.maxLevels?e-i.maxLevels:1):i.maxLevels<e&&0!=i.maxLevels?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=e-i.maxLevels):(this.placeholder.removeClass(i.errorClass),this.beyondMaxLevels=0)}})),t.ui.nestedSortable.prototype.options=t.extend({},t.ui.sortable.prototype.options,t.ui.nestedSortable.prototype.options)}(jQuery),/*!
 * jQuery ajaxProgress Plugin v0.5.0
 * Requires jQuery v1.5.0 or later
 * * http://www.kpozin.net/ajaxprogress *
 * (c) 2011, Konstantin Pozin
 * Licensed under MIT license.
 */
function(t){function e(e,i){i.global&&t.event.trigger("ajaxProgress",[e,i.__jqXHR]),"function"==typeof i.progress&&i.progress(i.__jqXHR,e)}var i=t.support.ajaxProgress="onprogress"in t.ajaxSettings.xhr(),s=void 0!=t.ajaxSettings.xhr.bind,n=i&&s;if(n){var o=".ajaxprogress";t.fn.ajaxProgress=function(t){return this.bind("ajaxProgress",t)},t("html").bind("ajaxSend"+o,function(t,e,i){i.__jqXHR=e});var r=t.ajaxSettings.xhr.bind(t.ajaxSettings),a={};a.xhr=function(){var t=this,i=r();return i&&(i.upload.onprogress=function(i){e(i,t)}),i},t.ajaxSetup(a)}}(jQuery);var slices={defaultSettings:{mainTemplate:"_page_main",metaTemplate:"_page_meta",templatesPath:"/slices/templates/",loadPagePath:"/admin/pages/{{id}}.json",savePagePath:"/admin/pages/{{id}}.json"},templates:{},availableSlices:{},availableContainers:{},model:{},fieldId:function(t,e){return t===slices.model.Page.data()?["meta",e].join("-"):t.hasOwnProperty("id")?["slices",t.id,e].join("-"):(slices.__uid__=slices.__uid__||0,"field-"+ ++slices.__uid__)},controller:function(){function t(t,i){H=$.extend({},slices.defaultSettings,i),v(),slices.model.Page.init(H),slices.model.Page.id(t),slices.availableContainers=H.availableContainers,slices.availableSlices=H.availableSlices,e(slices.availableSlices),templates=["slice",H.mainTemplate,H.metaTemplate,H.mainExtraTemplate,H.metaExtraTemplate],s(t),n(templates,t,o)}function e(t){var e=$("#add-slice-fields select");e.find("option:not(:disabled)").remove(),_.each(t,function(t,i){x(t)||e.append('<option value="'+i+'">'+t.name+"</option>")})}function i(t,e){return t=t.split("{{id}}").join(e),0===t.indexOf("/")?t+".hbs":H.templatesPath+t+".hbs"}function s(t){_.each(slices.availableSlices,function(e){$.ajax({url:i(e.template,t),success:function(t){slices.templates[e.template]=Handlebars.compile(t)}})})}function n(t,e,s){t=_.compact(t);var n=t.length;_.each(t,function(t){$.ajax({url:i(t,e),success:function(e){slices.templates[t]=Handlebars.compile(e),0==--n&&s()}})})}function o(){slices.model.Page.load(a)}function r(t){var e,i,s=slices.availableSlices[t.type].template,e=$(slices.templates.slice({id:t.id,name:t.name,css_class:t.type+"-slice",content:function(){return slices.templates[s](t)}})),i=e.find(".slice-content"),n=e.find(".control-bar"),o=e.find(".slice-preview");if(_.isFunction(window.customSlicePreview)){var r=window.customSlicePreview;delete window.customSlicePreview}else var r=slices.defaultSlicePreview;var a=function(){o.html(r.call(i))};a(),n.on("click",function(){var t=e.is(".closed");return t?(i.slideDown("fast"),e.removeClass("closed")):(a(),i.slideUp("fast"),e.addClass("closed")),p(),!1}),e.find("a.sort").on("click",!1),x(t)?e.find("a.delete").remove():e.find("a.delete").on("click",function(){return t._destroy=1,e.slideUp("fast"),e.trigger("change"),k(),!1}),$("#container-"+t.container+">ul").append(e),i.applyDataValues(),i.initDataPlugins(),S(t,e)}function a(){var t=$("#container-tab-controls"),i=$("#containers-holder").empty(),s=$("#add-slice-fields");l(),_.each(slices.availableContainers,function(n,o){var r=$('<a href="#container-'+o+'">'+n.name+"</a>");n.primary&&r.addClass("primary"),n.availableSlices=_.clone(slices.availableSlices),n.only&&_.each(slices.availableSlices,function(t,e){_.contains(n.only,e)||delete n.availableSlices[e]}),n.except&&_.each(slices.availableSlices,function(t,e){_.contains(n.except,e)&&delete n.availableSlices[e]}),r.data("container",n),r.on("click",function(){var s=$(this),n=s.data("container");return t.find("a").removeClass("active"),i.find(">div").hide(),$("#container-"+o).show(),$(this).addClass("active"),p(),e(n.availableSlices),!1}),t.append($("<li />").append(r));var n=$('<div id="container-'+o+'" class="container" />'),a=$('<ul class="slices-holder" />'),l=s.clone();l.find("select").bind("change",function(){var t=$(this).val();return""===t?!1:(c(o,$(this).val(),$("#container-"+o+" ul li").length),$("#container-"+o+" ul").trigger("sortstop"),$(this).find("option:selected").removeAttr("selected"),$(this).find("option:disabled").attr("selected","selected"),!1)}),n.append(a,l),i.append(n)}),s.remove(),t.find("a:first, a.primary").trigger("click"),u(),d(),$("#page-meta").children().length>0&&($('<div id="show-meta"><a href="#">advanced options&hellip;</a></div>').insertAfter("#page-meta").toggle(function(){$("#page-meta").slideDown("fast"),$(this).html('<a href="#">hide advanced options</a>'),$(this).addClass("open"),$(document).trigger("slices:didShowAdvancedOptions")},function(){$("#page-meta").slideUp("fast"),$(this).html('<a href="#">advanced options&hellip;</a>'),$(this).removeClass("open"),$(document).trigger("slices:didHideAdvancedOptions")}),slices.model.Page.seemsNew()&&$("#show-meta").trigger("click")),E=!1}function l(){$("#page-main").html(h(H.mainTemplate)),$("#page-meta").html(h(H.metaTemplate)),H.metaExtraTemplate&&$("#page-meta").append(h(H.metaExtraTemplate)),H.mainExtraTemplate&&$("#page-extra-main").html(h(H.mainExtraTemplate)),$("#page-meta-fields").applyDataValues().initDataPlugins(),Tagging.detect()}function h(t){var e=slices.templates[t],i=slices.model.Page,s=i.data();return e(s)}function c(t,e,i){var s=_.extend({},slices.availableSlices[e],{type:e,container:t,position:i});slices.model.Page.addSlice(s),r(s)}function u(){_.each(slices.availableContainers,function(t,e){$("#container-"+e+" ul").empty()}),_.each(slices.availableContainers,function(t,e){var i=slices.model.Page.getSlices(e);i=_.map(i,function(t){return $.extend(!0,{},slices.availableSlices[t.type],t)}),slices.model.Page.setSlices(e,i),_.each(i,r);var s=$("#container-"+e+">ul");s.sortable({handle:".control-bar",scroll:!1,beforeStart:function(){s.freezeHeight(),window.autoscroll.start()},stop:function(){window.autoscroll.stop(),s.thawHeight()}}),s.on("sortstop",function(){s.find(">li").each(function(t){slices.model.Page.positionSlice($(this).attr("rel"),t)}),y()}),s.trigger("sortstop")})}function d(){var t=$("#minimise");t.text("Minimise all slices"),t.on("click",function(){return-1!=t.text().indexOf("Minimise")?$(".container:visible .slice:not(.closed) .control-bar").click():$(".container:visible .slice.closed .control-bar").click(),!1})}function p(){var t=$(".container:visible .slice");if(0!==t.length){var e=t.filter(".closed"),i=e.length===t.length,s=0===e.length;i?$("#minimise").text("Expand all slices"):s&&$("#minimise").text("Minimise all slices")}}function f(){var t=slices.model.Page,e=$('[id^="meta-"]');e.each(function(){var e=$(this),i=e.attr("id"),s=i.match(/meta-(.+)/)[1],n=t.getMeta(s),o=slices.getValueForId(i);void 0!==o&&o!=n&&(t.setMeta(s,o),t.changed=!0)})}function m(){var t=slices.model.Page;_.each(t.slices(),function(e){var i="slices-"+e.id+"-",s=$('[id^="'+i+'"]');s.each(function(){var s=$(this),n=s.attr("id"),o=n.substr(i.length),r=e[o],a=slices.getValueForId(n);void 0!==a&&a!=r&&(e[o]=a,t.changed=!0)})})}function g(){var t=slices.model.Page;t.changed=!1,f(),m(),t.changed&&k()}function v(){$("#slices-form").on("submit",w).on("change",b).on("keyup","input, textarea",_.debounce(function(){$(this).trigger("change")},100))}function b(){E||g()}function y(){E||k()}function w(t){t.preventDefault(),E=!0,$(document).trigger("slices:willSubmit"),g(),P(),$(".error-message").remove(),$(".field-with-errors").removeClass("field-with-errors"),$("#container").freezeHeight(),slices.model.Page.save().done(function(){l(),u(),C(),T()}).fail(function(t){_.each(t,function(t,e){if("slices"==e)t=_.flatten([t])[0],_.each(t,function(t,e){_.each(t,function(t,i){var s=["slices",e,i].join("-"),n=$("#"+s);n.closest("li").addClass("field-with-errors");var o=_.flatten([t]).join(", ");n.after($('<div class="error-message" />').text($("label[for="+s+"]").text()+" "+o));var r=n.closest(".container").attr("id");$("#container-tab-controls a[href=#"+r+"]").addClass("field-with-errors")})});else{var i=$("#meta-"+e).closest("li");i.addClass("field-with-errors").append($('<div class="error-message" />').text(i.find(".label").text()+" "+t))}})}).always(function(){P(),p(),E=!1,_.defer(function(){$("#container").thawHeight()})})}function x(t){return t.restricted&&!H.super_user}function S(t,e){var i={};return _.each(slices.availableContainers,function(e,s){e.availableSlices.hasOwnProperty(t.type)&&(i[s]=e)}),Object.keys(i).length<=1?void e.find(".container-select").remove():void e.find(".container-select").each(function(){var s=$(this);s.append('<option value="default" selected disabled>Move to another container</option>'),_.each(i,function(t,e){s.append('<option value="'+e+'">'+t.name+"</option>")}),s.bind("change",function(){var i=s.val(),n=$("#container-"+i+" > ul");t.container=i,e.detach().appendTo(n),s.val("default"),n.find("> li").each(function(t){slices.model.Page.positionSlice($(this).attr("rel"),t)}),y()})})}function k(){$("#save-changes").attr("disabled",!1)}function P(){$("#save-changes").attr("disabled",!0)}function C(){$("#page-view-on-site").attr("href",slices.model.Page.data().path)}function T(){$("#breadcrumbs .current a").html(slices.model.Page.data().name)}var H,E=!0;return{init:function(e,i){return t(e,i)}}}()};slices.Asset=Backbone.Model.extend({urlRoot:"/admin/assets",toJSON:function(){return{asset:{name:this.get("name"),tags:this.get("tags")}}},isImage:function(){return 0===(this.get("file_content_type")||"").indexOf("image")},destroy:function(){this.trigger("destroying"),Backbone.Model.prototype.destroy.apply(this)}}),slices.AssetCollection=Backbone.Collection.extend({model:slices.Asset,url:"/admin/assets",initialize:function(){this.bind("add",this.afterAdd),this.bind("remove",this.afterRemove)},parse:function(t){return this.currentPage=t.current_page,this.perPage=t.per_page,this.totalEntries=t.total_entries,this.totalPages=t.total_pages,t.items},hasMorePages:function(){return this.currentPage<this.totalPages},afterAdd:function(){this.totalEntires+=1,this.totalPages=Math.ceil(this.totalEntries/this.perPage)},afterRemove:function(){this.totalEntries-=1,this.totalPages=Math.ceil(this.totalEntries/this.perPage)}}),slices.Attachment=Backbone.Model.extend({initialize:function(){this.get("file")&&(this.get("file").attachment=this,this.updateFileStatus()),this.get("asset")&&this.get("asset").constructor!==slices.Asset&&this.set({asset:new slices.Asset(this.get("asset"))})},updateFileStatus:function(){this.trigger("change")},toJSON:function(){var t=_.clone(this.attributes);return delete t.asset,t}}),slices.AttachmentCollection=Backbone.Collection.extend({model:slices.Attachment}),slices.ComposerItem=Backbone.Model.extend(),slices.ComposerItemCollection=Backbone.Collection.extend({model:slices.ComposerItem}),slices.FILE_QUEUED="queued",slices.FILE_UPLOADING="uploading",slices.FILE_FAILED="failed",slices.FILE_DONE="done",slices.File=Backbone.Model.extend({defaults:{status:slices.FILE_QUEUED},initialize:function(){this.uploader=this.get("uploader"),this.url=this.get("uploadOptions").url,this.params=this.get("uploadOptions").params},start:function(){this.upload()},status:function(){switch(this.get("status")){case slices.FILE_QUEUED:return"queued";case slices.FILE_UPLOADING:return this.progress()<1?"uploading":"processing";case slices.FILE_FAILED:return"failed";case slices.FILE_DONE:return"done";default:return"queued"}},progress:function(){return this.get("loaded")/this.get("total")},formDataWithOptions:function(t){var e=new FormData;for(var i in t)e.append(i,t[i]);return e},formData:function(){var t=this.formDataWithOptions(this.params);return t.append("file",this.get("browserFile")),t},upload:function(){var t=this,e=this.url,i=this.formData();this.uploadWithOptions(e,i,{progress:function(e,i){t.onProgress(i)},success:function(e){t.onSuccess(e)},error:function(e){t.onError(e)}})},uploadWithOptions:function(t,e,i){$.ajax({url:t,data:e,cache:!1,processData:!1,type:"POST",contentType:!1,progress:i.progress,success:i.success,error:i.error})},onProgress:function(t){t.lengthComputable&&this.set({status:slices.FILE_UPLOADING,loaded:t.loaded,total:t.total})},onSuccess:function(t){this.set("status",slices.FILE_DONE),this.uploader.onload({file:this,response:t})},onError:function(t){this.set("status",slices.FILE_FAILED),this.uploader.onfail({file:this,response:t})}}),slices.model.Page=function(){function t(t){$.ajax({url:o.loadPagePath.split("{{id}}").join(r),contentType:"application/json",dataType:"json",error:function(t,e,i){throw new Error(i)},success:function(e){i(e),t()}})}function e(){var t=$.Deferred(),e=$.extend({},a);_.each(e.slices,function(t){0===t.id.indexOf(h)&&(t.client_id=t.id,t._new=1,delete t.id,delete t.template,delete t.name)});var s=["id","position","created_at","updated_at","has_content","path","page_id"];return _.each(s,function(t){delete e[t]}),$.ajax({url:o.savePagePath.split("{{id}}").join(r),type:"PUT",data:JSON.stringify({page:e}),contentType:"application/json",dataType:"json",error:function(e,i,s){if(422!=e.status)throw new Error(s);var n=$.parseJSON(e.responseText);_.each(a.slices,function(t){t._new&&(t.id=t.client_id)}),t.reject(n)},success:function(e){i(e),t.resolve()}}),t.promise()}function i(t){a=t,_.each(slices.availableContainers,function(t,e){c[e]=[]}),a.slices=_.sortBy(a.slices,function(t){return t.position}),_.each(a.slices,function(t){delete t.client_id,delete t._new;try{c[t.container].push(t)}catch(e){void 0!=console&&console.log("Error, missing container on slice?",e,t)}})}function s(t){t.id=h+l++,a.slices.push(t),c[t.container].push(t)}function n(t,e){_.detect(a.slices,function(e){return e.id==t}).position=e}var o,r,a,l=0,h="__new__",c={};return{init:function(t){o=t},id:function(t){return 0===arguments.length?r:void(r=t)},load:function(e){t(e)},save:function(){return e()},field:function(t){return a[t]},getSlices:function(t){return c[t]},setSlices:function(t,e){c[t]=[],_.each(e,function(e){a.slices=_.reject(a.slices,function(t){return t.id===e.id}),a.slices.push(e),c[t].push(e)})},addSlice:function(t){s(t)},positionSlice:function(t,e){n(t,e),changed=!0},getMeta:function(t){return a[t]},setMeta:function(t,e){a[t]=e},seemsNew:function(){var t=moment(this.field("created_at")),e=moment().subtract("minutes",1);return t>=e&&0==this.field("active")},data:function(){return a},slices:function(){return a.slices}}}(),slices.S3File=slices.File.extend({setS3Key:function(t){this.set("key",slices.S3_TEMPFILE_KEY_PREFIX+"/"+Date.now()+"/"+t)},fileS3URL:function(){return slices.S3_URL+this.get("key")},formDataToS3:function(){var t=this.formDataWithOptions(slices.S3_UPLOADER_DEFAULTS),e=this.get("browserFile");return this.setS3Key(e.name),t.append("key",this.get("key")),t.append("Content-Type",e.type),t.append("file",e),t},formDataFromS3:function(){var t=this.formDataWithOptions(this.params);return t.append("file",this.fileS3URL()),t},upload:function(){var t=this,e=slices.S3_URL,i=this.formDataToS3();this.uploadWithOptions(e,i,{progress:function(e,i){t.onS3Progress(i)},success:function(e){t.onS3Success(e)},error:function(e){t.onS3Error(e)}})},onS3Progress:function(t){this.onProgress(t)},onS3Success:function(t){this.uploadToSlicesFromS3(t)},onS3Error:function(t){this.onError(t)},uploadToSlicesFromS3:function(){var t=this,e=this.url,i=this.formDataFromS3();this.uploadWithOptions(e,i,{progress:function(){},success:function(e){t.onSuccess(e)},error:function(e){t.onError(e)}})}});var GenericBackbone={collection_prototype:{page:1,total_pages:1,search_term:"",search:function(){var t=this;$.get(t.search_url,this.search_data(),function(e){t.page=e.current_page,t.total_pages=e.total_pages,t.reset(e.items)},"json")}},model_prototype:{idAttribute:"_id",clear:function(){this.view.remove(),this.destroy()}},view_prototype:{initialize:function(){this.model.view=this},remove:function(){$(this.el).remove()},clear:function(){return this.model.clear(),!1},render:function(){return $(this.el).html(this.template(this.model.for_template())),this}},app_view_prototype:{render_pagination:function(){if($pagination=this.$("#pagination"),1===this.collection.total_pages)return void $pagination.empty();for(var t=this,e=[],i=1;i<=t.collection.total_pages;i++)i===this.collection.page?e.push({num:i,klass:"active"}):i===this.collection.page+1||i===this.collection.page-1?e.push({num:i,klass:""}):(2>=i||i>this.collection.total_pages-2)&&e.push({num:i,klass:""});$pagination.empty(),_.each(e,function(t,i){$pagination.append($("<a />",{text:t.num,className:t.klass,href:"#"})),e[i+1]&&e[i+1].num!=t.num+1&&$pagination.append($("<span>...</span>").wrap("<li />"))}),$pagination.find("a, span").wrap(document.createElement("li"))},paginate:function(t){var e=$(t.target).text();this.collection.page=e,this.search()},setup_search:function(){var t=this;setInterval(function(){t.search_now&&(t.search_now=!1,t.collection.page=1,t.search())},250)},call_search:function(){this.search_now=!0},search:function(){this.collection.search_term=this.$("#entries-search").val(),this.collection.search()}}},AdminsBackbone=$.extend(!0,{},GenericBackbone,{collection_prototype:{page_id:"",search_url:"",search_data:function(){return{search:this.search_term,page:this.page}},initialize:function(t,e){this.page_id=e.page_id,this.search_url="/admin/admins"}},model_prototype:{for_template:function(){var t=this.toJSON();return t.url=this.url(),t},initialize:function(){this.get("last_sign_in_at")||this.set({last_sign_in_at:"never"}),this.get("name")||this.set({name:"No Name Set"})},url:function(){return"/admin/admins/"+this.id}},view_prototype:{events:{"click a.delete":"clear"},tagName:"tr",template:Handlebars.compile("<td class='name'><a href='{{url}}'>{{name}}</a></td><td class='email'>{{email}}</td><td class='login'>{{last_sign_in_at}}</td><td>{{#if current_admin}}This is you{{else}}<a href='#' class='delete'>Delete</a>{{/if}}</td>")},app_view_prototype:{events:{"click #pagination a":"paginate","keyup #entries-search":"call_search","click #add-admin":"new_admin"},new_admin:function(){document.location.href=document.location.href+"/new"},setup_search:function(){var t=this;setInterval(function(){if(t.search_now){t.search_now=!1;var e=t.$search_box.val().length;(e>2||0===e)&&(t.collection.page=1,t.search())}},450)},initialize:function(){this.collection=this.options.collection,this.view_prototype=this.options.view_prototype,_.bindAll(this,"render"),this.collection.bind("reset",this.render),this.$search_box=this.$("#entries-search"),this.setup_search(),this.search()},render:function(){var t=this.view_prototype;this.$("#entries-list tbody").empty(),_.each(this.collection.models,function(e){var i=new t({model:e});self.$("#entries-list tbody").append(i.render().el)}),this.render_pagination()}},bind_prototypes:function(){this.collection_prototype=Backbone.Collection.extend(this.collection_prototype),this.view_prototype=Backbone.View.extend(this.view_prototype),this.model_prototype=Backbone.Model.extend(this.model_prototype),this.app_view_prototype.el=$("#container"),this.app_view_prototype=Backbone.View.extend(this.app_view_prototype)},boot:function(t){this.bind_prototypes(),this.collection=new this.collection_prototype(null,{page_id:t}),this.collection.model=this.model_prototype,this.app_view=new this.app_view_prototype({collection:this.collection,view_prototype:this.view_prototype})}}),EntriesBackbone=$.extend(!0,{},GenericBackbone,{collection_prototype:{page_id:"",search_url:"",search_data:function(){return{search:this.search_term,page:this.page}},initialize:function(t,e){this.page_id=e.page_id,this.search_url="/admin/pages/"+this.page_id+"/entries"}},model_prototype:{for_template:function(){return this.toJSON()},url:function(){return this.get("url")}},view_prototype:{events:{"click a.delete":"clear_with_confirmation"},tagName:"tr",clear_with_confirmation:function(){confirm("Are you sure?")&&this.model.clear()}},app_view_prototype:{events:{"click #pagination a":"paginate","keyup #entries-search":"call_search","click #add-entry":"add_entry"},setup_search:function(){var t=this;setInterval(function(){if(t.search_now){t.search_now=!1;var e=t.$search_box.val().length;(e>2||0===e)&&(t.collection.page=1,t.search())}},450)},initialize:function(t){if(this.collection=this.options.collection,this.view_prototype=this.options.view_prototype,_.bindAll(this,"render","set_view_template"),this.collection.bind("reset",this.set_view_template),this.collection.bind("reset",this.render),this.$search_box=this.$("#entries-search"),this.setup_search(),this.search(),"position"===t.sort_field){var e=this;this.$("tbody").sortable({update:function(){e.update_on_sort()}})}},set_view_template:function(){attributes=0==this.collection.models.length?{}:this.collection.models[0].attributes;var t=_.chain(attributes).keys().reject(function(t){return 0===t.indexOf("_")}).value();t=_.map(t,function(t){return slices.entryTemplate(t)}),t.push("<td><a href='#' class='delete'>Delete</a></td>");var e=Handlebars.compile(t.join(""));this.view_prototype=this.view_prototype.extend({template:e}),this.collection.unbind("reset",this.set_view_template)},render:function(){var t=this.view_prototype;this.$("#entries-list tbody").empty(),_.each(this.collection.models,function(e){var i=new t({model:e}),s=$(i.render().el);s.data("model",e),self.$("#entries-list tbody").append(s)}),this.render_pagination()},add_entry:function(t){var e=$(t.target);return $("#general-modal").jqm({ajax:e.attr("href"),modal:!1,onHide:function(t){t.w.fadeOut(100),t.o.fadeOut(100)},onShow:function(){},onLoad:function(t){t.w.fadeIn(50),t.o.fadeIn(100)},overlay:40}).jqmShow(),!1},update_on_sort:function(){var t={id:this.collection.page_id};t.children=this.$("#entries-list tbody tr").map(function(){return{id:$(this).data("model").id}}).toArray(),$.ajax({url:"/admin/site_maps/update",type:"PUT",data:JSON.stringify({sitemap:[t]}),contentType:"application/json",dataType:"json"})}},bind_prototypes:function(){this.collection_prototype=Backbone.Collection.extend(this.collection_prototype),this.view_prototype=Backbone.View.extend(this.view_prototype),this.model_prototype=Backbone.Model.extend(this.model_prototype),this.app_view_prototype.el=$("#container"),this.app_view_prototype=Backbone.View.extend(this.app_view_prototype)},boot:function(t,e){this.bind_prototypes(),this.collection=new this.collection_prototype(null,{page_id:t}),this.collection.model=this.model_prototype,this.app_view=new this.app_view_prototype($.extend({},e,{collection:this.collection,view_prototype:this.view_prototype}))}}),SnippetsBackbone=$.extend(!0,{},GenericBackbone,{collection_prototype:{search_url:"/admin/snippets",search_data:function(){return{search:this.search_term,page:this.page}}},model_prototype:{for_template:function(){return this.toJSON()},url:function(){return"/admin/snippets/"+this.get("id")}},view_prototype:{events:{"click a.edit":"edit"},edit:function(t){t.preventDefault(),$("#general-modal").jqm({ajax:"/admin/snippets/"+this.model.get("id")+"/edit",modal:!1,onHide:function(t){t.w.fadeOut(100),t.o.fadeOut(100)},onShow:function(){},onLoad:function(t){t.w.fadeIn(50),t.o.fadeIn(100)},overlay:40}).jqmShow()},tagName:"tr",template:Handlebars.compile("<td>{{key}}</td><td>{{value}}</td><td class='action right'><a href='#' rel='nofollow' id='edit-{{id}}' class='edit button small-button'>Edit</a></td>")},app_view_prototype:{events:{"click #add-snippet":"create"},initialize:function(){this.collection=this.options.collection,this.view_prototype=this.options.view_prototype,_.bindAll(this,"render"),this.collection.bind("reset",this.render),this.bind_create(),this.search()},create:function(){$("#general-modal").jqm({ajax:"/admin/snippets/new",modal:!1,onHide:function(t){t.w.fadeOut(100),t.o.fadeOut(100)},onShow:function(){},onLoad:function(t){t.w.fadeIn(50),t.o.fadeIn(100)},overlay:20}).jqmShow()},bind_create:function(){var t=this;$("#general-modal").bind("ajax:success",function(e,i){_.isEmpty(i.errors)?(t.search(),$("#general-modal").jqmHide()):_.each(i.errors,function(t,e){$("#snippet_"+e).parent().addClass("field_with_errors"),$("#snippet_"+e).parent().append($("<span>"+t+"</span>"))})})},render:function(){var t=this;this.$("#snippets-list tbody").empty(),_.each(this.collection.models,function(e){var i=new t.view_prototype({model:e});this.$("#snippets-list tbody").append(i.render().el)}),this.render_pagination()}},bind_prototypes:function(){this.collection_prototype=Backbone.Collection.extend(this.collection_prototype),this.model_prototype=Backbone.Model.extend(this.model_prototype),this.app_view_prototype.el=$("#container"),this.app_view_prototype=Backbone.View.extend(this.app_view_prototype),this.view_prototype=Backbone.View.extend(this.view_prototype)},boot:function(){this.bind_prototypes(),this.collection=new this.collection_prototype,this.collection.model=this.model_prototype,this.view=new this.app_view_prototype({collection:this.collection,view_prototype:this.view_prototype})}});Handlebars.registerHelper("applyDefaults",function(t){_.defaults(this,t.hash)}),Handlebars.registerHelper("attachmentComposer",function(t){if(!t.hash)return new Handlebars.SafeString('<code style="color: red">DEPRECATION: Please use the new attachmentComposer syntax: {{attachmentComposer field="example"}}</code>');var e=new slices.AttachmentComposerView({id:slices.fieldId(this,t.hash.field),collection:this[t.hash.field],fields:t.fn,autoAttach:!0,allowDupes:t.hash.allowDupes});return new Handlebars.SafeString(e.placeholder())}),slices.renderAssetLibrary=function(t){return t=t||{},t.el||(document.write('<div id="asset-library" class="asset-library">'),t.el="#asset-library"),new slices.AssetLibraryView(t)},slices.assetDrawer=function(){if(!slices._assetDrawer){var t=$('<div id="asset-drawer" class="asset-library">').appendTo("body");slices._assetDrawer=slices.renderAssetLibrary({el:t,mode:"drawer"})}return slices._assetDrawer},$(function(){$("#children").on("change",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).val();$(this).find("option:selected").removeAttr("selected"),$(this).find("option:first").attr("selected","selected"),e.match(/pages\/new/)?$("#general-modal").jqm({ajax:e,modal:!1,onHide:function(t){t.w.fadeOut(100),t.o.fadeOut(100)},onShow:function(){},onLoad:function(t){t.w.fadeIn(50),t.o.fadeIn(100)},overlay:40}).jqmShow():e.length>0&&(window.location.pathname=e)})}),Handlebars.registerHelper("composer",function(t){var e=new slices.ComposerView({id:slices.fieldId(this,t.hash.field),value:this[t.hash.field],min:t.hash.min,max:t.hash.max,fields:t.fn,addLabel:t.hash.addLabel,autoAttach:!0});return new Handlebars.SafeString(e.placeholder())}),Handlebars.registerHelper("dateField",function(t){var e=new slices.DateFieldView({id:slices.fieldId(this,t.hash.field),name:t.hash.field,value:this[t.hash.field],autoAttach:!0});return new Handlebars.SafeString(e.placeholder())}),slices.ENTRY_TEMPLATES={name:function(){return'<td class="name"><a href="{{url}}">{{name}}</a></td>'},url:function(){return null},_default:function(t){return'<td class="{{'+t+'}}">{{'+t+"}}</td>"}},slices.registerEntryTemplate=function(t,e){slices.ENTRY_TEMPLATES[t]=e},slices.entryTemplate=function(t){var e=slices.ENTRY_TEMPLATES[t]||slices.ENTRY_TEMPLATES._default;return e(t)},slices.getValue=function(t){return t=$(t),t.data("computed-value")?t.data("computed-value"):"array"===t.data("type")?t.val().split("||"):t.is(":checkbox")?t.is(":checked"):t.is(":has(:radio)")?t.find(":checked").val():t.val()},slices.getValueForId=function(t){return slices.getValue("#"+t)},slices.HOOKS={},slices.on=function(t,e){slices.HOOKS[t]=slices.HOOKS[t]||[],slices.HOOKS[t].push(e)},slices.trigger=function(t){var e=slices.HOOKS[t];e&&_.invoke(e,"call")},slices_paths={thinking:"/assets/slices/icon_upload_thinking.png",happy:"/assets/slices/icon_upload_happy.png",sad:"/assets/slices/icon_upload_sad.png"},$(function(){$(window).scroll(function(){$("#container-actions").css($(window).scrollTop()>=40?{position:"fixed",top:"0",width:"100%"}:{position:"absolute",top:"40px",width:"100%"})})}),Handlebars.registerHelper("markdownCheatSheet",function(){return new Handlebars.SafeString('<div class="markdown-cheat-sheet"><h4>Markdown Cheat Sheet</h4><div class="columns"><div class="column"><code># This is an &lt;h1&gt;</code><code>## This is an &lt;h2&gt;</code><code>###### This is an &lt;h6&gt;</code><code>*This text will be italic*</code><code>**This text will be bold**</code><code>*You **can** combine them*</code><code>[A Link](http://example.com/)</code><code>![An Image](http://example.com/example.jpg)</code></div><div class="column"><code>* An\n* Unordered\n* List</code><code>1. An\n2. Ordered\n3. List\n   * With\n   * Sub\n   * List</code><code>The following is a blockquote:\n\n> Sed posuere consectetur est at lobortis. Aenean lacinia\n> bibendum nulla sed consectetur. Maecenas sed diam eget\n> risus varius blandit sit amet non magna.</code></div></div></div>')}),$(document).on("click",".markdown-cheat-sheet h4",function(){$(this).parent().toggleClass("display")}),Handlebars.registerHelper("moment",function(t,e){var i=moment(t),s=e.hash.format;return s&&"calendar"!==s?i.format(s):i.calendar()}),Handlebars.registerHelper("radioField",function(t){var e=new slices.RadioFieldView({id:slices.fieldId(this,t.hash.field),name:t.hash.field,value:this[t.hash.field],inner:t.fn,autoAttach:!0});return new Handlebars.SafeString(e.placeholder())}),$(function(){function t(e){var i=[];return e.find(">li:not(.set-link)").each(function(){var e=$(this),s={id:e.attr("rel")},n=e.find(">ol");n.length&&n.find(">li:not(.set-link)").length&&(s.children=t(n)),i.push(s)}),i}function e(t){var e=[],i=[];$("#sitemap li h2, #virtual-pages li h2").each(function(){$(this).text().search(new RegExp(t,"i"))>-1?e.push($(this).closest("li")[0]):i.push($(this).closest("li")[0])}),$(i).find("div").hide(),$(e).find("div").show()}function i(){var t=JSON.parse(localStorage.getItem("sitemap.hidden"));$(".toggle-children").filter(function(){var e=$(this).attr("href").substring(1);return $.inArray(e,t)>=0}).each(function(){n(this,!1,!0)})}function s(){var t=$(".page-children.hidden").map(function(){return $(this).attr("id")}).toArray();localStorage["sitemap.hidden"]=JSON.stringify(t)}function n(t,e,i){var n=$(t),o=n.attr("href"),r=$(o);e?(i?r.show():r.slideDown("fast"),r.removeClass("hidden"),n.removeClass("active")):(i?r.hide():r.slideUp("fast"),r.addClass("hidden"),n.addClass("active")),s()}function o(){n(this,!0)}function r(){n(this,!1)}var a=27,l=!0,h=$("#sitemap-search");h.length&&(h.on("keyup click",function(t){if(t.which===a){if(""===$(this).val())return void $(this).blur();$(this).val("")}e($(this).val())}),$(document).on("keypress",function(t){(102===t.which&&t.metaKey||6===t.which&&t.ctrlKey)&&(t.preventDefault(),h.focus())})),$("#sitemap-form").bind("submit",function(){if(l)return!1;var e=t($("#sitemap"));return $.ajax({url:"/admin/site_maps/update",type:"PUT",data:JSON.stringify({sitemap:e}),contentType:"application/json",dataType:"json",success:function(){location.reload()},error:function(){}}),!1}),$(".add-child").bind("click",function(){return $("#general-modal").jqm({ajax:this.href,modal:!1,onHide:function(t){t.w.fadeOut(100),t.o.fadeOut(100)},onShow:function(){},onLoad:function(t){t.w.fadeIn(50),t.o.fadeIn(100)},overlay:40}).jqmShow(),!1}),$("a.delete").toggle(),$("#structure-locked a").bind("click",function(){return l=!l,$("#sitemap").toggleClass("unlocked"),$("#structure-locked, #structure-unlocked").toggle(),$("a.delete").toggle(),l?$("html").removeClass("sitemap-unlocked"):$("html").addClass("sitemap-unlocked"),$sitemap=$("#sitemap > li > ol"),$sitemap.nestedSortable({forcePlaceholderSize:!0,toleranceElement:"> div",disableNesting:"no-nest",placeholder:"placeholder",errorClass:"nested-error",tolerance:"pointer",tabSize:25,opacity:.6,scroll:!1,handle:"div",items:"li",beforeStart:function(){$sitemap.freezeHeight(),window.autoscroll.start()},stop:function(){$sitemap.thawHeight(),window.autoscroll.stop()}}),!1}),$(".hide-all-children").click(function(){$(".toggle-children").each(r)}),$(".show-all-children").click(function(){$(".page-children:hidden .page-children").show(),$(".toggle-children").each(o)}),$(".toggle-children").click(function(t){t.preventDefault();var e=$(this),i=e.attr("href"),n=$(i);n.slideToggle("fast").toggleClass("hidden"),e.toggleClass("active"),s()}),0==$(".page-children .page-children").size()&&$(".toggle-actions").hide(),i()}),slices.defaultSlicePreview=function(){if(this.find(".attachment-list").length){var t=this.find(".attachment-list li").length;return t+(1===t?" item":" items")}var e=this.find('textarea, input[type="text"]').map(function(){return $(this).val()}).get().join(" ");return $("<div />").html(e).text()},Handlebars.registerHelper("slicePreview",function(t){try{var e=t.fn&&t.fn();e.match(/\S/)&&(window.customSlicePreview=new Function(e))}catch(i){console.error("This slicePreview caused an error:\n"+e),console.error(i)
}});var Tagging={detect:function(){var t=this;$(".multi-tag-list").each(function(e,i){t.setup_multi(i)}),$(".single-tag-list").each(function(e,i){t.setup_single(i)})},setup_single:function(t){var e=this,i=$(t);if(i.length){var s=i.parent().find("input");i.children("li").click(function(t){var n=$(t.target),o=$.trim(n.text()).replace(/\,\s*$/,"");s.val(o).trigger("change"),e.mark_active_tags(i,s.val())}),e.mark_active_tags(i,s.val())}},setup_multi:function(t){var e=this,i=$(t);if(i.length){var s=i.parent().find("input");i.children("li").click(function(t){var i=$(t.target),n=$.trim(i.text()).replace(/\,\s*$/,""),o=new RegExp(n+",?");if(i.hasClass("on")){var r=s.val().replace(o,"");r=e.strip_whitespace(r),s.val(r).trigger("change"),i.removeClass("on")}else{var r=s.val()+", "+n;r=e.strip_whitespace(r),s.val(r).trigger("change"),i.addClass("on")}}),e.mark_active_tags(i,s.val())}},mark_active_tags:function(t,e){var i=this;t.children("li").each(function(t,s){var n=$(s),o=new RegExp(i.strip_whitespace(n.text()));e.match(o)?n.addClass("on"):n.removeClass("on")})},strip_whitespace:function(t){return t=t.replace(/[\,\s\s+]*$/g,"").replace(/^[\,\s+]*/g,"").replace(/\s\s+/," ")}};Handlebars.registerHelper("tokenField",function(t){var e=new slices.TokenFieldView({id:slices.fieldId(this,t.hash.field),values:this[t.hash.field],options:t.hash.options&&this[t.hash.options],singular:"true"===t.hash.singular,autoAttach:!0});return new Handlebars.SafeString(e.placeholder())}),slices.UPLOAD_ICONS={thinking:"/assets/slices/icon_upload_thinking.png",happy:"/assets/slices/icon_upload_happy.png",sad:"/assets/slices/icon_upload_sad.png"},slices.Uploader=function(t){this.options=$.extend({},this.options,t),this.initialize()},$.extend(slices.Uploader.prototype,Backbone.Events,{options:{url:"/admin/assets.json"},initialize:function(){this.files=[],this.button=$(this.options.button),this.input=this.createInput(),this.drop=$(this.options.drop),this.configureCSRF(),this.observeEvents()},configureCSRF:function(){var t=$('meta[name="csrf-param"]').attr("content"),e=$('meta[name="csrf-token"]').attr("content");this.options.params=this.options.params||{},this.options.params[t]=e},createInput:function(){return $("<input />",{type:"file",multiple:"multiple",style:"position: absolute; visibility: hidden"}).appendTo("body")},observeEvents:function(){var t=this;this.input.on("change",function(e){t.onInputChange(e)}),this.button.on("click",function(e){t.onButtonClick(e)}),this.drop.on("dragenter",!1),this.drop.on("dragover",!1),this.drop.on("drop",function(e){t.onDrop(e)})},onInputChange:function(){this.addFiles(this.input.prop("files")),this.input.val("")},onButtonClick:function(t){t.preventDefault(),this.input.click()},onDrop:function(t){t.preventDefault(),this.addFiles(t.originalEvent.dataTransfer.files)},addFiles:function(t){var e=this;_(t).each(function(t){var i=new slices.fileClass({uploader:this,uploadOptions:this.uploadOptions(),browserFile:t});e.files.push(i)},this),this.trigger("filesAdded",{uploader:this,files:this.files})},uploadOptions:function(){return{url:this.options.url,params:this.options.params}},start:function(){return 0==this.files.length||void 0!=this.file?!1:(this.file=this.files.shift(),void this.file.start())},onprogress:function(t){this.trigger("fileProgress",t)},onload:function(t){this.trigger("fileUploaded",t),this.file=void 0,this.start()},onfail:function(t){this.trigger("fileError",t),this.file=void 0,this.start()},toString:function(){return"slices.Uploader"}}),Handlebars.registerHelper("urlField",function(t){var e=new slices.UrlFieldView({id:slices.fieldId(this,t.hash.field),name:t.hash.field,value:this[t.hash.field],autoAttach:!0});return new Handlebars.SafeString(e.placeholder())}),slices.AssetEditorView=Backbone.View.extend({className:"asset-editor",template:Handlebars.compile('<div class="fields"><div class="overview"><div class="thumb asset-library-item"><img src="{{thumbUrl}}" alt="{{name}}"><span class="name">{{displayName}}</span></div><div class="meta"><dl class="details"><dd><input type="text" name="name" value="{{name}}"></dd><dd>{{size}}</dd><dd>Added {{createdAt}}</dd><dd><a href="{{originalUrl}}">Download original</a></dd></dl><div class="options"><button data-action="replace">Upload a New Version</button></div></div></div><div class="tabs"><div class="tab meta"><label>Tags</label><textarea name="tags" rows="5">{{tags}}</textarea></div>{{#if pages}}<div class="tab pages"><label>Appears on</label><ul>{{{pages}}}</ul></div>{{/if}}</div></div><div class="bottom-toolbar"><div class="button-group aligned-right"><button type="submit" data-action="save">Save Changes</button><button data-action="cancel">Cancel</button></div><div class="button-group pinned left top"><button data-action="delete" class="delete">Delete</button></div></div>'),pageItemTemplate:Handlebars.compile('<li><a href="/admin/pages/{{id}}" target="_blank">{{name}}</a></li>'),events:{'click [data-action="save"]':"save",'click [data-action="cancel"]':"cancel",'click [data-action="delete"]':"destroy"},initialize:function(){_.bindAll(this),this.model.on("change",this.render)},render:function(){return $(this.el).html(this.template(this)),this.makeUploader(),this},thumbUrl:function(){return this.model.get("asset_url")||"/assets/slices/icon_generic_file.png"},originalUrl:function(){return this.model.get("original_url")},name:function(){return this.model.get("name")},tags:function(){return this.model.get("tags")},pages:function(){return _.map(this.model.get("pages"),this.pageItemTemplate).join("")},url:function(){return this.model.url()},displayName:function(){return this.model.isImage()?void 0:this.name()},createdAt:function(){return moment(this.model.get("created_at")).calendar()},size:function(){return humanFileSize(this.model.get("file_file_size"))},save:function(){this.model.save({name:this.$('[name="name"]').val(),tags:this.$('[name="tags"]').val()},{success:this.whenSaveSucceeds,error:this.whenSaveFails})},whenSaveSucceeds:function(){this.close()},whenSaveFails:function(){},cancel:function(){this.close()},destroy:function(){confirm("Are you sure you want to delete this asset?")&&(this.model.destroy(),this.close())},close:function(){this.trigger("close")},makeUploader:function(){this.uploader=new slices.Uploader({button:this.$('[data-action="replace"]'),drop:this.$(".thumb"),url:this.model.url(),params:{_method:"put"}}),this.uploader.bind("filesAdded",this.onFilesAdded),this.uploader.bind("fileUploaded",this.onFileUploaded)},onFilesAdded:function(t){var e=t.files,i=e[0];this.fileView=new slices.FileView({model:i}),this.$(".thumb").append(this.fileView.el),this.fileView.model.upload(i),this.uploader.start()},onFileUploaded:function(t){this.model.set(t.response)},updateFileStatus:function(t){this.fileView.model.upload(t)}}),slices.AssetEditorView.openModal=function(t){var e=new slices.AssetEditorView(t),i=$('<div class="jqmWindow modal" id="asset_editor_modal">');return i.appendTo("body").append(e.el).jqm({modal:!0,onShow:function(t){t.w.fadeIn(150),i.fadeIn(300)},onHide:function(t){t.w.fadeOut(150,function(){e.remove()}),t.o.fadeOut(300,function(){i.remove()})},overlay:40}).jqmShow(),e.render(),e.bind("close",function(){i.jqmHide()}),e},slices.AssetLibraryView=Backbone.View.extend({DRAG_THRESHOLD:15,DRAWER_HEIGHT:250,events:{'keyup [type="search"]':"search",'click [type="search"]':"search",'click [data-action="close"]':"close",'click [data-action="show-all"]':"showAll","mousedown .library-container":"backgroundPress","mousedown .resize-handle":"startResize"},thumbs:{},selection:[],currentSearchTerm:"",className:"asset-library",template:Handlebars.compile('<div class="toolbar">{{{resizeHandle}}}<input type="search" id="assets-search" placeholder="Search assets..."><div class="count"></div>{{{hint}}}<div class="actions"><ul>{{actions}}</ul></div></div><div class="library-container"><ul class="library"></ul></div>'),initialize:function(){_.bindAll(this),this.collection=new slices.AssetCollection,this.collection.bind("add",this.add),this.collection.bind("remove",this.remove),this.collection.bind("reset",this.reset),$(window).on("assets:uploadCompleted",this.fetch),this.render(),this.scrollArea=this.$(".library-container"),this.scrollArea.on("scroll",this.onScroll),this.initializeUploader(),this.showLoadingSpinner(),this.fetch()},render:function(){return $(this.el).html(this.template(this)),this},reset:function(){this.clearThumbs(),this.collection.each(this.add)},add:function(t){var e=new slices.AssetThumbView({model:t,selectable:!0});e.bind("thumb:press",this.thumbPress),e.bind("thumb:release",this.thumbRelease),e.bind("thumb:blur",this.thumbBlur),this.loadingSpinner().before(e.render().el),this.thumbs[t.cid]=e,this.updateCount()},remove:function(t){this.clearThumb(t.cid),this.updateCount()},search:function(t){27==t.which&&this.$('[type="search"]').val(""),this._search(t)},_search:_.debounce(function(){var t=this.searchTerm();t!==this.currentSearchTerm&&(this.currentSearchTerm=t,this.fetch())},300),showAll:function(){this.uploader.files.length>0?alert("Uploads are still in progress, please wait for them to finish."):this.fetch()},clearThumbs:function(){this.updateCount("Searching\u2026");for(var t in this.thumbs)this.clearThumb(t)},clearThumb:function(t){var e=this.thumbs[t];this.selection=_(this.selection).without(e),e.remove(),delete this.thumbs[t]},searchTerm:function(){return this.$('[type="search"]').val()},hint:function(){return"drawer"===this.options.mode?'<div class="hint">Drag &amp; drop to place on the page</div>':void 0},resizeHandle:function(){return"drawer"===this.options.mode?'<div class="resize-handle"></div>':void 0},actions:function(){var t=[];return t.push('<li><a class="button" data-action="upload">Upload</a></li>'),"drawer"===this.options.mode&&t.push('<li><a class="button" data-action="close">Close</a></li>'),new Handlebars.SafeString(t.join(""))},open:function(t){$("#container").stop().animate({paddingBottom:this.DRAWER_HEIGHT+"px"}),$(this.el).stop().animate({height:this.DRAWER_HEIGHT+"px"},_.extend({},t,{complete:this.afterOpen}))},afterOpen:function(){this.$('input[type="search"]')[0].focus()},close:function(){this.$('input[type="search"]')[0].blur(),$("#container").stop().animate({paddingBottom:"0px"}),$(this.el).stop().animate({height:"0px"})},thumbPress:function(t,e){if(_.invoke(this.selection,"deselect"),t.shiftKey)if(0===this.selection.length)this.selection.push(e),this.selectionAnchor=e;else{var i=this.selectionAnchor,s=this.collection.indexOf(i.model),n=this.collection.indexOf(e.model),o=Math.min(s,n),r=Math.max(s,n);this.selection=[];for(var a=o;r>=a;a++){var e=this.thumbs[this.collection.at(a).cid];this.selection.push(e)}}else t.metaKey?(_(this.selection).include(e)?this.selection=_(this.selection).without(e):this.selection.push(e),this.selectionAnchor=_.sortBy(this.selection,function(t){return t.model.collection.indexOf(t.model)})[0]):_(this.selection).include(e)||(this.selection=[e],this.selectionAnchor=e);_.invoke(this.selection,"select"),this.selection.length>0&&this.prepareForDrag(t),this.listenForKeys()},thumbRelease:function(t,e){t.metaKey||t.shiftKey||(_.invoke(this.selection,"deselect"),this.selection=[e],this.selectionAnchor=e,_.invoke(this.selection,"select"))},thumbBlur:function(){this.deselectAll()},backgroundPress:function(t){t.shiftKey||t.metaKey||(t.preventDefault(),t.stopImmediatePropagation(),this.deselectAll())},deselectAll:function(){_.invoke(this.selection,"deselect"),this.selection=[]},selectedAssets:function(){return _.pluck(this.selection,"model")},updateCount:function(t){this.$(".count").html(t||this.countMessage())},countMessages:{"default":{none:Handlebars.compile("No assets, yet\u2026"),one:Handlebars.compile("Showing 1 asset"),some:Handlebars.compile("Showing latest {{count}} assets of {{total}} total"),all:Handlebars.compile("Showing all {{count}} assets, latest first")},uploads:{one:Handlebars.compile('Showing 1 new asset (<a data-action="show-all">Show everything</a>)'),some:Handlebars.compile('Showing {{count}} new assets (<a data-action="show-all">Show everything</a>)')},search:{none:Handlebars.compile("No matching assets"),one:Handlebars.compile("Showing 1 matching asset"),some:Handlebars.compile("Showing latest {{count}} matching assets of {{total}} total"),all:Handlebars.compile("Showing all {{count}} maching assets, latest first")}},countMessage:function(){var t=this.countMessages,e=this.collection.totalEntries,i=this.collection.length;return this.inUploadView?(t=t.uploads,1===i?t.one({count:i}):t.some({count:i})):(t=this.currentSearchTerm?t.search:t["default"],0===e?t.none():1===e?t.one():e>i?t.some({total:e,count:i}):t.all({total:e,count:i}))},NEXT_PAGE_THRESHOLD:600,onScroll:_.debounce(function(){if(!this.loading&&!this.inUploadView){var t=this.$(".library"),e=this.scrollArea.scrollTop(),i=e+this.scrollArea.height(),s=t.height()-i;s<=this.NEXT_PAGE_THRESHOLD&&this.collection.hasMorePages()&&(this.showLoadingSpinner(),this.fetch({add:!0}))}},300),loadingSpinner:_.memoize(function(){return $('<li class="loading-indicator"><span class="label">Loading&hellip;</label></li>').appendTo(this.$(".library"))}),showLoadingSpinner:function(){this.loadingSpinner().css({display:"block"})},hideLoadingSpinner:function(){this.loadingSpinner().css({display:"none"})},fetch:function(t){t=_.extend({add:!1},t),this.loading=!0,this.exitUploadView(),this.showLoadingSpinner(),t.add||this.collection.reset(),this.collection.fetch({data:{search:this.searchTerm(),page:t.add?this.collection.currentPage+1:1},add:t.add,success:this.onFetchSuccess})},onFetchSuccess:function(){this.loading=!1,this.hideLoadingSpinner(),this.updateCount()},prepareForDrag:function(t){$(document).on("mousemove",this.onDrag).on("mouseup",this.stopDrag),this.dragOrigin={x:t.pageX,y:t.pageY}},onDrag:function(t){this.dragging?(this.dragHelper.css({left:t.pageX+"px",top:t.pageY+"px"}),this.reviewReceiversForDrag(t.pageX,t.pageY)):this.testDragTreshold(t)},testDragTreshold:function(t){var e=Math.max(Math.abs(t.pageX-this.dragOrigin.x),Math.abs(t.pageY-this.dragOrigin.y));e>=this.DRAG_THRESHOLD&&this.startDrag(t)},startDrag:function(t){this.dragging=!0,this.dragHelper=$('<span class="asset-drag-helper">'),this.dragHelper.css({position:"absolute"});for(var e in this.selection){var i=this.selection[e],s=i.$("img").clone(!1);this.dragHelper.append(s)}this.dragHelper.appendTo("body");var n=Math.ceil(Math.sqrt(this.selection.length))*(this.dragHelper.width()/this.selection.length);this.dragHelper.width(n),this.receivers=[this],$(window).trigger("assets:dragStarted",this),window.autoscroll.start(),this.onDrag(t)},stopDrag:function(t){$(document).off("mousemove",this.onDrag).off("mouseup",this.stopDrag),window.autoscroll.stop(),this.dragHelper&&(this.dragHelper.remove(),delete this.dragHelper),delete this.dragging,this.reviewReceiversForDrop(t.pageX,t.pageY),delete this.receivers},registerReceiver:function(t){this.receivers.push(t)},reviewReceiversForDrag:function(t,e){var i=this.identifyReceiver(t,e);_.each(this.receivers,function(s){s!==i?s.assetsNotOver():s.assetsOver(t,e)})},reviewReceiversForDrop:function(t,e){_.invoke(this.receivers,"assetsNotOver");var i=this.identifyReceiver(t,e);i&&i.receiveAssets(this.selectedAssets(),t,e)},identifyReceiver:function(t,e){return _.find(this.receivers,function(i){return i.withinBounds(t,e)})},withinBounds:function(t,e){var i=$(this.el).offset(),s=i.top,n=i.left,o=s+$(this.el).height(),r=n+$(this.el).width();return t>=n&&r>=t&&e>=s&&o>=e},assetsOver:function(){},assetsNotOver:function(){},receiveAssets:function(){},keydown:function(t){this.selection.length>0&&8===t.which&&(t.preventDefault(),t.stopImmediatePropagation(),this.destroySelection())},destroySelection:function(){if(1===this.selection.length)var t="Are you sure you want to delete this asset?";else var t=Handlebars.compile("Are you sure you want to delete these {{count}} assets?")({count:this.selection.length});confirm(t)&&_.invoke(this.selectedAssets(),"destroy")},listenForKeys:function(){this.listeningForKeys||(this.listeningForKeys=!0,$(window).on("keydown",this.keydown),$(window).one("mousedown",this.stopListeningForKeys))},stopListeningForKeys:function(){this.listeningForKeys=!1,$(window).off("keydown",this.keydown)},startResize:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.resizeOrigin={y:t.pageY,h:this.$el.height()},$(window).on("mousemove",this.performResize).on("mouseup",this.endResize)},performResize:function(t){var e=t.pageY-this.resizeOrigin.y,i=Math.max(this.resizeOrigin.h-e,this.DRAWER_HEIGHT);this.$el.height(i)},endResize:function(){$("#container").css({paddingBottom:this.$el.height()+"px"}),$(window).off("mousemove",this.performResize).off("mouseup",this.endResize)},initializeUploader:function(){this.uploader||(this.uploader=new slices.Uploader({button:this.$el.find('[data-action="upload"]'),drop:this.$el.find(".library-container")}),this.uploader.on("filesAdded",this.onFilesAdded),this.uploader.on("fileUploaded",this.onFileUploaded))},onFilesAdded:function(t){this.enterUploadView(),_(t.files).each(function(t){var e=new slices.Asset({file:t});t.asset=e,this.collection.add(e),this.updateFileStatus(t)},this),this.uploader.start()},onFileUploaded:function(t){var e=t.file,i=t.response,s=e.asset;s.set(i),this.viewForFile(e).updateFileAndComplete(e)},enterUploadView:function(){this.inUploadView||(this.inUploadView=!0,this.collection.reset(),this.$('[type="search"]').hide(),this.updateCount("Uploading\u2026"))},exitUploadView:function(){this.inUploadView&&(this.inUploadView=!1,this.$('[type="search"]').show(),this.updateCount())},updateFileStatus:function(t){this.viewForFile(t).updateFile(t)},viewForFile:function(t){return this.thumbs[t.asset.cid]}}),slices.AssetThumbView=Backbone.View.extend({tagName:"li",className:"asset-library-item",happyTime:1e3,template:Handlebars.compile('<img src="{{src}}" alt="{{name}}"><span class="name">{{displayName}}</span><dl class="meta"><dd><strong class="filename">{{name}}</strong></dd><dd>{{size}}</dd><dd>Added {{createdAt}}</dd><dd><a href="{{url}}" data-action="edit">Edit</a></dd></dl>'),events:{mousedown:"press",mouseup:"release",'mousedown [data-action="edit"]':"pressEdit",'click [data-action="edit"]':"releaseEdit"},initialize:function(){_.bindAll(this),this.$el.append('<div class="asset-details">'),this.model.bind("change",this.whenModelChanges),this.model.bind("destroying",this.whenModelIsDestroying)},render:function(){return this.$el.find(".asset-details").html(this.template(this)),this},src:function(){return this.model.get("asset_url")||"/assets/slices/icon_generic_file.png"},name:function(){return this.model.get("name")},url:function(){return this.model.url()},displayName:function(){return this.model.isImage()?void 0:this.name()},createdAt:function(){return moment(this.model.get("created_at")).calendar()},size:function(){return humanFileSize(this.model.get("file_file_size"))},select:function(){$(this.el).addClass("selected")},deselect:function(){$(this.el).removeClass("selected")},selected:function(){return $(this.el).hasClass("selected")},remove:function(){this.unbind(),$(this.el).remove()},press:function(t){this.options.selectable&&1===t.which&&(t.preventDefault(),t.stopImmediatePropagation(),this.trigger("thumb:press",t,this))},release:function(t){this.options.selectable&&1===t.which&&this.trigger("thumb:release",t,this)},pressEdit:function(t){t.stopImmediatePropagation()},releaseEdit:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.trigger("thumb:blur");var e=$(this.el);e.addClass("editing");var i=slices.AssetEditorView.openModal({model:this.model});i.bind("close",function(){_.delay(function(){e.removeClass("editing")},350)})},whenModelChanges:function(){this.render()},whenModelIsDestroying:function(){$(this.el).addClass("destroying")},updateFile:function(){this.fileView||this.makeFileView(),$(this.el).removeClass(this.fileView.possibleStatusList).addClass("status-"+this.fileView.model.status())},updateFileAndComplete:function(t){this.updateFile(t),this.gracefullyRemoveFileView()},makeFileView:function(){this.fileView=new slices.FileView({model:this.model.get("file")}),this.$el.append(this.fileView.el),$(this.fileView.el).css({position:"absolute",top:0})},removeFileView:function(){this.fileView&&(this.fileView.remove(),delete this.fileView)},gracefullyRemoveFileView:function(){$.when(this.thumbnailHasLoaded(),this.happyTimeHasPassed()).then(this.resolveGracefully)},resolveGracefully:function(){this.$(".asset-details").css({opacity:0}),$(this.fileView.el).animate({opacity:0},"fast",_.bind(function(){this.removeFileView(),this.$(".asset-details").animate({opacity:1})},this))},thumbnailHasLoaded:function(){var t=new $.Deferred;return this.$("img").load(t.resolve),t.promise()},happyTimeHasPassed:function(){var t=new $.Deferred;return _.delay(t.resolve,this.happyTime),t.promise()}}),slices.AttachmentComposerView=Backbone.View.extend({DROP_THRESHOLD:15,views:{},events:{'click [data-action="library"]':"openAssetDrawer",'click [data-action="remove"]':"removeClicked"},template:Handlebars.compile('<ol class="attachment-list"></ol><div class="attachment-actions"><button data-action="library">Choose from Library</button><button data-action="upload">Upload from computer</button></div>'),className:"attachment-composer",broadcastChanges:!0,initialize:function(){_.bindAll(this),this.collection=new slices.AttachmentCollection(this.options.collection),this.collection.bind("add",this.addAttachment),this.collection.bind("remove",this.removeAttachment),this.collection.bind("change",this.update),this.collection.bind("reset",this.update),$(window).on("assets:dragStarted",this.onAssetDragStarted),this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},render:function(){return this.broadcastChanges=!1,$(this.el).html(this.template(this)),this.collection.each(this.addAttachment),this.makeSortable(),this.makeUploader(),this.update(),this.broadcastChanges=!0,this},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),this.render()},addAttachment:function(t,e,i){var s=new slices.AttachmentView({fields:this.options.fields,model:t});i.index<e.length-1?s.$el.insertBefore(this.$(".attachment-list").children()[i.index]):this.$(".attachment-list").append(s.el),s.render(),this.views[t.cid]=s,this.update()},removeAttachment:function(t){var e=this.views[t.cid];e.remove(),delete this.views[t.cid],t.file&&this.uploader.removeFile(t.file),this.update()},update:function(){var t=this.collection.toJSON(),e=$(this.el);t=_.reject(t,function(t){return null==t.asset_id}),e.data("computed-value",t),e[this.collection.isEmpty()?"removeClass":"addClass"]("not-empty"),this.broadcastChanges&&e.trigger("change")},removeClicked:function(t){var e=$(t.target),i=e.parent("li"),s=i.data("model");this.collection.remove(s)},openAssetDrawer:function(t){t.preventDefault(),t.stopImmediatePropagation(),slices.assetDrawer().open({step:this.assetDrawerStep})},assetDrawerStep:function(){var t=$(this.el),e=t.offset().top+t.outerHeight()+30,i=$(slices.assetDrawer().el).offset().top;if(e>i){var s=$("body");s.scrollTop(s.scrollTop()+(e-i))}},viewForFile:function(t){return this.views[t.attachment.cid]},makeSortable:function(){this.$(".attachment-list").sortable({handle:".attachment-thumb",scroll:!1,beforeStart:_.bind(function(){this.attachmentList().freezeHeight(),window.autoscroll.start()},this),stop:_.bind(function(){this.attachmentList().thawHeight(),window.autoscroll.stop()},this),update:this.updateOnSort})},updateOnSort:function(){var t=_.map(this.$(".attachment-list li").get(),function(t){return $(t).data("model")});this.collection.reset(t)},makeUploader:function(){this.uploader=new slices.Uploader({button:this.$('[data-action="upload"]'),drop:this.el}),this.uploader.bind("filesAdded",this.onFilesAdded),this.uploader.bind("fileUploaded",this.onFileUploaded)},onFilesAdded:function(t){{var e=t.files;t.uploader}_(e).each(function(t){var e=new slices.Attachment({asset:new slices.Asset({file:t})});t.attachment=e,this.collection.add(e),this.updateFileStatus(t)},this),this.uploader.start()},onFileUploaded:function(t){var e=t.file,i=t.response,s=e.attachment,n=s.get("asset");s.set({asset_id:i.id}),n.set(i),this.viewForFile(e).updateFileAndComplete(e),this.update(),$(window).trigger("assets:uploadCompleted")},updateFileStatus:function(t){this.viewForFile(t).updateFile(t)},onAssetDragStarted:function(t,e){e.registerReceiver(this)},withinBounds:function(t,e){var i=$(this.el).offset(),s=i.top-this.DROP_THRESHOLD,n=i.left-this.DROP_THRESHOLD,o=s+$(this.el).height()+2*this.DROP_THRESHOLD,r=n+$(this.el).width()+2*this.DROP_THRESHOLD;return t>=n&&r>=t&&e>=s&&o>=e},cursor:function(){return this._cursor=this._cursor||$('<li class="cursor">')},assetsOver:function(t,e){this.$el.addClass("assets-over");var i=this.findPlacementPoint(t,e),s=this.placementPoint&&i&&this.placementPoint.index===i.index;this.placementPoint=i,s||(i?this.cursor().insertBefore(i.view.el):this.cursor().appendTo(this.$(".attachment-list")))},assetsNotOver:function(){this.$el.removeClass("assets-over"),this.cursor().detach(),delete this.placementPoint},receiveAssets:function(t,e,i){var s=this.findPlacementPoint(e,i),n=s?s.index:this.collection.length;_.each(t,function(t){(this.options.allowDupes||!this.alreadyContains(t))&&(this.collection.add({asset:t,asset_id:t.get("id")},{at:n}),n+=1)},this)},findPlacementPoint:function(t,e){var i=null,s=this.views;return this.collection.find(function(t,n){var o=s[t.cid];return o.midPoint().y>e?(i={attachment:t,view:o,index:n},!0):!1}),i},alreadyContains:function(t){var e=t.get("id");return this.collection.any(function(t){return t.get("asset_id")===e})},attachmentList:function(){return this.$(".attachment-list")}}),slices.AttachmentView=Backbone.View.extend({events:{change:"update"},tagName:"li",template:Handlebars.compile('<div class="attachment-thumb"></div><div class="attachment-fields"></div><span data-action="remove" class="remove">Remove</span>'),initialize:function(){_.bindAll(this),$(this.el).data("view",this),$(this.el).data("model",this.model)},render:function(){return $(this.el).html(this.template(this)),this.renderAssetThumb(),this.renderFields(),this},renderAssetThumb:function(){this.model.get("asset")&&(this.assetThumb=new slices.AssetThumbView({model:this.model.get("asset"),selectable:!1,tagName:"div"}),this.$(".attachment-thumb").prepend(this.assetThumb.render().el))},renderFields:function(){_.isFunction(this.options.fields)&&this.$(".attachment-fields").html(this.options.fields(this.model.attributes)).applyDataValues().initDataPlugins()},remove:function(){this.model.unbind("change",this.render),$(this.el).remove()},update:function(){this.model.set(this.getValues())},getValues:function(){var t={};return this.$("[name]").each(function(){var e=$(this);t[e.attr("name")]=slices.getValue(e)}),t},updateFile:function(t){this.assetThumb.updateFile(t)},updateFileAndComplete:function(t){this.assetThumb.updateFileAndComplete(t)},midPoint:function(){return{x:$(this.el).offset().left+$(this.el).width()/2,y:$(this.el).offset().top+$(this.el).height()/2}}}),slices.CalendarView=Backbone.View.extend({events:{'click [data-action="hide"]':"hide",'click [data-action="prev-month"]':"prevMonth",'click [data-action="next-month"]':"nextMonth","mousedown time":"onClickDay"},className:"calendar-modal",template:Handlebars.compile('<span class="background" data-action="hide"></span><div class="calendar"><table><thead><tr><td data-action="prev-month">&larr;</td><th class="month" colspan="5">{{monthName}}</th><td data-action="next-month">&rarr;</td></tr><tr><th class="weekday">M</th><th class="weekday">T</th><th class="weekday">W</th><th class="weekday">T</th><th class="weekday">F</th><th class="weekday">S</th><th class="weekday">S</th></tr></thead><tbody>{{{body}}}</tbody></table></div>'),bodyTemplate:Handlebars.compile('{{#each this}}<tr>{{#each this}}<td><time class="{{klass}}" datetime="{{value}}">{{date}}</time></td>{{/each}}</tr>{{/each}}'),initialize:function(){_.bindAll(this),$(document).on("slices:willSubmit",this.remove),this.setValue(this.options.value),this.$el.appendTo("body"),this.$el.attr("data-state","preparing"),this.$el.hide()},render:function(){return this.$el.html(this.template(this)),this.updatePosition(),this},body:function(){for(var t=[],e=moment().startOf("day"),i=this.month.clone(),s=i.clone().add("months",1),n=i.clone().day(1),o=s.clone().day(7),r=n.clone();o>=r;){1===r.day()&&t.push([]);var a={date:r.date(),value:r.format(),klass:[]};r.is(e)?a.klass.push("today"):i>r?a.klass.push("prev-month"):r>=s&&a.klass.push("next-month"),this.value&&r.is(this.value.clone().startOf("day"))&&a.klass.push("highlight"),a.klass=a.klass.join(" "),t[t.length-1].push(a),r.add("days",1)}return this.bodyTemplate(t)},monthName:function(){return this.month.format("MMMM YYYY")},onClickDay:function(t){var e=$(t.target),i=moment(e.attr("datetime"));this.value&&i.hours(this.value.hours()).minutes(this.value.minutes()),this.setValue(i),this.render(),this.options.onChange&&this.options.onChange()},show:function(){this.resetMonth(),this.$el.show(),this.render(),this.updatePosition(),this.$el.attr("data-state","showing")},hide:function(){this.$el.attr("data-state","hiding");var t=this;setTimeout(function(){t.$el.hide()},250)},toggle:function(){switch(this.$el.data("state")){case"preparing":case"hiding":this.show();break;case"showing":this.hide()}},prevMonth:function(){this.month.subtract("months",1),this.render()},nextMonth:function(){this.month.add("months",1),this.render()},setValue:function(t){this.value=moment(t),this.resetMonth()},resetMonth:function(){this.month=(this.value||moment()).clone().startOf("month")},remove:function(){this.$el.remove()},updatePosition:function(){var t=this.$el.find(".calendar"),e=this.anchor,i=e.offset();i.top+=e.outerHeight(),i.top=i.top+"px",i.left+=e.outerWidth()/2,i.left-=t.outerWidth()/2,i.left=i.left+"px",t.css(i)}}),slices.ComposerItemView=Backbone.View.extend({tagName:"li",className:"composer-item",template:Handlebars.compile('<div class="item-fields"></div><span data-role="drag-handle"></span><span data-action="remove">Remove</span>'),events:{change:"update"},initialize:function(){_.bindAll(this),this.$el.data("model",this.model)},render:function(){return $(this.el).html(this.template(this)),this.renderFields(),this},renderFields:function(){_.isFunction(this.options.fields)&&this.$(".item-fields").html(this.options.fields(this.model.attributes)).applyDataValues().initDataPlugins()},remove:function(){this.model.unbind("change",this.render),this.$el.remove()},update:function(){this.model.set(this.getValues())},getValues:function(){var t={};return this.$("[name]").each(function(){var e=$(this);t[e.attr("name")]=e.val()}),t}}),slices.ComposerView=Backbone.View.extend({className:"composer",template:Handlebars.compile('<ol class="composer-item-list"></ol><div class="composer-actions"><button data-action="add">{{addLabel}}</button></div>'),events:{'click [data-action="add"]':"didClickAdd",'click [data-action="remove"]':"didClickRemove"},addLabel:"Add An Item",broadcastChanges:!0,views:{},initialize:function(){_.bindAll(this),this.addLabel=this.options.addLabel||this.addLabel,this.collection=new slices.ComposerItemCollection(this.options.value),this.collection.bind("add",this.addItem),this.collection.bind("remove",this.removeItem),this.collection.bind("change",this.update),this.collection.bind("reset",this.update),this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),this.render()},render:function(){return this.broadcastChanges=!1,this.$el.html(this.template(this)),this.collection.each(this.addItem),this.makeSortable(),this.update(),this.broadcastChanges=!0,this},makeSortable:function(){var t=this.$(".composer-item-list");t.sortable({handle:'[data-role="drag-handle"]',scroll:!1,beforeStart:_.bind(function(){t.freezeHeight(),window.autoscroll.start()},this),stop:_.bind(function(){t.thawHeight(),window.autoscroll.stop()},this),update:this.updateOnSort})},updateOnSort:function(){var t=this.$(".composer-item-list").children(),e=t.map(function(){return $(this).data("model")}).get();this.collection.reset(e)},update:function(){this.ensureMinAndMax();var t=this.collection.toJSON();this.$el.data("computed-value",t),this.$el[this.collection.isEmpty()?"removeClass":"addClass"]("not-empty"),this.broadcastChanges&&this.$el.trigger("change")},ensureMinAndMax:function(){var t=this.$(".composer-actions");this.collection.length<this.options.min&&this.collection.add({}),this.collection.length>=this.options.max?t.hide():t.show()
},addItem:function(t){var e=new slices.ComposerItemView({fields:this.options.fields,model:t});this.$(".composer-item-list").append(e.el),e.render(),this.views[t.cid]=e,this.update()},removeItem:function(t){var e=this.views[t.cid];e.remove(),delete this.views[t.cid],this.update()},didClickAdd:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.collection.add({})},didClickRemove:function(t){t.preventDefault(),t.stopImmediatePropagation();var e=$(t.target),i=e.closest("li"),s=i.data("model");this.collection.remove(s)}}),slices.DateFieldView=Backbone.View.extend({events:{"click .calendar-button":"onClickCalendar","click .clear":"onClickClear","change select":"onSelectTime"},className:"date-field",template:Handlebars.compile('<span class="display">{{{display}}}</span><button class="calendar-button">Choose Date</button><button class="clear">&times;</button>'),displayTemplate:Handlebars.compile('<span class="date">{{date}} at</span> <select class="hour">{{#each hours}}<option {{attrs}}>{{value}}</option>{{/each}}</select> : <select class="minute">{{#each minutes}}<option {{attrs}}>{{value}}</option>{{/each}}</select>'),initialize:function(){_.bindAll(this),this.options.value=this.options.value||null,this.value=moment(this.options.value),this.prevValue=moment(this.value),this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),this.render()},render:function(){return this.$el.attr("name",this.options.name),this.$el.html(this.template(this)),this.updateComputedValue(),this.updateUI(),this.updateCalendar(),this.valueHasChanged()&&(this.prevValue=moment(this.value),this.$el.trigger("change")),this},display:function(){if(this.value){var t=this;return this.displayTemplate({date:this.value.format("dddd D MMMM YYYY"),hours:_.map(_.range(0,24),function(e){var i={value:_.string.pad(""+e,2,"0")};return e==t.value.hours()&&(i.attrs="selected"),i}),minutes:_.map(_.range(0,60,15),function(e){var i={value:_.string.pad(""+e,2,"0")};return e==t.value.minutes()&&(i.attrs="selected"),i})})}return"No date set"},onClickCalendar:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.toggleCalendar()},onClickClear:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.value=null,this.render()},onCalendarChange:function(){this.value=moment(this.calendar().value),this.render()},onSelectTime:function(){var t=parseInt(this.$el.find(".hour").val(),10),e=parseInt(this.$el.find(".minute").val(),10);this.value.hours(t).minutes(e),this.render()},updateComputedValue:function(){var t=this.value&&this.value.toDate()||null;this.$el.data("computed-value",t)},updateUI:function(){this.value?this.$el.find(".clear").show():this.$el.find(".clear").hide()},showCalendar:function(){this.calendar().show()},hideCalendar:function(){this.calendar().hide()},toggleCalendar:function(){this.calendar().toggle()},updateCalendar:function(){this.calendar().anchor=this.$el.find(".calendar-button"),this.calendar().setValue(this.value)},calendar:function(){return this._calendar||(this._calendar=new slices.CalendarView({value:this.value,onChange:this.onCalendarChange})),this._calendar},valueHasChanged:function(){return!this.valueHasNotChanged()},valueHasNotChanged:function(){return null==this.value&&null==this.prevValue||this.value&&this.value.is(this.prevValue)}}),slices.FileView=Backbone.View.extend({className:"upload-info",textTemplate:Handlebars.compile('<span class="upload-name">{{name}}</span><span class="upload-summary">{{summary}}</span>'),imagePath:Handlebars.compile("/assets/slices/icon_upload_{{name}}.png"),possibleStatusList:["status-queued","status-uploading","status-processing","status-done","status-failed"].join(" "),initialize:function(){_.bindAll(this),this.canvas=$('<canvas class="canvas" width="180" height="180" />'),this.text=$('<div class="text" />'),$(this.el).append(this.canvas,this.text),this.model.bind("change",this.render),this.preloadImages(),this.render()},render:function(){this.updateCanvas(),this.updateText()},updateCanvas:function(){switch(this.model.status()){case"queued":this.drawProgress(0);break;case"uploading":this.drawProgress(this.model.progress());break;case"processing":this.drawImage("thinking");break;case"done":this.drawImage("happy");break;case"failed":this.drawImage("sad")}},updateText:function(){this.text.html(this.textTemplate(this))},name:function(){return this.model.get("name")},summary:function(){switch(this.model.status()){case"queued":return"Waiting\u2026";case"uploading":return this.progressSummary();case"processing":return"Thinking\u2026";case"done":return"Done!";case"failed":return"Failed"}},progressSummary:function(){return humanFileSize(this.model.get("loaded"))+" of "+humanFileSize(this.model.get("total"))},drawProgress:function(t){var e=this.canvas[0].getContext("2d"),i=-Math.PI/2,s=180,n=180,o=90,r=75,a=30,l=3;if(e.fillStyle="#ddd",e.moveTo(0,0),e.fillRect(0,0,s,n),e.beginPath(),e.fillStyle="#838383",e.moveTo(o,r),e.arc(o,r,a,0,2*Math.PI,!1),e.closePath(),e.fill(),e.beginPath(),e.fillStyle="#ddd",e.moveTo(o,r),1>t)var h=i-2*Math.PI*(1-t);else var h=i+2*Math.PI;e.arc(o,r,a-l,i,h,!1),e.closePath(),e.fill()},drawImage:function(t){var e=this.canvas[0].getContext("2d"),i=new Image;i.onload=function(){e.fillStyle="#ddd",e.moveTo(0,0),e.fillRect(0,0,180,180),e.moveTo(0,0),e.drawImage(i,0,0)},i.src=this.imagePath({name:t})},remove:function(){$(this.el).remove()},preloadImages:function(){_(["thinking","happy","sad"]).each(_.bind(function(t){var e=new Image;e.src=slices.UPLOAD_ICONS[t]},this))}}),slices.RadioFieldView=Backbone.View.extend({events:{'change input[type="radio"]':"onChangeRadio"},className:"radio-field",template:Handlebars.compile('<div class="radio-options"></div><input class="radio-value" type="hidden" name="{{name}}" value="{{value}}">'),initialize:function(){_.bindAll(this),this.name=this.options.name,this.value=this.options.value,this.inner=this.options.inner,this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),this.render()},render:function(){var t=this.value;return $(this.el).html(this.template(this)),this.$(".radio-options").html(this.inner),this.$('input[type="radio"]').each(function(){$(this).val()==t&&$(this).attr("checked","checked")}),this},onChangeRadio:function(t){this.value=t.target.value,this.render()}}),function(){var t=13,e=8,i=9;slices.TokenFieldView=Backbone.View.extend({events:{keydown:"onKey",input:"onInput","click .del":"onClickDel","click .option":"onClickOption","click .toggle":"onClickToggle"},className:"token-field",template:Handlebars.compile('<input type="text" class="input" name="{{id}}" list="datalist-{{id}}"><span class="tokens">{{#each values}}<span class="token" data-value="{{this}}" unselectable="true">{{this}} <span class="del">&times;</span></span>{{/each}}</span><span class="options">{{#if isShowingAll}}{{#each valueOptions}}<a href="#" class="option">{{this}}</a>{{/each}}{{else}}{{#each someOptions}}<a href="#" class="option">{{this}}</a>{{/each}}<a href="#" class="toggle">Show all\u2026</a>{{/if}}</span><datalist id="datalist-{{id}}">{{#each remainingOptions}}<option>{{this}}</option>{{/each}}</datalist>'),initialize:function(){_.bindAll(this),this.values=this.sanitizeValues(this.options.values),this.prevValues=[].concat(this.values||[]),this.valueOptions=[].concat(this.options.options||[]),this.someOptions=this.valueOptions.slice(0,5),this.valueOptions.length<=this.someOptions.length&&(this.isShowingAll=!0),$(document).on("slices:willSubmit",this.capture),$(document).on("slices:didShowAdvancedOptions",this.render),this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),this.render()},render:function(){this.prepareValueOptions(),this.$el.html(this.template(this)),this.updateComputedValue(),this.updateValueOptions(),this.updateLayout(),this.updateInput(),this.makeSortable(),_.isEqual(this.values,this.prevValues)||(this.$el.find("input").trigger("change"),this.prevValues=[].concat(this.values))},focus:function(){this.$el.find("input").focus()},capture:function(){var t=this.$el.find("input").val().split(/ *, */);this.values=this.sanitizeValues(this.values.concat(t)),this.render(),this.focus()},focusOrRemoveLastToken:function(){var t=this.$el.find(".token.focus");t.length?(this.values.pop(),this.render(),this.focus()):this.$el.find(".token:last").addClass("focus")},updateLayout:function(){var t=this.$el.find(".tokens"),e=this.$el.find("input"),i=t.children().last();if(this.hasOwnProperty("_paddingLeft")||(this._paddingLeft=parseInt(e.css("paddingLeft"))),this.values.length){var s=i.position().left+i.outerWidth();e.css({paddingLeft:s+this._paddingLeft})}else e.css({paddingLeft:this._paddingLeft});t.outerHeight()>e.outerHeight()&&e.css({paddingTop:t.outerHeight()-i.outerHeight()})},updateInput:function(){this.options.singular&&this.values.length&&this.$el.find("input").attr("disabled",!0)},updateValueOptions:function(){var t=this;this.$el.find(".option").each(function(){var e=$(this),i=e.text();_.contains(t.values,i)?$(this).addClass("used"):$(this).removeClass("used")})},updateComputedValue:function(){if(this.options.singular)var t=this.values[0];else var t=this.values;this.$el.data("computed-value",t||null)},makeSortable:function(){var t=this;this.$el.find(".tokens").sortable({stop:function(e,i){var s=i.item.data("value"),n=i.item.index();t.moveTokenToIndex(s,n)}})},moveTokenToIndex:function(t,e){var i=_.indexOf(this.values,t);this.values.splice(e,0,this.values.splice(i,1)[0]),this.render()},onKey:function(s){switch(this.lastKey=Date.now(),s.which){case t:case i:this.onTokenBreaker(s);break;case e:this.onBackspace(s);break;default:return}},onInput:function(){(!this.lastKey||Date.now()-this.lastKey>10)&&this.capture()},onTokenBreaker:function(t){var e=this.$el.find("input"),i=e.val();i.length&&(t.preventDefault(),this.capture())},onBackspace:function(t){var e=this.$el.find("input"),i=e.val();i.length||(t.preventDefault(),this.focusOrRemoveLastToken())},onClickDel:function(t){t.preventDefault();var e=$(t.target).closest(".token"),i=e.data("value");this.values=_.without(this.values,i),this.render(),this.focus()},onClickOption:function(t){t.preventDefault();var e=$(t.target),i=e.text();this.options.singular?this.values=[i]:_.contains(this.values,i)?this.values=_.without(this.values,i):this.values.push(i),this.render(),this.focus()},onClickToggle:function(t){t.preventDefault(),this.isShowingAll=!0,this.render()},sanitizeValues:function(t){return t=[t],t=_.flatten(t),t=_.map(t,function(t){return t&&t.replace(/^\s+/,"").replace(/\s+$/,"")}),t=_.compact(t),t=_.uniq(t),this.options.singular&&(t=t.slice(0,1)),t},prepareValueOptions:function(){var t=this;this.valueOptions=_.uniq(this.valueOptions.concat(this.values)).sort(),this.remainingOptions=_.reject(this.valueOptions,function(e){return _.contains(t.values,e)})}})}(),slices.UrlFieldView=Backbone.View.extend({tagName:"input",className:"url-field",attributes:{type:"text","data-store":"/admin/pages/search.json?query=:query","data-template":"#livefield-result-template"},initialize:function(){_.bindAll(this),this.options.autoAttach&&_.defer(this.attach)},placeholder:function(){return Handlebars.compile('<div id="placeholder-{{id}}"></div>')(this)},attach:function(){$("#placeholder-"+this.id).replaceWith(this.el),$(this.el).val(this.options.value),this.render()},render:function(){return $(this.el).livefield(),this}});